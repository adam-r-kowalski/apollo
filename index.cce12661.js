function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}let t;var n;let r;var i;(n=t||(t={}))[n.START=0]="START",n[n.CENTER=1]="CENTER",n[n.END=2]="END",n[n.SPACE_EVENLY=3]="SPACE_EVENLY",n[n.SPACE_BETWEEN=4]="SPACE_BETWEEN",(i=r||(r={}))[i.START=0]="START",i[i.CENTER=1]="CENTER",i[i.END=2]="END";const o=({haystack:e,needle:t})=>{let n=0,r=0;for(;r<t.length;){const i=t[r].toLowerCase();for(;n<e.length&&i!==e[n].toLowerCase();)++n;if(n===e.length)return!1;++r}return!0},s=({width:e,height:t})=>[2/e,0,-1,0,-2/t,1,0,0,1],a=(e,t)=>[1,0,e,0,1,t,0,0,1],c=(e,t)=>[e,0,0,0,t,0,0,0,1],d=(...e)=>{const[t,...n]=e;return n.reduce(((e,t)=>{const n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2],g=t[3],x=t[4],E=t[5],f=t[6],m=t[7],A=t[8];return[n*l+r*g+i*f,n*h+r*x+i*m,n*p+r*E+i*A,o*l+s*g+a*f,o*h+s*x+a*m,o*p+s*E+a*A,c*l+d*g+u*f,c*h+d*x+u*m,c*p+d*E+u*A]}),t)},u=(e,t)=>{const n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2];return[n*l+r*h+i*p,o*l+s*h+a*p,c*l+d*h+u*p]},l=e=>{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],d=e[8],u=n*s-r*o,l=t*s-r*i,h=t*o-n*i,p=1/(a*u-c*l+d*h);return[p*(o*d-s*c),p*-(n*d-r*c),p*u,p*-(i*d-s*a),p*(t*d-r*a),p*-l,p*(i*c-o*a),p*-(t*c-n*a),p*h]},h=([e,t,n])=>Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2));let p;var g;(g=p||(p={}))[g.POINTER_MOVE=0]="POINTER_MOVE",g[g.POINTER_DOWN=1]="POINTER_DOWN",g[g.POINTER_UP=2]="POINTER_UP",g[g.CLICKED_NODE=3]="CLICKED_NODE",g[g.WHEEL=4]="WHEEL",g[g.CLICKED_INPUT=5]="CLICKED_INPUT",g[g.CLICKED_OUTPUT=6]="CLICKED_OUTPUT",g[g.DOUBLE_CLICK_TIMEOUT=7]="DOUBLE_CLICK_TIMEOUT",g[g.DOUBLE_CLICK=8]="DOUBLE_CLICK",g[g.KEYDOWN=9]="KEYDOWN",g[g.VIRTUAL_KEYDOWN=10]="VIRTUAL_KEYDOWN",g[g.CLICKED_FINDER_OPTION=11]="CLICKED_FINDER_OPTION";const x=(e,t)=>{if(!e.dragging&&!e.zooming)return e.finder.show||(e.nodePlacementLocation={x:t.pointer.x,y:t.pointer.y}),{state:e,rerender:!1};const n=e.pointers.findIndex((e=>e.id===t.pointer.id)),r=e.pointers[n];if(e.pointers[n]=t.pointer,e.dragging){const n=t.pointer.x-r.x,i=t.pointer.y-r.y;if(null!==e.draggedNode){const t=h(u(e.camera,[0,1,0])),r=e.graph.nodes[e.draggedNode];r.x+=n*t,r.y+=i*t}else e.camera=d(e.camera,a(-n,-i));return{state:e,render:!0}}if(e.zooming){const[t,n]=[e.pointers[0],e.pointers[1]],[r,i]=[t.x,t.y],[o,s]=[n.x,n.y],u=Math.sqrt(Math.pow(o-r,2)+Math.pow(s-i,2)),l=e.pointerDistance,h=e.pointerCenter;e.pointerDistance=u;const p=(t.x+n.x)/2,g=(t.y+n.y)/2;if(e.pointerCenter=[p,g],l>0){const t=a(p,g),n=Math.pow(2,.01*(l-u)),r=a(-p,-g),i=p-h[0],o=g-h[1];return e.camera=d(e.camera,t,c(n,n),r,a(-i,-o)),{state:e,render:!0}}return{state:e}}return{state:e}},E=e=>(e.finder.options=Object.keys(e.operations).filter((t=>o({haystack:t,needle:e.finder.search}))),e),f=e=>(e.finder.show=!1,e.finder.search="",e),m=(e,t)=>{const n=(e=f(e)).operations[t],[r,i,o]=u(e.camera,[e.nodePlacementLocation.x,e.nodePlacementLocation.y,1]);return e.graph.nodes.push({name:t,inputs:n.inputs.map((e=>({name:e,selected:!1,edgeIndices:[]}))),outputs:n.outputs.map((e=>({name:e,selected:!1,edgeIndices:[]}))),x:r,y:i}),e},A=({x0:e,y0:t,x1:n,y1:r},i)=>e<=i.x&&i.x<=n&&t<=i.y&&i.y<=r,T=(e,t)=>{for(let n=e.clickHandlers.length;n>0;--n)for(const{onClick:r,worldSpace:i}of e.clickHandlers[n-1])if(A(i,t))return e.dispatch(r),e;return e},C=e=>({vertices:[],colors:[],vertexIndices:[],textureIndex:e,textureCoordinates:[],cameraIndex:[]}),y=e=>{const t=[];let n=C(0),r=n.textureIndex.toString();for(const i of e)for(const[e,o]of Object.entries(i)){r!==e&&(0!==n.vertices.length&&t.push(n),n=C(parseInt(e)),r=e);for(const e of o){const t=n.vertices.length/2;n.vertices.push(...e.vertices),n.colors.push(...e.colors);for(const r of e.vertexIndices)n.vertexIndices.push(r+t);n.textureCoordinates.push(...e.textureCoordinates),n.cameraIndex.push(...e.cameraIndex)}}return 0!==n.vertices.length&&t.push(n),t},I=(e,t)=>{const n=e.cameras.length;e.cameras.push(t),e.stack.push(n),e.transform=l(t)},R=e=>e.stack.slice(-1)[0],_=e=>{e.stack.pop(),e.transform=l(e.cameras[R(e)])},w=(e,t)=>{const[n,r,i]=u(e.transform,[t.x0,t.y0,1]),[o,s,a]=u(e.transform,[t.x1,t.y1,1]);return{x0:n,y0:r,x1:o,y1:s}},N=(e,t,n)=>{const r=se(e.child,t,n);return{size:{width:t.maxWidth,height:t.maxHeight},child:r}},b=(e,t,n,r)=>{const i=w(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),o=t.child,s={x:n.x+t.size.width/2-o.size.width/2,y:n.y+t.size.height/2-o.size.height/2};return{worldSpace:i,child:ae(e.child,o,s,r)}};function*D(e,t,n,r){yield*ce(e.child,t.child,n.child,r+1)}function v(...e){const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:ie.COLUMN,mainAxisAlignment:n.mainAxisAlignment??t.START,crossAxisAlignment:n.crossAxisAlignment??r.START,children:i}}const S=(e,n,r)=>{const i={children:[],width:0,totalChildHeight:0},o=e.children.reduce(((e,t)=>{const i=se(t,n,r);return e.children.push(i),e.totalChildHeight+=i.size.height,e.width=Math.max(e.width,i.size.width),e}),i),{children:s,width:a,totalChildHeight:c}=o;return{size:{width:a,height:e.mainAxisAlignment==t.START?c:n.maxHeight},totalChildHeight:c,children:s}},O=(e,n,i,o)=>{const s=n.size.height-n.totalChildHeight,a={children:[],y:(()=>{switch(e.mainAxisAlignment){case t.START:return i.y;case t.CENTER:return i.y+s/2;case t.END:return i.y+s;case t.SPACE_EVENLY:return i.y+s/(e.children.length+1);case t.SPACE_BETWEEN:return i.y}})()},c=e=>e.size.height,d=e=>e.size.height,u=e=>e.size.height,l=t=>t.size.height+s/(e.children.length+1),h=t=>t.size.height+s/(e.children.length-1),p=(()=>{switch(e.mainAxisAlignment){case t.START:return c;case t.CENTER:return d;case t.END:return u;case t.SPACE_EVENLY:return l;case t.SPACE_BETWEEN:return h}})(),g=e=>i.x,x=e=>i.x+n.size.width/2-e.size.width/2,E=e=>i.x+n.size.width-e.size.width,f=(()=>{switch(e.crossAxisAlignment){case r.START:return g;case r.CENTER:return x;case r.END:return E}})(),m=e.children.reduce(((e,t,r)=>{const i=n.children[r],s={x:f(i),y:e.y},a=ae(t,i,s,o);return e.children.push(a),e.y+=p(i),e}),a);return{worldSpace:w(o,{x0:i.x,y0:i.y,x1:i.x+n.size.width,y1:i.y+n.size.height}),children:m.children}};function*L(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const i=r+1;let o=0;for(const r of e.children)yield*ce(r,t.children[o],n.children[o],i),o+=1}const k=e=>e?{top:e,right:e,bottom:e,left:e}:{top:0,right:0,bottom:0,left:0},z=({padding:e,width:t,height:n,color:r,x:i,y:o,onClick:s,id:a},c)=>({kind:ie.CONTAINER,padding:k(e),width:t,height:n,x:i,y:o,color:r,onClick:s,id:a,child:c}),U=(e,t,n)=>{const{top:r,right:i,bottom:o,left:s}=e.padding;if(e.child){const a=se(e.child,t,n);return{size:{width:e.width??a.size.width+s+i,height:e.height??a.size.height+r+o},child:a}}return{size:{width:e.width?e.width+s+i:t.maxWidth,height:e.height?e.height+r+o:t.maxHeight}}},P=(e,t,n,r)=>{const i=n.x+(e.x??0),o=i+t.size.width,s=n.y+(e.y??0),a=s+t.size.height,c=w(r,{x0:i,x1:o,y0:s,y1:a}),d=(()=>{if(e.child){const n=t.child,o={x:i+e.padding.left,y:s+e.padding.top};return ae(e.child,n,o,r)}})();if(e.color){const{red:t,green:n,blue:u,alpha:l}=e.color;return{worldSpace:c,vertices:[i,s,i,a,o,s,o,a],colors:[t,n,u,l,t,n,u,l,t,n,u,l,t,n,u,l],vertexIndices:[0,1,2,1,2,3],cameraIndex:Array(4).fill(R(r)),textureIndex:0,textureCoordinates:Array(8).fill(0),child:d}}return{worldSpace:c,vertices:[],colors:[],vertexIndices:[],cameraIndex:[],textureIndex:0,textureCoordinates:[],child:d}};function*B(e,t,n,r){if(yield{ui:e,layout:t,geometry:n,z:r},e.child){const i=t.child,o=n.child;yield*ce(e.child,i,o,r+1)}}function F(...e){const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:ie.ROW,mainAxisAlignment:n.mainAxisAlignment??t.START,crossAxisAlignment:n.crossAxisAlignment??r.START,children:i}}const W=(e,n,r)=>{const i={children:[],totalChildWidth:0,height:0},o=e.children.reduce(((e,t)=>{const i=se(t,n,r);return e.children.push(i),e.totalChildWidth+=i.size.width,e.height=Math.max(e.height,i.size.height),e}),i),{children:s,totalChildWidth:a,height:c}=o;return{size:{width:e.mainAxisAlignment==t.START?a:n.maxWidth,height:c},totalChildWidth:a,children:s}},M=(e,n,i,o)=>{const s=n.size.width-n.totalChildWidth,a={children:[],x:(()=>{switch(e.mainAxisAlignment){case t.START:return i.x;case t.CENTER:return i.x+s/2;case t.END:return i.x+s;case t.SPACE_EVENLY:return i.x+s/(e.children.length+1);case t.SPACE_BETWEEN:return i.x}})()},c=e=>e.size.width,d=e=>e.size.width,u=e=>e.size.width,l=t=>t.size.width+s/(e.children.length+1),h=t=>t.size.width+s/(e.children.length-1),p=(()=>{switch(e.mainAxisAlignment){case t.START:return c;case t.CENTER:return d;case t.END:return u;case t.SPACE_EVENLY:return l;case t.SPACE_BETWEEN:return h}})(),g=e=>i.y,x=e=>i.y+n.size.height/2-e.size.height/2,E=e=>i.y+n.size.height-e.size.height,f=(()=>{switch(e.crossAxisAlignment){case r.START:return g;case r.CENTER:return x;case r.END:return E}})(),m=e.children.reduce(((e,t,r)=>{const i=n.children[r],s={x:e.x,y:f(i)},a=ae(t,i,s,o);return e.children.push(a),e.x+=p(i),e}),a);return{worldSpace:w(o,{x0:i.x,y0:i.y,x1:i.x+n.size.width,y1:i.y+n.size.height}),children:m.children}};function*Y(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const i=r+1;let o=0;for(const r of e.children)yield*ce(r,t.children[o],n.children[o],i),o+=1}const K=({id:e,onClick:t,camera:n,children:r,connections:i})=>({id:e,onClick:t,kind:ie.SCENE,camera:n,children:r,connections:i??[]}),H=(e,t,n)=>{const r=e.children.map((e=>se(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},V=(e,t,n,r)=>{const i=w(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height});I(r,e.camera);const o=e.children.map(((e,i)=>ae(e,t.children[i],n,r)));return _(r),{worldSpace:i,children:o}};function*X(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let i=0;for(const o of e.children){for(const e of ce(o,t.children[i],n.children[i],r))yield e,r=Math.max(r,e.z);i++,r++}}const $=e=>({kind:ie.STACK,children:e}),G=(e,t,n)=>{const r=e.children.map((e=>se(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},q=(e,t,n,r)=>{const i=e.children.map(((e,i)=>ae(e,t.children[i],n,r)));return{worldSpace:w(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:i}};function*j(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let i=0;for(const o of e.children){for(const e of ce(o,t.children[i],n.children[i],r))yield e,r=Math.max(r,e.z);i+=1,r+=1}}function J(...e){const[t,n]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]];return{kind:ie.TEXT,font:{family:t.font??"monospace",size:t.size??14},color:t.color??{red:255,green:255,blue:255,alpha:255},str:n}}const Q=({font:e,str:t},n,r)=>{const i=r(e,t),o=i.widths.reduce(((e,t)=>e+t));return{measurements:i,size:{width:o,height:e.size}}},Z=(e,t,n)=>{const r=[];let i=n.x;const o=n.y,s=n.y+t;for(const t of e){const e=i,n=i+t;r.push(e,o,e,s,n,o,n,s),i+=t}return r},ee=(e,{red:t,green:n,blue:r,alpha:i})=>{const o=[];for(let s=0;s<e;++s)o.push(t,n,r,i,t,n,r,i,t,n,r,i,t,n,r,i);return o},te=e=>{const t=[];let n=0;for(let r=0;r<e;++r)t.push(n,n+1,n+2,n+1,n+2,n+3),n+=4;return t},ne=(e,t,n,r)=>{const i=t,{measurements:o}=i,{textureIndex:s,textureCoordinates:a,widths:c}=o;return{worldSpace:w(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),textureIndex:s,textureCoordinates:a.flat(),colors:ee(c.length,e.color),vertices:Z(c,e.font.size,n),vertexIndices:te(c.length),cameraIndex:Array(4*c.length).fill(R(r))}};function*re(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r}}let ie;var oe;(oe=ie||(ie={}))[oe.CENTER=0]="CENTER",oe[oe.COLUMN=1]="COLUMN",oe[oe.CONTAINER=2]="CONTAINER",oe[oe.ROW=3]="ROW",oe[oe.SCENE=4]="SCENE",oe[oe.STACK=5]="STACK",oe[oe.TEXT=6]="TEXT";const se=(e,t,n)=>{switch(e.kind){case ie.CENTER:return N(e,t,n);case ie.COLUMN:return S(e,t,n);case ie.CONTAINER:return U(e,t,n);case ie.ROW:return W(e,t,n);case ie.SCENE:return H(e,t,n);case ie.STACK:return G(e,t,n);case ie.TEXT:return Q(e,0,n)}},ae=(e,t,n,r)=>{switch(e.kind){case ie.CENTER:return b(e,t,n,r);case ie.COLUMN:return O(e,t,n,r);case ie.CONTAINER:return P(e,t,n,r);case ie.ROW:return M(e,t,n,r);case ie.SCENE:return V(e,t,n,r);case ie.STACK:return q(e,t,n,r);case ie.TEXT:return ne(e,t,n,r)}};function*ce(e,t,n,r){switch(e.kind){case ie.CENTER:yield*D(e,t,n,r);break;case ie.COLUMN:yield*L(e,t,n,r);break;case ie.CONTAINER:yield*B(e,t,n,r);break;case ie.ROW:yield*Y(e,t,n,r);break;case ie.SCENE:yield*X(e,t,n,r);break;case ie.STACK:yield*j(e,t,n,r);break;case ie.TEXT:yield*re(e,t,n,r)}}const de=(e,t,n,r)=>{const i=r.initial();for(const o of ce(e,t,n,0))r.combine(i,o);return i};var ue={};e(ue,"initial",(()=>xe)),e(ue,"combine",(()=>Ee));const le=(e,t)=>{if(void 0===t.ui.onClick)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({onClick:t.ui.onClick,worldSpace:t.geometry.worldSpace}),e},he=(e,t)=>t.ui.id?(e[t.ui.id]=t.geometry.worldSpace,e):e,pe=(e,t)=>{switch(t.ui.kind){case ie.CONTAINER:case ie.TEXT:const n=t.geometry;if(0==n.vertices.length)return e;const r=t.z-e.length+1;for(let t=0;t<r;++t)e.push({});const i=e[t.z];return(()=>{const e=i[n.textureIndex];if(e)return e;const t=[];return i[n.textureIndex]=t,t})().push(n),e;default:return e}},ge=(e,t)=>(t.ui.kind==ie.SCENE&&e.push(...t.ui.connections),e),xe=()=>({layers:[],clickHandlers:[],idToWorldSpace:{},connections:[]}),Ee=(e,t)=>({layers:pe(e.layers,t),clickHandlers:le(e.clickHandlers,t),idToWorldSpace:he(e.idToWorldSpace,t),connections:ge(e.connections,t)});function*fe(e,t,n){const r=(t.x0+t.x1)/2,i=(t.y0+t.y1)/2,o=r+50,s=i,a=(n.x0+n.x1)/2,c=(n.y0+n.y1)/2,d=a-50,u=c;let l=0,h=0,p=!0;for(const t of e){const e=t*t,n=e*t,g=1-t,x=g*g,E=x*g,f=3*x*t,m=3*g*e,A=E*r+f*o+m*d+n*a,T=E*i+f*s+m*u+n*c;p?(yield A,yield T,p=!1):(yield l,yield h),yield A,yield T,l=A,h=T}}const me=(e,t)=>{const n=((e,t,n)=>{const r=(t-e)/(n-1);return Array.from({length:n},((t,n)=>e+r*n))})(0,1,20),r=[],i=[];for(const{from:o,to:s,color:a}of e){for(const e of fe(n,t[o],t[s]))r.push(e);const{red:e,green:c,blue:d,alpha:u}=a;for(let t=0;t<40;++t)i.push(e,c,d,u)}return{vertices:r,colors:i}},Ae=(e,t)=>{const{width:n,height:r}=e.size;e.clear();const i=se(t,{minWidth:0,maxWidth:n,minHeight:0,maxHeight:r},e.measureText),o={cameras:[[1,0,0,0,1,0,0,0,1]],stack:[0],transform:l([1,0,0,0,1,0,0,0,1])},s=ae(t,i,{x:0,y:0},o),{layers:a,clickHandlers:c,connections:d,idToWorldSpace:u}=de(t,i,s,ue),h=y(a),p=me(d,u);e.cameras=o.cameras,e.clickHandlers=c;for(const t of h)e.draw(t);return p.vertices.length&&e.drawLines(p),e};class Te{constructor(e,t,n,r,i,o,s,a,c){this.window=e,this.document=t,this.canvas=n,this.gl=r,this.program=i,this.textures=o,this.textMeasurementsCache=s,this.clickHandlers=a,this.dispatch=c,this.clear=()=>{const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)},this.draw=({vertices:e,colors:t,vertexIndices:n,textureCoordinates:r,textureIndex:i,cameraIndex:o})=>{const{gl:s,program:a,textures:c}=this,{attributes:d}=a,u=c[i];s.bindTexture(s.TEXTURE_2D,u),s.bindBuffer(s.ARRAY_BUFFER,d.vertices.buffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,d.colors.buffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(t),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,d.textureCoordinates.buffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(r),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,d.cameraIndex.buffer),s.bufferData(s.ARRAY_BUFFER,new Uint8Array(o),s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,d.vertexIndices),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),s.STATIC_DRAW),s.drawElements(s.TRIANGLES,n.length,s.UNSIGNED_SHORT,0)},this.drawLines=({vertices:e,colors:t})=>{const{gl:n,program:r,textures:i}=this,{attributes:o}=r,s=i[0],a=e.length/2;n.bindTexture(n.TEXTURE_2D,s),n.bindBuffer(n.ARRAY_BUFFER,o.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(Array(2*a).fill(0)),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(Array(a).fill(0)),n.STATIC_DRAW),n.drawArrays(n.LINES,0,a)},this.getTextureMeasurements=(e,t)=>{const{document:n,gl:r}=this,i=`${t} ${e.size} ${e.family}`,o=this.textMeasurementsCache.get(i);if(o)return o;const{texture:s,widths:a,textureCoordinates:c}=((e,t,n,r)=>{const i=e.createElement("canvas"),o=i.getContext("2d"),s=Math.sqrt(256),a=(e=>{let t=1;for(;t<e;)t<<=1;return t})(n.size*s),c=a/s;i.width=a*r,i.height=a*r,i.style.width=`${a}px`,i.style.height=`${a}px`,o.scale(r,r),o.textAlign="left",o.textBaseline="top",o.font=`${n.size}px ${n.family}`,o.fillStyle="white",o.clearRect(0,0,o.canvas.width,o.canvas.height);const d=n.size,u=[],l=[];for(let e=0;e<256;++e){const t=String.fromCharCode(e),n=o.measureText(t),r=Math.ceil(n.width),i=e%s*c,h=Math.floor(e/s)*c;o.fillText(t,i,h),u.push(r);const p=i/a,g=(i+r)/a,x=h/a,E=(h+d)/a;l.push([p,x,p,E,g,x,g,E])}const h=t.createTexture();return t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{widths:u,textureCoordinates:l,texture:h}})(n,r,e,t),d=this.textures.length;this.textures.push(s);const u={widths:a,textureIndex:d,textureCoordinates:c};return this.textMeasurementsCache.set(i,u),u},this.measureText=(e,t)=>{const{window:n}=this,r=n.devicePixelRatio,{widths:i,textureIndex:o,textureCoordinates:s}=this.getTextureMeasurements(e,r),a=((e,t)=>{let n=[];for(let r=0;r<e.length;++r)n.push(t(e[r],r));return n})(t,(e=>e.charCodeAt(0)));return{widths:a.map((e=>i[e])),textureIndex:o,textureCoordinates:a.map((e=>s[e]))}}}set size(e){const{gl:t,program:n,window:r}=this,{uniforms:i}=n,{canvas:o}=t;t.uniformMatrix3fv(i.projection,!0,s(e)),o.width=e.width*r.devicePixelRatio,o.height=e.height*r.devicePixelRatio,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`,t.viewport(0,0,o.width,o.height),this._size=e}get size(){return this._size}set cameras(e){const{gl:t,program:n}=this,{uniforms:r}=n,i=[];for(const t of e)i.push(...t);t.uniformMatrix3fv(r.cameras,!0,i),this._cameras=e}get cameras(){return this._cameras}}const Ce=({width:e,height:t,document:n,window:r,dispatch:i})=>{const o=n.createElement("canvas");o.style.touchAction="none";const s=o.getContext("webgl2");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.clearColor(0,0,0,1);const a=(e=>{const t={vertices:{location:0,buffer:e.createBuffer()},colors:{location:1,buffer:e.createBuffer()},textureCoordinates:{location:2,buffer:e.createBuffer()},cameraIndex:{location:3,buffer:e.createBuffer()},vertexIndices:e.createBuffer()},n=((e,t)=>{const{vertices:n,colors:r,textureCoordinates:i,cameraIndex:o}=t,s=`#version 300 es\n  uniform mat3 u_projection;\n  uniform mat3 u_cameras[8];\n\n  layout(location = ${n.location}) in vec2 a_vertex;\n  layout(location = ${r.location}) in vec4 a_color;\n  layout(location = ${i.location}) in vec2 a_textureCoordinates;\n  layout(location = ${o.location}) in uint a_cameraIndex;\n\n  out vec4 v_color;\n  out vec2 v_textureCoordinates;\n\n  void main() {\n    mat3 camera = u_cameras[a_cameraIndex];\n    mat3 transform = u_projection * inverse(camera);\n    gl_Position = vec4((transform * vec3(a_vertex, 1)).xy, 0, 1);\n    v_color = a_color / 255.0;\n    v_textureCoordinates = a_textureCoordinates;\n  }\n  `,a=e.createShader(e.VERTEX_SHADER);return e.shaderSource(a,s),e.compileShader(a),a})(e,t),r=(e=>{const t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec4 v_color;\n  in vec2 v_textureCoordinates;\n\n  out vec4 fragColor;\n  \n  void main() {\n    fragColor = texture(u_texture, v_textureCoordinates) * v_color;\n  }\n  "),e.compileShader(t),t})(e),i=e.createProgram();e.attachShader(i,n),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.log(e.getShaderInfoLog(n)),console.log(e.getShaderInfoLog(r))),e.useProgram(i);const o=e.createVertexArray();return e.bindVertexArray(o),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_vertex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.vertices),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_color"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0)})(e,i,t.colors),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_textureCoordinates"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.textureCoordinates),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_cameraIndex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribIPointer(n,1,e.UNSIGNED_BYTE,0,0)})(e,i,t.cameraIndex),{vertexShader:n,fragmentShader:r,program:i,attributes:t,uniforms:{projection:e.getUniformLocation(i,"u_projection"),texture:e.getUniformLocation(i,"u_texture"),cameras:e.getUniformLocation(i,"u_cameras")}}})(s),c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const d=new Te(r,n,o,s,a,[c],new Map,[],i??(()=>{}));return d.size={width:e,height:t},d},ye=e=>({x:e.clientX,y:e.clientY,id:e.pointerId}),Ie=e=>z({width:e,height:e}),Re=(e,t)=>{const n=[e[0]];for(const r of e.slice(1))n.push(t,r);return n},_e=(e,t,n)=>v(Re(t.map(((t,i)=>((e,{name:t,selected:n},i,o)=>z({onClick:{kind:p.CLICKED_INPUT,inputPath:{nodeIndex:i,inputIndex:o}}},F({crossAxisAlignment:r.CENTER},[z({id:`input ${i} ${o}`,width:14,height:14,color:n?e.selectedInput:e.input}),Ie(4),J(t)])))(e,t,n,i))),Ie(4))),we=(e,t,n)=>v(Re(t.map(((t,i)=>((e,{name:t,selected:n},i,o)=>z({onClick:{kind:p.CLICKED_OUTPUT,outputPath:{nodeIndex:i,outputIndex:o}}},F({crossAxisAlignment:r.CENTER},[J(t),Ie(4),z({id:`output ${i} ${o}`,width:14,height:14,color:n?e.selectedInput:e.input})])))(e,t,n,i))),Ie(4))),Ne=(e,{name:t,x:n,y:i,inputs:o,outputs:s},a)=>{const c=[];return o.length&&c.push(_e(e,o,a)),o.length&&s.length&&c.push(Ie(15)),s.length&&c.push(we(e,s,a)),z({color:e.node,padding:4,x:n,y:i,onClick:{kind:p.CLICKED_NODE,index:a}},v({crossAxisAlignment:r.CENTER},[J(t),Ie(4),F(c)]))},be=({search:e,options:t},n)=>v({crossAxisAlignment:r.CENTER},[z({height:10}),z({color:n.node,padding:4},v([z({color:n.background,width:300,padding:4},J({color:n.input,size:24},e.length?e:"Search ...")),z({width:10,height:10}),...t.map(((e,t)=>z({padding:4,onClick:{kind:p.CLICKED_FINDER_OPTION,option:e}},J({size:18,color:0==t?n.input:{red:255,green:255,blue:255,alpha:255}},e))))]))]),De=e=>F(e.map((e=>{return t=e,z({padding:10,onClick:{kind:p.VIRTUAL_KEYDOWN,key:t}},J({size:24},t));var t}))),ve=((e,t,n)=>{let r=Ce({width:window.innerWidth,height:window.innerHeight,window:window,document:document}),i=!1;const o=()=>{i||(i=!0,requestAnimationFrame((()=>{r=Ae(r,t(e)),i=!1})))},s=t=>{const{state:r,render:i,schedule:a,dispatch:c}=n(e,t);e=r,i&&o();for(const{after:e,event:t}of a??[]){const{milliseconds:n}=e;setTimeout((()=>s(t)),n)}for(const e of c??[])s(e)};return r.dispatch=s,document.body.appendChild(r.canvas),document.addEventListener("pointerdown",(e=>{r=T(r,ye(e))})),window.addEventListener("resize",(()=>{r.size={width:window.innerWidth,height:window.innerHeight},o()})),o(),s})({graph:{nodes:[{name:"Source",inputs:[],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:7,y:15},{name:"Transform",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:window.innerWidth/2-70,y:50},{name:"Sink",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[],x:window.innerWidth-70,y:15}],edges:[]},zooming:!1,dragging:!1,draggedNode:null,pointers:[],pointerDistance:0,pointerCenter:[0,0],camera:[1,0,0,0,1,0,0,0,1],selectedOutput:null,selectedInput:null,theme:{background:{red:2,green:22,blue:39,alpha:255},node:{red:41,green:95,blue:120,alpha:255},input:{red:188,green:240,blue:192,alpha:255},selectedInput:{red:175,green:122,blue:208,alpha:255},connection:{red:255,green:255,blue:255,alpha:255}},potentialDoubleClick:!1,nodePlacementLocation:{x:0,y:0},finder:{search:"",options:[],show:!1},operations:{Add:{name:"Add",inputs:["x","y"],outputs:["out"]},Subtract:{name:"Subtract",inputs:["x","y"],outputs:["out"]},Multiply:{name:"Multiply",inputs:["x","y"],outputs:["out"]},Divide:{name:"Divide",inputs:["x","y"],outputs:["out"]},Equal:{name:"Equal",inputs:["x","y"],outputs:["out"]},"Less Than":{name:"Less Than",inputs:["x","y"],outputs:["out"]},"Less Than Or Equal":{name:"Less Than Or Equal",inputs:["x","y"],outputs:["out"]}}},(e=>{if(!e.finder.show){const t=[];if(e.graph.nodes.forEach(((n,r)=>{r!==e.draggedNode&&t.push(Ne(e.theme,n,r))})),null!==e.draggedNode){const n=e.draggedNode;t.push(Ne(e.theme,e.graph.nodes[n],n))}const n=e.graph.edges.map((({input:t,output:n})=>({from:`output ${n.nodeIndex} ${n.outputIndex}`,to:`input ${t.nodeIndex} ${t.inputIndex}`,color:e.theme.connection})));return $([z({color:e.theme.background}),K({camera:e.camera,children:t,connections:n})])}return $([z({color:e.theme.background}),be(e.finder,e.theme),(n=e.theme,v({mainAxisAlignment:t.END},[F({mainAxisAlignment:t.SPACE_BETWEEN},[z({padding:4,color:n.node},v([De(["1","2","3","4","5"]),De(["q","w","e","r","t"]),De(["a","s","d","f","g"]),De(["z","x","c","v"]),De(["sft","space"])])),z({padding:4,color:n.node},v({crossAxisAlignment:r.END},[De(["6","7","8","9","0"]),De(["y","u","i","o","p"]),De(["h","j","k","l"]),De(["b","n","m","del"]),De(["space","ret"])]))])]))]);var n}),((e,t)=>{switch(t.kind){case p.POINTER_DOWN:return((e,t)=>e.finder.show?{state:e}:(e.pointers.push(t.pointer),e.pointers.length>1?(e.potentialDoubleClick=!1,e.dragging=!1,e.zooming=2===e.pointers.length,{state:e}):e.potentialDoubleClick?(e.potentialDoubleClick=!1,{state:e,dispatch:[{kind:p.DOUBLE_CLICK,pointer:t.pointer}]}):(e.dragging=!0,e.potentialDoubleClick=!0,{state:e,schedule:[{after:{milliseconds:300},event:{kind:p.DOUBLE_CLICK_TIMEOUT}}]})))(e,t);case p.POINTER_UP:return((e,t)=>{const n=e.pointers.findIndex((e=>e.id===t.pointer.id));return e.pointers.splice(n,1),1===e.pointers.length?(e.zooming=!1,e.dragging=!0,e.pointerDistance=0):0===e.pointers.length&&(e.dragging=!1,e.draggedNode=null,e.pointerDistance=0),{state:e}})(e,t);case p.POINTER_MOVE:return x(e,t);case p.CLICKED_NODE:return((e,t)=>(e.draggedNode=t.index,{state:e,render:!0}))(e,t);case p.WHEEL:return((e,t)=>{const n=a(t.x,t.y),r=Math.pow(2,.01*t.deltaY),i=a(-t.x,-t.y);return e.camera=d(e.camera,n,c(r,r),i),{state:e,render:!0}})(e,t);case p.CLICKED_INPUT:return((e,t)=>{if(e.draggedNode=t.inputPath.nodeIndex,e.selectedOutput){const n=e.graph.edges.length;e.graph.edges.push({input:t.inputPath,output:e.selectedOutput});{const{nodeIndex:t,outputIndex:r}=e.selectedOutput,i=e.graph.nodes[t].outputs[r];i.edgeIndices.push(n),i.selected=!1}{const{nodeIndex:r,inputIndex:i}=t.inputPath;e.graph.nodes[r].inputs[i].edgeIndices.push(n)}return e.selectedOutput=null,e.draggedNode=null,{state:e,render:!0}}if(e.selectedInput){const{nodeIndex:t,inputIndex:n}=e.selectedInput;e.graph.nodes[t].inputs[n].selected=!1}const{nodeIndex:n,inputIndex:r}=t.inputPath;return e.graph.nodes[n].inputs[r].selected=!0,e.selectedInput=t.inputPath,{state:e,render:!0}})(e,t);case p.CLICKED_OUTPUT:return((e,t)=>{if(e.draggedNode=t.outputPath.nodeIndex,e.selectedInput){const n=e.graph.edges.length;e.graph.edges.push({input:e.selectedInput,output:t.outputPath});{const{nodeIndex:t,inputIndex:r}=e.selectedInput,i=e.graph.nodes[t].inputs[r];i.edgeIndices.push(n),i.selected=!1}{const{nodeIndex:r,outputIndex:i}=t.outputPath;e.graph.nodes[r].outputs[i].edgeIndices.push(n)}return e.selectedInput=null,e.draggedNode=null,{state:e,render:!0}}if(e.selectedOutput){const{nodeIndex:t,outputIndex:n}=e.selectedOutput;e.graph.nodes[t].outputs[n].selected=!1}const{nodeIndex:n,outputIndex:r}=t.outputPath;return e.graph.nodes[n].outputs[r].selected=!0,e.selectedOutput=t.outputPath,{state:e,render:!0}})(e,t);case p.DOUBLE_CLICK_TIMEOUT:return((e,t)=>(e.potentialDoubleClick&&(e.potentialDoubleClick=!1),{state:e}))(e);case p.DOUBLE_CLICK:return((e,{pointer:t})=>(e.potentialDoubleClick=!1,e.finder.show=!0,e.nodePlacementLocation={x:t.x,y:t.y},{state:E(e),render:!0}))(e,t);case p.KEYDOWN:return((e,{key:t})=>{if(e.finder.show){switch(t){case"Backspace":e.finder.search=e.finder.search.slice(0,-1);break;case"Shift":case"Alt":case"Control":case"Meta":case"Tab":break;case"Enter":if(e.finder.options.length>0){const t=e.finder.options[0];e=m(e,t)}else e=f(e);break;case"Escape":e=f(e);break;default:e.finder.search+=t}return{state:E(e),render:!0}}return"f"==t?(e.finder.show=!0,{state:E(e),render:!0}):{state:e}})(e,t);case p.VIRTUAL_KEYDOWN:return((e,{key:t})=>{if(e.finder.show){switch(t){case"del":e.finder.search=e.finder.search.slice(0,-1);break;case"sft":break;case"space":e.finder.search+=" ";break;case"ret":if(e.finder.options.length>0){const t=e.finder.options[0];e=m(e,t)}else e=f(e);break;default:e.finder.search+=t}return{state:E(e),render:!0}}return{state:e}})(e,t);case p.CLICKED_FINDER_OPTION:return((e,{option:t})=>({state:m(e,t),render:!0}))(e,t)}}));"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>{e.getCoalescedEvents().forEach((e=>{ve({kind:p.POINTER_MOVE,pointer:ye(e)})}))})):document.addEventListener("pointermove",(e=>ve({kind:p.POINTER_MOVE,pointer:ye(e)}))),document.addEventListener("pointerdown",(e=>{ve({kind:p.POINTER_DOWN,pointer:ye(e)})})),document.addEventListener("pointerup",(e=>{ve({kind:p.POINTER_UP,pointer:ye(e)})})),document.addEventListener("wheel",(e=>{e.preventDefault(),ve({kind:p.WHEEL,x:e.clientX,y:e.clientY,deltaY:e.deltaY})}),{passive:!1}),document.addEventListener("contextmenu",(e=>{e.preventDefault()})),document.addEventListener("touchend",(()=>{document.body.requestFullscreen()})),document.addEventListener("keydown",(e=>{e.preventDefault(),ve({kind:p.KEYDOWN,key:e.key})}));
//# sourceMappingURL=index.cce12661.js.map

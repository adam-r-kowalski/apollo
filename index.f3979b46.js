let e;var t;let r;var n;(t=e||(e={}))[t.START=0]="START",t[t.CENTER=1]="CENTER",t[t.END=2]="END",t[t.SPACE_EVENLY=3]="SPACE_EVENLY",t[t.SPACE_BETWEEN=4]="SPACE_BETWEEN",(n=r||(r={}))[n.START=0]="START",n[n.CENTER=1]="CENTER",n[n.END=2]="END";const i=({width:e,height:t})=>[2/e,0,-1,0,-2/t,1,0,0,1],s=(e,t)=>[1,0,e,0,1,t,0,0,1],o=(e,t)=>[e,0,0,0,t,0,0,0,1],c=(...e)=>{const[t,...r]=e;return r.reduce(((e,t)=>{const r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],c=e[5],a=e[6],h=e[7],d=e[8],l=t[0],u=t[1],x=t[2],p=t[3],g=t[4],m=t[5],f=t[6],E=t[7],y=t[8];return[r*l+n*p+i*f,r*u+n*g+i*E,r*x+n*m+i*y,s*l+o*p+c*f,s*u+o*g+c*E,s*x+o*m+c*y,a*l+h*p+d*f,a*u+h*g+d*E,a*x+h*m+d*y]}),t)},a=(e,t)=>{const r=e[0],n=e[1],i=e[2],s=e[3],o=e[4],c=e[5],a=e[6],h=e[7],d=e[8],l=t[0],u=t[1],x=t[2];return[r*l+n*u+i*x,s*l+o*u+c*x,a*l+h*u+d*x]},h=e=>{const t=e[0],r=e[1],n=e[2],i=e[3],s=e[4],o=e[5],c=e[6],a=e[7],h=e[8],d=r*o-n*s,l=t*o-n*i,u=t*s-r*i,x=1/(c*d-a*l+h*u);return[x*(s*h-o*a),x*-(r*h-n*a),x*d,x*-(i*h-o*c),x*(t*h-n*c),x*-l,x*(i*a-s*c),x*-(t*a-r*c),x*u]},d=([e,t,r])=>Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(r,2));let l;var u;(u=l||(l={}))[u.POINTER_MOVE=0]="POINTER_MOVE",u[u.POINTER_DOWN=1]="POINTER_DOWN",u[u.POINTER_UP=2]="POINTER_UP",u[u.CLICKED_NODE=3]="CLICKED_NODE",u[u.WHEEL=4]="WHEEL",u[u.CLICKED_INPUT=5]="CLICKED_INPUT",u[u.CLICKED_OUTPUT=6]="CLICKED_OUTPUT",u[u.DOUBLE_CLICK_TIMEOUT=7]="DOUBLE_CLICK_TIMEOUT",u[u.DOUBLE_CLICK=8]="DOUBLE_CLICK";const x=(e,t)=>{if(!e.dragging)return{state:e,rerender:!1};const r=e.pointers.findIndex((e=>e.id===t.pointer.id)),n=e.pointers[r];if(e.pointers[r]=t.pointer,1===e.pointers.length){const r=t.pointer.x-n.x,i=t.pointer.y-n.y;if(null!==e.draggedNode){const t=d(a(e.camera,[0,1,0])),n=e.graph.nodes[e.draggedNode];n.x+=r*t,n.y+=i*t}else e.camera=c(e.camera,s(-r,-i));return{state:e,render:!0}}if(2===e.pointers.length){const[t,r]=[e.pointers[0],e.pointers[1]],[n,i]=[t.x,t.y],[a,h]=[r.x,r.y],d=Math.sqrt(Math.pow(a-n,2)+Math.pow(h-i,2)),l=e.pointerDistance,u=e.pointerCenter;e.pointerDistance=d;const x=(t.x+r.x)/2,p=(t.y+r.y)/2;if(e.pointerCenter=[x,p],l>0){const t=s(x,p),r=Math.pow(2,.01*(l-d)),n=s(-x,-p),i=x-u[0],a=p-u[1];return e.camera=c(e.camera,t,o(r,r),n,s(-i,-a)),{state:e,render:!0}}return{state:e}}return{state:e}};class p{constructor(e,t,r,n){this.top=e,this.right=t,this.bottom=r,this.left=n}}const g=e=>new p(e,e,e,e),m=({x0:e,y0:t,x1:r,y1:n},i)=>e<=i.x&&i.x<=r&&t<=i.y&&i.y<=n,f=(e,t)=>{for(let r=e.clickHandlers.length;r>0;--r)for(const{onClick:n,worldSpace:i}of e.clickHandlers[r-1])if(m(i,t))return n(t),e;return e},E=e=>({vertices:[],colors:[],vertexIndices:[],textureIndex:e,textureCoordinates:[],cameraIndex:[]}),y=e=>{const t=[];let r=E(0);for(const n of e)for(const[e,i]of n){r.textureIndex!==e&&(0!==r.vertices.length&&t.push(r),r=E(e));for(const e of i){const t=r.vertices.length/2;r.vertices.push(...e.vertices),r.colors.push(...e.colors);for(const n of e.vertexIndices)r.vertexIndices.push(n+t);r.textureCoordinates.push(...e.textureCoordinates),r.cameraIndex.push(...e.cameraIndex)}}return 0!==r.vertices.length&&t.push(r),t};class A{constructor(){const e=[1,0,0,0,1,0,0,0,1];this.cameras=[[1,0,0,0,1,0,0,0,1]],this.stack=[0],this.transform=h(e)}pushCamera=e=>{const t=this.cameras.length;this.cameras.push(e),this.stack.push(t),this.transform=h(e)};popCamera=()=>{this.stack.pop(),this.transform=h(this.cameras[this.activeCamera()])};activeCamera=()=>this.stack.slice(-1)[0];transformWorldSpace=e=>{const[t,r,n]=a(this.transform,[e.x0,e.y0,1]),[i,s,o]=a(this.transform,[e.x1,e.y1,1]);return{x0:t,y0:r,x1:i,y1:s}}}const I=(e,t,r,n)=>{const i=n.initial();for(const s of e.traverse(t,r,0))n.combine(i,s);return i},w={initial:()=>({}),combine:(e,t)=>t.ui.id?(e[t.ui.id]=t.geometry.worldSpace,e):e};function*T(e,t,r){const n=(t.x0+t.x1)/2,i=(t.y0+t.y1)/2,s=n+50,o=i,c=(r.x0+r.x1)/2,a=(r.y0+r.y1)/2,h=c-50,d=a;let l=0,u=0,x=!0;for(const t of e){const e=t*t,r=e*t,p=1-t,g=p*p,m=g*p,f=3*g*t,E=3*p*e,y=m*n+f*s+E*h+r*c,A=m*i+f*o+E*d+r*a;x?(yield y,yield A,x=!1):(yield l,yield u),yield y,yield A,l=y,u=A}}const C=(e,t)=>{const r=((e,t,r)=>{const n=(t-e)/(r-1);return Array.from({length:r},((t,r)=>e+n*r))})(0,1,20),n=[],i=[];for(const{from:s,to:o,color:c}of e){for(const e of T(r,t[s],t[o]))n.push(e);const{red:e,green:a,blue:h,alpha:d}=c;for(let t=0;t<40;++t)i.push(e,a,h,d)}return{vertices:n,colors:i}},R=()=>[],_=(e,t)=>{if(0==t.geometry.vertices.length)return e;const r=t.z-e.length+1;for(let t=0;t<r;++t)e.push(new Map);const n=e[t.z];return(()=>{const e=n.get(t.geometry.textureIndex);if(e)return e;const r=[];return n.set(t.geometry.textureIndex,r),r})().push(t.geometry),e},v=()=>[],S=(e,t)=>{if(!t.ui.onClick)return e;const r=t.z-e.length+1;for(let t=0;t<r;++t)e.push([]);return e[t.z].push({onClick:t.ui.onClick,worldSpace:t.geometry.worldSpace}),e},b=()=>[],D=(e,t)=>t.ui.connections?(e.push(...t.ui.connections),e):e,N={initial:()=>({layers:R(),clickHandlers:v(),idToWorldSpace:w.initial(),connections:b()}),combine:(e,t)=>({layers:_(e.layers,t),clickHandlers:S(e.clickHandlers,t),idToWorldSpace:w.combine(e.idToWorldSpace,t),connections:D(e.connections,t)})},z=(e,t)=>{const{width:r,height:n}=e.size;e.clear();const i={minWidth:0,maxWidth:r,minHeight:0,maxHeight:n},s=t.layout(i,e.measureText),o=new A,c=t.geometry(s,{x:0,y:0},o),{layers:a,clickHandlers:h,connections:d,idToWorldSpace:l}=I(t,s,c,N),u=y(a),x=C(d,l);e.cameras=o.cameras,e.clickHandlers=h;for(const t of u)e.draw(t);return x.vertices.length&&e.drawLines(x),e};class U{constructor(e,t,r,n,i,s,o,c){this.window=e,this.document=t,this.canvas=r,this.gl=n,this.program=i,this.textures=s,this.textMeasurementsCache=o,this.clickHandlers=c,this.clear=()=>{const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)},this.draw=({vertices:e,colors:t,vertexIndices:r,textureCoordinates:n,textureIndex:i,cameraIndex:s})=>{const{gl:o,program:c,textures:a}=this,{attributes:h}=c,d=a[i];o.bindTexture(o.TEXTURE_2D,d),o.bindBuffer(o.ARRAY_BUFFER,h.vertices.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,h.colors.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,h.textureCoordinates.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,h.cameraIndex.buffer),o.bufferData(o.ARRAY_BUFFER,new Uint8Array(s),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,h.vertexIndices),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),o.STATIC_DRAW),o.drawElements(o.TRIANGLES,r.length,o.UNSIGNED_SHORT,0)},this.drawLines=({vertices:e,colors:t})=>{const{gl:r,program:n,textures:i}=this,{attributes:s}=n,o=i[0],c=e.length/2;r.bindTexture(r.TEXTURE_2D,o),r.bindBuffer(r.ARRAY_BUFFER,s.vertices.buffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(e),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,s.colors.buffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(t),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,s.textureCoordinates.buffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(Array(2*c).fill(0)),r.STATIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,s.cameraIndex.buffer),r.bufferData(r.ARRAY_BUFFER,new Uint8Array(Array(c).fill(0)),r.STATIC_DRAW),r.drawArrays(r.LINES,0,c)},this.getTextureMeasurements=(e,t)=>{const{document:r,gl:n}=this,i=`${t} ${e.size} ${e.family}`,s=this.textMeasurementsCache.get(i);if(s)return s;const{texture:o,widths:c,textureCoordinates:a}=((e,t,r,n)=>{const i=e.createElement("canvas"),s=i.getContext("2d"),o=Math.sqrt(256),c=(e=>{let t=1;for(;t<e;)t<<=1;return t})(r.size*o),a=c/o;i.width=c*n,i.height=c*n,i.style.width=`${c}px`,i.style.height=`${c}px`,s.scale(n,n),s.textAlign="left",s.textBaseline="top",s.font=`${r.size}px ${r.family}`,s.fillStyle="white",s.clearRect(0,0,s.canvas.width,s.canvas.height);const h=r.size,d=[],l=[];for(let e=0;e<256;++e){const t=String.fromCharCode(e),r=s.measureText(t),n=Math.ceil(r.width),i=e%o*a,u=Math.floor(e/o)*a;s.fillText(t,i,u),d.push(n);const x=i/c,p=(i+n)/c,g=u/c,m=(u+h)/c;l.push([x,g,x,m,p,g,p,m])}const u=t.createTexture();return t.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{widths:d,textureCoordinates:l,texture:u}})(r,n,e,t),h=this.textures.length;this.textures.push(o);const d={widths:c,textureIndex:h,textureCoordinates:a};return this.textMeasurementsCache.set(i,d),d},this.measureText=(e,t)=>{const{window:r}=this,n=r.devicePixelRatio,{widths:i,textureIndex:s,textureCoordinates:o}=this.getTextureMeasurements(e,n),c=((e,t)=>{let r=[];for(let n=0;n<e.length;++n)r.push(t(e[n],n));return r})(t,(e=>e.charCodeAt(0)));return{widths:c.map((e=>i[e])),textureIndex:s,textureCoordinates:c.map((e=>o[e]))}}}set size(e){const{gl:t,program:r,window:n}=this,{uniforms:s}=r,{canvas:o}=t;t.uniformMatrix3fv(s.projection,!0,i(e)),o.width=e.width*n.devicePixelRatio,o.height=e.height*n.devicePixelRatio,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`,t.viewport(0,0,o.width,o.height),this._size=e}get size(){return this._size}set cameras(e){const{gl:t,program:r}=this,{uniforms:n}=r,i=[];for(const t of e)i.push(...t);t.uniformMatrix3fv(n.cameras,!0,i),this._cameras=e}get cameras(){return this._cameras}}const L=({width:e,height:t,document:r,window:n})=>{const i=r.createElement("canvas");i.style.touchAction="none";const s=i.getContext("webgl2");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.clearColor(0,0,0,1);const o=(e=>{const t={vertices:{location:0,buffer:e.createBuffer()},colors:{location:1,buffer:e.createBuffer()},textureCoordinates:{location:2,buffer:e.createBuffer()},cameraIndex:{location:3,buffer:e.createBuffer()},vertexIndices:e.createBuffer()},r=((e,t)=>{const{vertices:r,colors:n,textureCoordinates:i,cameraIndex:s}=t,o=`#version 300 es\n  uniform mat3 u_projection;\n  uniform mat3 u_cameras[8];\n\n  layout(location = ${r.location}) in vec2 a_vertex;\n  layout(location = ${n.location}) in vec4 a_color;\n  layout(location = ${i.location}) in vec2 a_textureCoordinates;\n  layout(location = ${s.location}) in uint a_cameraIndex;\n\n  out vec4 v_color;\n  out vec2 v_textureCoordinates;\n\n  void main() {\n    mat3 camera = u_cameras[a_cameraIndex];\n    mat3 transform = u_projection * inverse(camera);\n    gl_Position = vec4((transform * vec3(a_vertex, 1)).xy, 0, 1);\n    v_color = a_color / 255.0;\n    v_textureCoordinates = a_textureCoordinates;\n  }\n  `,c=e.createShader(e.VERTEX_SHADER);return e.shaderSource(c,o),e.compileShader(c),c})(e,t),n=(e=>{const t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec4 v_color;\n  in vec2 v_textureCoordinates;\n\n  out vec4 fragColor;\n  \n  void main() {\n    fragColor = texture(u_texture, v_textureCoordinates) * v_color;\n  }\n  "),e.compileShader(t),t})(e),i=e.createProgram();e.attachShader(i,r),e.attachShader(i,n),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.log(e.getShaderInfoLog(r)),console.log(e.getShaderInfoLog(n))),e.useProgram(i);const s=e.createVertexArray();return e.bindVertexArray(s),((e,t,{location:r,buffer:n})=>{e.bindAttribLocation(t,r,"a_vertex"),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0)})(e,i,t.vertices),((e,t,{location:r,buffer:n})=>{e.bindAttribLocation(t,r,"a_color"),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(r,4,e.FLOAT,!1,0,0)})(e,i,t.colors),((e,t,{location:r,buffer:n})=>{e.bindAttribLocation(t,r,"a_textureCoordinates"),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribPointer(r,2,e.FLOAT,!1,0,0)})(e,i,t.textureCoordinates),((e,t,{location:r,buffer:n})=>{e.bindAttribLocation(t,r,"a_cameraIndex"),e.enableVertexAttribArray(r),e.bindBuffer(e.ARRAY_BUFFER,n),e.vertexAttribIPointer(r,1,e.UNSIGNED_BYTE,0,0)})(e,i,t.cameraIndex),{vertexShader:r,fragmentShader:n,program:i,attributes:t,uniforms:{projection:e.getUniformLocation(i,"u_projection"),texture:e.getUniformLocation(i,"u_texture"),cameras:e.getUniformLocation(i,"u_cameras")}}})(s),c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const a=new U(n,r,i,s,o,[c],new Map,[]);return a.size={width:e,height:t},a},P=e=>({x:e.clientX,y:e.clientY,id:e.pointerId});class B{constructor(e,t){this.size=e,this.child=t}}class O{constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.child=c}}class F{constructor(e){this.child=e}layout(e,t){const r=this.child.layout(e,t),n=e.maxWidth,i=e.maxHeight;return new B({width:n,height:i},r)}geometry(e,t,r){const n=r.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),i=e.child,s={x:t.x+e.size.width/2-i.size.width/2,y:t.y+e.size.height/2-i.size.height/2};return((e,t)=>new O(e,0,[],[],[],[],[],t))(n,this.child.geometry(i,s,r))}*traverse(e,t,r){const n=e.child,i=t.child;yield{ui:this,layout:e,geometry:t,z:r},yield*this.child.traverse(n,i,r+1)}}class W{constructor(e,t,r){this.size=e,this.totalChildHeight=t,this.children=r}}class k{constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=c}}class M{constructor(e,t,r){this.mainAxisAlignment=e,this.crossAxisAlignment=t,this.children=r}layout(t,r){const n={children:[],width:0,totalChildHeight:0},i=this.children.reduce(((e,n)=>{const i=n.layout(t,r);return e.children.push(i),e.totalChildHeight+=i.size.height,e.width=Math.max(e.width,i.size.width),e}),n),{children:s,width:o,totalChildHeight:c}=i;return((e,t,r)=>new W(e,t,r))({width:o,height:this.mainAxisAlignment==e.START?c:t.maxHeight},c,s)}geometry(t,n,i){const s=t,o=t.size.height-s.totalChildHeight,c={children:[],y:(()=>{switch(this.mainAxisAlignment){case e.START:return n.y;case e.CENTER:return n.y+o/2;case e.END:return n.y+o;case e.SPACE_EVENLY:return n.y+o/(this.children.length+1);case e.SPACE_BETWEEN:return n.y}})()},a=e=>e.size.height,h=e=>e.size.height,d=e=>e.size.height,l=e=>e.size.height+o/(this.children.length+1),u=e=>e.size.height+o/(this.children.length-1),x=(()=>{switch(this.mainAxisAlignment){case e.START:return a;case e.CENTER:return h;case e.END:return d;case e.SPACE_EVENLY:return l;case e.SPACE_BETWEEN:return u}})(),p=e=>n.x,g=e=>n.x+t.size.width/2-e.size.width/2,m=e=>n.x+t.size.width-e.size.width,f=(()=>{switch(this.crossAxisAlignment){case r.START:return p;case r.CENTER:return g;case r.END:return m}})(),E=this.children.reduce(((e,t,r)=>{const n=s.children[r],o={x:f(n),y:e.y},c=t.geometry(n,o,i);return e.children.push(c),e.y+=x(n),e}),c);return((e,t)=>new k(e,0,[],[],[],[],[],t))(i.transformWorldSpace({x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),E.children)}*traverse(e,t,r){const n=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:r};const s=r+1;let o=0;for(const e of this.children)yield*e.traverse(n[o],i[o],s),o+=1}}const Y=(...t)=>{const[n,i]=t[0]instanceof Array?[{},t[0]]:[t[0],t[1]];return new M(n.mainAxisAlignment??e.START,n.crossAxisAlignment??r.START,i)};class H{constructor(e,t){this.size=e,this.child=t}}const K=(e,t)=>new H(e,t);class ${constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.child=c}}const V=(e,t)=>{const r=e.vertices??[];return new $(e.worldSpace,e.textureIndex??0,e.textureCoordinates??Array.from({length:r.length}).fill(0),e.colors??[],r,e.vertexIndices??[],e.cameraIndex??[],t)};class X{constructor(e,t,r,n,i,s,o,c,a){this.padding=e,this.width=t,this.height=r,this.x=n,this.y=i,this.color=s,this.onClick=o,this.id=c,this.child=a}layout(e,t){const{left:r,top:n,right:i,bottom:s}=this.padding;if(this.child){const o=this.child.layout(e,t),c=this.width??o.size.width+r+i,a=this.height??o.size.height+n+s;return K({width:c,height:a},o)}const o=(()=>this.width?this.width+r+i:e.maxWidth)(),c=(()=>this.height?this.height+n+s:e.maxHeight)();return K({width:o,height:c})}geometry(e,t,r){const n=t.x+(this.x??0),i=n+e.size.width,s=t.y+(this.y??0),o=s+e.size.height,c=r.transformWorldSpace({x0:n,x1:i,y0:s,y1:o}),a=(()=>{if(this.color){const{red:e,green:t,blue:a,alpha:h}=this.color;return{worldSpace:c,vertices:[n,s,n,o,i,s,i,o],colors:[e,t,a,h,e,t,a,h,e,t,a,h,e,t,a,h],vertexIndices:[0,1,2,1,2,3],cameraIndex:Array(4).fill(r.activeCamera())}}return{worldSpace:c,vertices:[],colors:[],vertexIndices:[],cameraIndex:[]}})();if(this.child){const t=e.child,i={x:n+this.padding.left,y:s+this.padding.top},o=this.child.geometry(t,i,r);return V(a,o)}return V(a)}*traverse(e,t,r){if(yield{ui:this,layout:e,geometry:t,z:r},this.child){const n=e.child,i=t.child;yield*this.child.traverse(n,i,r+1)}}}const G=({padding:e,width:t,height:r,color:n,x:i,y:s,onClick:o,id:c},a)=>new X(e??g(0),t,r,i,s,n,o,c,a);class q{constructor(e,t,r){this.size=e,this.totalChildWidth=t,this.children=r}}class j{constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=c}}class J{constructor(e,t,r){this.mainAxisAlignment=e,this.crossAxisAlignment=t,this.children=r}layout(t,r){const n={children:[],totalChildWidth:0,height:0},i=this.children.reduce(((e,n)=>{const i=n.layout(t,r);return e.children.push(i),e.totalChildWidth+=i.size.width,e.height=Math.max(e.height,i.size.height),e}),n),{children:s,totalChildWidth:o,height:c}=i;return((e,t,r)=>new q(e,t,r))({width:this.mainAxisAlignment==e.START?o:t.maxWidth,height:c},o,s)}geometry(t,n,i){const s=t,o=t.size.width-s.totalChildWidth,c={children:[],x:(()=>{switch(this.mainAxisAlignment){case e.START:return n.x;case e.CENTER:return n.x+o/2;case e.END:return n.x+o;case e.SPACE_EVENLY:return n.x+o/(this.children.length+1);case e.SPACE_BETWEEN:return n.x}})()},a=e=>e.size.width,h=e=>e.size.width,d=e=>e.size.width,l=e=>e.size.width+o/(this.children.length+1),u=e=>e.size.width+o/(this.children.length-1),x=(()=>{switch(this.mainAxisAlignment){case e.START:return a;case e.CENTER:return h;case e.END:return d;case e.SPACE_EVENLY:return l;case e.SPACE_BETWEEN:return u}})(),p=e=>n.y,g=e=>n.y+t.size.height/2-e.size.height/2,m=e=>n.y+t.size.height-e.size.height,f=(()=>{switch(this.crossAxisAlignment){case r.START:return p;case r.CENTER:return g;case r.END:return m}})(),E=this.children.reduce(((e,t,r)=>{const n=s.children[r],o={x:e.x,y:f(n)},c=t.geometry(n,o,i);return e.children.push(c),e.x+=x(n),e}),c);return((e,t)=>new j(e,0,[],[],[],[],[],t))(i.transformWorldSpace({x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),E.children)}*traverse(e,t,r){const n=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:r};const s=r+1;let o=0;for(const e of this.children)yield*e.traverse(n[o],i[o],s),o+=1}}const Q=(...t)=>{const[n,i]=t[0]instanceof Array?[{},t[0]]:[t[0],t[1]];return new J(n.mainAxisAlignment??e.START,n.crossAxisAlignment??r.START,i)};class Z{constructor(e,t){this.size=e,this.children=t}}class ee{constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=c}}class te{constructor(e,t,r){this.camera=e,this.children=t,this.connections=r}layout(e,t){const r=this.children.map((r=>r.layout(e,t)));return((e,t)=>new Z(e,t))({width:e.maxWidth,height:e.maxHeight},r)}geometry(e,t,r){const n=r.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),i=e.children;r.pushCamera(this.camera);const s=this.children.map(((e,n)=>e.geometry(i[n],t,r)));return r.popCamera(),((e,t)=>new ee(e,0,[],[],[],[],[],t))(n,s)}*traverse(e,t,r){const n=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:r};let s=0;for(const e of this.children){for(const t of e.traverse(n[s],i[s],r))yield t,r=Math.max(r,t.z);s++,r++}}}class re{constructor(e,t){this.size=e,this.children=t}}class ne{constructor(e,t,r,n,i,s,o,c){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=c}}class ie{constructor(e){this.children=e}layout(e,t){const r=this.children.map((r=>r.layout(e,t)));return((e,t)=>new re(e,t))({width:e.maxWidth,height:e.maxHeight},r)}geometry(e,t,r){const n=e,i=this.children.map(((e,i)=>e.geometry(n.children[i],t,r)));return((e,t)=>new ne(e,0,[],[],[],[],[],t))(r.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),i)}*traverse(e,t,r){const n=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:r};let s=0;for(const e of this.children){for(const t of e.traverse(n[s],i[s],r))yield t,r=Math.max(r,t.z);s+=1,r+=1}}}class se{constructor(e,t){this.measurements=e,this.size=t}}class oe{constructor(e,t,r,n,i,s,o){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=r,this.colors=n,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o}}const ce=(e,t,r)=>{const n=[];let i=r.x;const s=r.y,o=r.y+t;for(const t of e){const e=i,r=i+t;n.push(e,s,e,o,r,s,r,o),i+=t}return n},ae=(e,{red:t,green:r,blue:n,alpha:i})=>{const s=[];for(let o=0;o<e;++o)s.push(t,r,n,i,t,r,n,i,t,r,n,i,t,r,n,i);return s},he=e=>{const t=[];let r=0;for(let n=0;n<e;++n)t.push(r,r+1,r+2,r+1,r+2,r+3),r+=4;return t};class de{constructor(e,t,r){this.font=e,this.color=t,this.str=r}layout(e,t){const{font:r,str:n}=this,i=t(r,n),s=i.widths.reduce(((e,t)=>e+t));return((e,t)=>new se(e,t))(i,{width:s,height:r.size})}geometry(e,t,r){const n=e,{measurements:i}=n,{textureIndex:s,textureCoordinates:o,widths:c}=i;return a={worldSpace:r.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),textureIndex:s,textureCoordinates:o.flat(),colors:ae(c.length,this.color),vertices:ce(c,this.font.size,t),vertexIndices:he(c.length),cameraIndex:Array(4*c.length).fill(r.activeCamera())},new oe(a.worldSpace,a.textureIndex,a.textureCoordinates,a.colors,a.vertices,a.vertexIndices,a.cameraIndex);var a}*traverse(e,t,r){yield{ui:this,layout:e,geometry:t,z:r}}}const le=(...e)=>{const[t,r]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]],n={family:t.font??"monospace",size:t.size??24};return new de(n,t.color??{red:255,green:255,blue:255,alpha:255},r)},ue=e=>G({width:e,height:e}),xe=(e,t)=>{const r=[e[0]];for(const n of e.slice(1))r.push(t,n);return r},pe=(e,t,n)=>Y(xe(t.map(((t,i)=>((e,{name:t,selected:n},i,s)=>Q({crossAxisAlignment:r.CENTER},[G({id:`input ${i} ${s}`,width:24,height:24,color:n?e.selectedInput:e.input,onClick:()=>Ee({kind:l.CLICKED_INPUT,inputPath:{nodeIndex:i,inputIndex:s}})}),ue(10),le(t)]))(e,t,n,i))),ue(10))),ge=(e,t,n)=>Y(xe(t.map(((t,i)=>((e,{name:t,selected:n},i,s)=>Q({crossAxisAlignment:r.CENTER},[le(t),ue(10),G({id:`output ${i} ${s}`,width:24,height:24,color:n?e.selectedInput:e.input,onClick:()=>Ee({kind:l.CLICKED_OUTPUT,outputPath:{nodeIndex:i,outputIndex:s}})})]))(e,t,n,i))),ue(10))),me=(e,t,{name:n,x:i,y:s,inputs:o,outputs:c},a)=>{const h=[];return o.length&&h.push(pe(t,o,a)),o.length&&c.length&&h.push(ue(30)),c.length&&h.push(ge(t,c,a)),G({color:t.node,padding:g(10),x:i,y:s,onClick:()=>e({kind:l.CLICKED_NODE,index:a})},Y({crossAxisAlignment:r.CENTER},[le(n),ue(10),Q(h)]))},fe=e=>{return t=G({color:e.node,padding:g(10)},Y([G({color:e.background,width:700,padding:g(10)},le({color:e.input,size:40},"Search Operations...")),G({width:10,height:10}),G({padding:g(10)},le("Add")),G({padding:g(10)},le("Subtract")),G({padding:g(10)},le("Multiply")),G({padding:g(10)},le("Divide")),G({padding:g(10)},le("Equal"))])),new F(t);var t},Ee=((e,t,r)=>{let n=L({width:window.innerWidth,height:window.innerHeight,window:window,document:document}),i=!1;const s=()=>{i||(i=!0,requestAnimationFrame((()=>{n=z(n,t(o,e)),i=!1})))},o=t=>{const{state:n,render:i,schedule:c,dispatch:a}=r(e,t);e=n,i&&s();for(const{after:e,event:t}of c??[]){const{milliseconds:r}=e;setTimeout((()=>o(t)),r)}for(const e of a??[])o(e)};return document.body.appendChild(n.canvas),document.addEventListener("pointerdown",(e=>{n=f(n,P(e))})),window.addEventListener("resize",(()=>{n.size={width:window.innerWidth,height:window.innerHeight},s()})),s(),o})({graph:{nodes:[{name:"Source",inputs:[],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:100,y:200},{name:"Transform",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:400,y:300},{name:"Sink",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[],x:800,y:250}],edges:[]},dragging:!1,draggedNode:null,pointers:[],pointerDistance:0,pointerCenter:[0,0],camera:[1,0,0,0,1,0,0,0,1],selectedOutput:null,selectedInput:null,theme:{background:{red:2,green:22,blue:39,alpha:255},node:{red:41,green:95,blue:120,alpha:255},input:{red:188,green:240,blue:192,alpha:255},selectedInput:{red:175,green:122,blue:208,alpha:255},connection:{red:255,green:255,blue:255,alpha:255}},potentialDoubleClick:!1,showFinder:!1},((e,t)=>{const r=[];if(t.graph.nodes.forEach(((n,i)=>{i!==t.draggedNode&&r.push(me(e,t.theme,n,i))})),null!==t.draggedNode){const n=t.draggedNode;r.push(me(e,t.theme,t.graph.nodes[n],n))}const n=t.graph.edges.map((({input:e,output:r})=>({from:`output ${r.nodeIndex} ${r.outputIndex}`,to:`input ${e.nodeIndex} ${e.inputIndex}`,color:t.theme.connection}))),i=[G({color:t.theme.background}),(s={camera:t.camera,children:r,connections:n},new te(s.camera,s.children,s.connections??[]))];var s;return t.showFinder&&i.push(fe(t.theme)),new ie(i)}),((e,t)=>{switch(t.kind){case l.POINTER_DOWN:return((e,t)=>(e.pointers.push(t.pointer),1===e.pointers.length&&(e.dragging=!0),e.potentialDoubleClick?{state:e,dispatch:[{kind:l.DOUBLE_CLICK}]}:(e.potentialDoubleClick=!0,{state:e,schedule:[{after:{milliseconds:300},event:{kind:l.DOUBLE_CLICK_TIMEOUT}}]})))(e,t);case l.POINTER_UP:return((e,t)=>{const r=e.pointers.findIndex((e=>e.id===t.pointer.id));return e.pointers.splice(r,1),0===e.pointers.length&&(e.dragging=!1,e.draggedNode=null,e.pointerDistance=0),{state:e}})(e,t);case l.POINTER_MOVE:return x(e,t);case l.CLICKED_NODE:return((e,t)=>(e.draggedNode=t.index,{state:e,render:!0}))(e,t);case l.WHEEL:return((e,t)=>{const r=s(t.x,t.y),n=Math.pow(2,.01*t.deltaY),i=s(-t.x,-t.y);return e.camera=c(e.camera,r,o(n,n),i),{state:e,render:!0}})(e,t);case l.CLICKED_INPUT:return((e,t)=>{if(e.draggedNode=t.inputPath.nodeIndex,e.selectedOutput){const r=e.graph.edges.length;e.graph.edges.push({input:t.inputPath,output:e.selectedOutput});{const{nodeIndex:t,outputIndex:n}=e.selectedOutput,i=e.graph.nodes[t].outputs[n];i.edgeIndices.push(r),i.selected=!1}{const{nodeIndex:n,inputIndex:i}=t.inputPath;e.graph.nodes[n].inputs[i].edgeIndices.push(r)}return e.selectedOutput=null,{state:e,render:!0}}if(e.selectedInput){const{nodeIndex:t,inputIndex:r}=e.selectedInput;e.graph.nodes[t].inputs[r].selected=!1}const{nodeIndex:r,inputIndex:n}=t.inputPath;return e.graph.nodes[r].inputs[n].selected=!0,e.selectedInput=t.inputPath,{state:e,render:!0}})(e,t);case l.CLICKED_OUTPUT:return((e,t)=>{if(e.draggedNode=t.outputPath.nodeIndex,e.selectedInput){const r=e.graph.edges.length;e.graph.edges.push({input:e.selectedInput,output:t.outputPath});{const{nodeIndex:t,inputIndex:n}=e.selectedInput,i=e.graph.nodes[t].inputs[n];i.edgeIndices.push(r),i.selected=!1}{const{nodeIndex:n,outputIndex:i}=t.outputPath;e.graph.nodes[n].outputs[i].edgeIndices.push(r)}return e.selectedInput=null,{state:e,render:!0}}if(e.selectedOutput){const{nodeIndex:t,outputIndex:r}=e.selectedOutput;e.graph.nodes[t].outputs[r].selected=!1}const{nodeIndex:r,outputIndex:n}=t.outputPath;return e.graph.nodes[r].outputs[n].selected=!0,e.selectedOutput=t.outputPath,{state:e,render:!0}})(e,t);case l.DOUBLE_CLICK_TIMEOUT:return((e,t)=>(e.potentialDoubleClick&&(e.potentialDoubleClick=!1),{state:e}))(e);case l.DOUBLE_CLICK:return((e,t)=>(e.potentialDoubleClick=!1,e.showFinder=!0,{state:e,render:!0}))(e)}}));"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>{e.getCoalescedEvents().forEach((e=>{Ee({kind:l.POINTER_MOVE,pointer:P(e)})}))})):document.addEventListener("pointermove",(e=>Ee({kind:l.POINTER_MOVE,pointer:P(e)}))),document.addEventListener("pointerdown",(e=>{Ee({kind:l.POINTER_DOWN,pointer:P(e)})})),document.addEventListener("pointerup",(e=>{Ee({kind:l.POINTER_UP,pointer:P(e)})})),document.addEventListener("wheel",(e=>{e.preventDefault(),Ee({kind:l.WHEEL,x:e.clientX,y:e.clientY,deltaY:e.deltaY})}),{passive:!1}),document.addEventListener("contextmenu",(e=>{e.preventDefault()})),document.addEventListener("touchend",(()=>{document.body.requestFullscreen()}));
//# sourceMappingURL=index.f3979b46.js.map

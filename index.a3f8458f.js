function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var e={};t(e,"Vec3",(()=>n)),t(e,"Mat3",(()=>i));class n{constructor(t){this.data=t}}class i{constructor(t){this.data=t,this.matMul=t=>{const e=this.data,n=t.data,s=e[0],o=e[1],r=e[2],a=e[3],c=e[4],h=e[5],l=e[6],d=e[7],u=e[8],g=n[0],f=n[1],w=n[2],m=n[3],x=n[4],A=n[5],R=n[6],y=n[7],p=n[8];return new i([s*g+o*m+r*R,s*f+o*x+r*y,s*w+o*A+r*p,a*g+c*m+h*R,a*f+c*x+h*y,a*w+c*A+h*p,l*g+d*m+u*R,l*f+d*x+u*y,l*w+d*A+u*p])},this.vecMul=t=>{const e=this.data,i=t.data,s=e[0],o=e[1],r=e[2],a=e[3],c=e[4],h=e[5],l=e[6],d=e[7],u=e[8],g=i[0],f=i[1],w=i[2];return new n([s*g+o*f+r*w,a*g+c*f+h*w,l*g+d*f+u*w])},this.inverse=()=>{const t=this.data,e=t[0],n=t[1],s=t[2],o=t[3],r=t[4],a=t[5],c=t[6],h=t[7],l=t[8],d=n*a-s*r,u=e*a-s*o,g=e*r-n*o,f=1/(c*d-h*u+l*g);return new i([f*(r*l-a*h),f*-(n*l-s*h),f*d,f*-(o*l-a*c),f*(e*l-s*c),f*-u,f*(o*h-r*c),f*-(e*h-n*c),f*g])}}static identity=()=>new i([1,0,0,0,1,0,0,0,1]);static projection=(t,e)=>new i([2/t,0,-1,0,-2/e,1,0,0,1]);static translation=(t,e)=>new i([1,0,t,0,1,e,0,0,1]);static rotation=t=>{const e=Math.cos(t),n=Math.sin(t);return new i([e,n,0,-n,e,0,0,0,1])};static scaling=(t,e)=>new i([t,0,0,0,e,0,0,0,1])}var s={};t(s,"ECS",(()=>xt)),t(s,"Entity",(()=>mt)),t(s,"Renderer",(()=>h)),t(s,"systems",(()=>o)),t(s,"components",(()=>l)),t(s,"ui",(()=>V)),t(s,"Layers",(()=>k)),t(s,"linear_algebra",(()=>e));var o={};t(o,"render",(()=>H)),t(o,"layout",(()=>G)),t(o,"geometry",(()=>O));class r{constructor(t){const e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,"#version 300 es\n  uniform float u_devicePixelRatio;\n  uniform mat3 u_matrices[10];\n\n  layout(location = 0) in vec2 a_position;\n  layout(location = 1) in vec2 a_textureCoordinates;\n  layout(location = 2) in vec4 a_color;\n  layout(location = 3) in uint a_matrixIndex;\n\n  out vec2 v_textureCoordinates;\n  out vec4 v_color;\n\n  void main() {\n    gl_Position = vec4((u_matrices[a_matrixIndex] * vec3(a_position, 1)).xy, 0, 1);\n    v_textureCoordinates = a_textureCoordinates * u_devicePixelRatio;\n    v_color = a_color;\n  }\n  "),t.compileShader(e);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec2 v_textureCoordinates;\n  in vec4 v_color;\n\n  out vec4 fragColor;\n  \n  vec4 hslToRgb(in vec4 hsl) {\n    float h = hsl.x / 360.0;\n    vec3 rgb = clamp(abs(mod(h * 6.0 + vec3(0.0,4.0,2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\n    return vec4(hsl.z + hsl.y * (rgb - 0.5) * (1.0 - abs(2.0 * hsl.z - 1.0)), hsl.w);\n  }\n\n  void main() {\n    ivec2 size = textureSize(u_texture, 0);\n    vec2 coordinate = v_textureCoordinates / vec2(float(size.x), float(size.y));\n    fragColor = texture(u_texture, coordinate) * hslToRgb(v_color);\n  }\n  "),t.compileShader(n);const i=t.createProgram();t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||(console.log(t.getShaderInfoLog(e)),console.log(t.getShaderInfoLog(n))),t.useProgram(i);const s=t.createVertexArray();t.bindVertexArray(s),this.positionBuffer=t.createBuffer(),t.bindAttribLocation(i,0,"a_position"),t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),this.textureCoordinatesBuffer=t.createBuffer(),t.bindAttribLocation(i,1,"a_textureCoordinates"),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordinatesBuffer),t.vertexAttribPointer(1,2,t.FLOAT,!1,0,0),this.colorBuffer=t.createBuffer(),t.bindAttribLocation(i,2,"a_color"),t.enableVertexAttribArray(2),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.vertexAttribPointer(2,4,t.FLOAT,!1,0,0),this.matrixIndexBuffer=t.createBuffer(),t.bindAttribLocation(i,3,"a_matrixIndex"),t.enableVertexAttribArray(3),t.bindBuffer(t.ARRAY_BUFFER,this.matrixIndexBuffer),t.vertexAttribIPointer(3,1,t.UNSIGNED_BYTE,0,0),this.indexBuffer=t.createBuffer(),this.devicePixelRatioLocation=t.getUniformLocation(i,"u_devicePixelRatio"),this.matricesLocation=t.getUniformLocation(i,"u_matrices")}}class a{constructor(t,e,n,i){this.texture=t,this.metrics=e,this.fontFamily=n,this.fontSize=i,this.metric=t=>this.metrics[t.charCodeAt(0)]}}const c=(t,e,n,i)=>{const s=document.createElement("canvas"),o=s.getContext("2d"),r=Math.sqrt(256),a=(t=>{let e=1;for(;e<t;)e<<=1;return e})(i*r),c=a/r;s.width=a*window.devicePixelRatio,s.height=a*window.devicePixelRatio,s.style.width=`${a}px`,s.style.height=`${a}px`,o.scale(window.devicePixelRatio,window.devicePixelRatio),o.textAlign="left",o.textBaseline="top",o.font=n,o.fillStyle="white";const h=Array.from({length:256},((t,e)=>e)).map((t=>String.fromCharCode(t)));o.clearRect(0,0,o.canvas.width,o.canvas.height);const l=h.map(((t,e)=>{const n=o.measureText(t),s=Math.ceil(n.width),a=i,h=e%r*c,l=Math.floor(e/r)*c;return o.fillText(t,h,l),{x:h,y:l,width:s,height:a}}));return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),l};class h{constructor(t,e){const n=document.createElement("canvas");n.style.touchAction="none";const i=n.getContext("webgl2");i.clearColor(0,0,0,1),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.activeTexture(i.TEXTURE0),this.gl=i,this.canvas=n,this.program=new r(i),this.fontAtlasses=new Map,this.textures=[],this.devicePixelRatio=window.devicePixelRatio,this.setSize(t,e);const s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.textures.push(s)}setSize=(t,e)=>{const{gl:n,canvas:i}=this;i.width=t*window.devicePixelRatio,i.height=e*window.devicePixelRatio,n.uniform2f(this.program.resolutionLocation,i.width,i.height),n.uniform1f(this.program.devicePixelRatioLocation,window.devicePixelRatio),n.viewport(0,0,i.width,i.height),this.width=t,this.height=e,this.devicePixelRatio!=window.devicePixelRatio&&(this.devicePixelRatio=window.devicePixelRatio,this.recreateFontAtlasses())};clear=()=>{const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)};setMatrices=t=>{const{gl:e}=this,n=[];for(const e of t)n.push(...e.data);e.uniformMatrix3fv(this.program.matricesLocation,!0,n)};draw=({vertices:t,colors:e,textureCoordinates:n,vertexIndices:i,cameraIndices:s})=>{const{gl:o,program:r}=this;o.bindBuffer(o.ARRAY_BUFFER,r.positionBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.colorBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.textureCoordinatesBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r.indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.matrixIndexBuffer),o.bufferData(o.ARRAY_BUFFER,new Uint8Array(s),o.STATIC_DRAW),o.drawElements(o.TRIANGLES,i.length,o.UNSIGNED_SHORT,0)};drawLines=({vertices:t,colors:e,textureCoordinates:n,cameraIndices:i})=>{const{gl:s,program:o}=this;s.bindBuffer(s.ARRAY_BUFFER,o.positionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(t),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,o.colorBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,o.textureCoordinatesBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(n),s.STATIC_DRAW),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o.indexBuffer),s.bindBuffer(s.ARRAY_BUFFER,o.matrixIndexBuffer),s.bufferData(s.ARRAY_BUFFER,new Uint8Array(i),s.STATIC_DRAW),s.drawArrays(s.LINES,0,t.length/2)};recreateFontAtlasses=()=>{for(const[t,e]of this.fontAtlasses){const n=this.textures[e.texture],i=c(this.gl,n,t,e.fontSize);e.metrics=i}};fontAtlas=(t,e)=>{const n=`${e}px ${t}`,i=this.fontAtlasses.get(n);if(i)return i;const{gl:s}=this,o=s.createTexture(),r=c(s,o,n,e),h=this.textures.length;this.textures.push(o);const l=new a(h,r,t,e);return this.fontAtlasses.set(n,l),l}}var l={};t(l,"UIRoot",(()=>d)),t(l,"Text",(()=>u)),t(l,"FontSize",(()=>g)),t(l,"FontFamily",(()=>f)),t(l,"Child",(()=>w)),t(l,"Children",(()=>m)),t(l,"Connections",(()=>x)),t(l,"Camera",(()=>A)),t(l,"Alignment",(()=>R)),t(l,"CrossAxisAlignment",(()=>p)),t(l,"Width",(()=>v)),t(l,"Height",(()=>E)),t(l,"Translate",(()=>T)),t(l,"Transform",(()=>_)),t(l,"Zoom",(()=>B)),t(l,"From",(()=>F)),t(l,"To",(()=>S)),t(l,"Color",(()=>b)),t(l,"Padding",(()=>C)),t(l,"Constraints",(()=>I)),t(l,"Size",(()=>U)),t(l,"Offset",(()=>D)),t(l,"Layout",(()=>M)),t(l,"WorldSpace",(()=>L)),t(l,"Vertices",(()=>P)),t(l,"TextureCoordinates",(()=>Y)),t(l,"Colors",(()=>N)),t(l,"VertexIndices",(()=>z)),t(l,"CameraIndices",(()=>W)),t(l,"Geometry",(()=>X));class d{constructor(t){this.entity=t}}class u{constructor(t){this.value=t}}class g{constructor(t){this.value=t}}class f{constructor(t){this.value=t}}class w{constructor(t){this.entity=t}}class m{constructor(t){this.entities=t}}class x{constructor(t){this.entities=t}}class A{constructor(t){this.entity=t}}let R;var y;(y=R||(R={}))[y.START=0]="START",y[y.CENTER=1]="CENTER",y[y.END=2]="END";class p{constructor(t){this.alignment=t}}class v{constructor(t){this.value=t}}class E{constructor(t){this.value=t}}class T{constructor(t,e){this.x=t,this.y=e}}class _{constructor(t){this.matrix=t}}class B{constructor(t,e,n){this.scale=t,this.x=e,this.y=n}}class F{constructor(t){this.entity=t}}class S{constructor(t){this.entity=t}}class b{constructor({h:t,s:e,l:n,a:i}){this.h=t,this.s=e,this.l=n,this.a=i}}class C{constructor(t){this.value=t}}class I{constructor(t,e,n,i){this.minWidth=t,this.maxWidth=e,this.minHeight=n,this.maxHeight=i}}class U{constructor(t,e){this.width=t,this.height=e}}class D{constructor(t,e){this.x=t,this.y=e,this.add=t=>new D(this.x+t.x,this.y+t.y)}}class M{constructor(t){this.impl=t,this.layout=(t,e)=>this.impl(t,e)}}class L{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}}class P{constructor(t){this.data=t}}class Y{constructor(t){this.data=t}}class N{constructor(t){this.data=t}}class z{constructor(t){this.data=t}}class W{constructor(t){this.data=t}}class X{constructor(t){this.impl=t,this.geometry=(t,e,n,i)=>this.impl(t,e,n,i)}}const H=t=>{const e=performance.now();G(t);const n=O(t),s=t.get(h),o=i.projection(s.width,s.height);s.setMatrices(n.cameras.map((t=>o.matMul(t.inverse())))),s.clear(),((t,e)=>{const{gl:n}=t;let i=[],s=[],o=[],r=[],a=[],c=-1;for(const h of e.layers)for(const[e,l]of h){e!=c&&(i.length&&(t.draw({vertices:i,colors:s,textureCoordinates:o,vertexIndices:r,cameraIndices:a}),i=[],s=[],o=[],r=[],a=[]),c=e,n.bindTexture(n.TEXTURE_2D,t.textures[e]));for(const t of l){const e=i.length/2;i.push(...t.get(P).data),s.push(...t.get(N).data),o.push(...t.get(Y).data);for(const n of t.get(z).data)r.push(e+n);a.push(...t.get(W).data)}}0!=i.length&&t.draw({vertices:i,colors:s,textureCoordinates:o,vertexIndices:r,cameraIndices:a})})(s,n),((t,e)=>{const{gl:n}=t;let i=[],s=[],o=[],r=[];n.bindTexture(n.TEXTURE_2D,t.textures[0]);for(const t of e.lines)i.push(...t.get(P).data),s.push(...t.get(N).data),o.push(...t.get(Y).data),r.push(...t.get(W).data);0!=i.length&&t.drawLines({vertices:i,colors:s,textureCoordinates:o,cameraIndices:r})})(s,n);return performance.now()-e},G=t=>{const{width:e,height:n}=t.get(h),i=t.get(d).entity,s=new I(0,e,0,n);i.get(M).layout(i,s)};class k{constructor(){this.layers=[],this.lines=[],this.cameras=[i.identity()],this.activeCamera=0}pushAndSetActiveCamera=t=>{this.activeCamera=this.cameras.length,this.cameras.push(t)};push=({z:t,texture:e,entity:n})=>{for(let e=this.layers.length;e<t+1;++e)this.layers.push(new Map);const i=this.layers[t],s=i.get(e);s?s.push(n):i.set(e,[n])}}const O=t=>{const e=new k,n=t.get(d).entity;return n.get(X).geometry(n,new D(0,0),e,0),e};var V={};t(V,"text",(()=>j)),t(V,"center",(()=>J)),t(V,"column",(()=>et)),t(V,"row",(()=>st)),t(V,"container",(()=>ct)),t(V,"scene",(()=>ft)),t(V,"connection",(()=>dt));const q=(t,e)=>{const n=((t,e)=>{const n=e.get(u).value,i=e.get(g).value,s=e.get(f).value,o=t.fontAtlas(s,i);let r=new U(0,0);for(const t of n){const e=o.metric(t);r.width+=e.width,r.height=Math.max(e.height,r.height)}return r})(t.ecs.get(h),t);return t.set(e,n,new D(0,0)),n},$=(t,e,n,i)=>{const{width:s,height:o}=t.get(U),r=e.add(t.get(D)),a=((t,e,n,i)=>{const s=e.get(u).value,o=e.get(g).value,r=e.get(f).value,{h:a,s:c,l:h,a:l}=e.get(b),d=t.fontAtlas(r,o);let w=0,m=0;const x=[],A=[],R=[],y=[];for(const t of s){const e=d.metric(t),i=n.x+w,s=i+e.width,o=n.y,r=o+e.height;x.push(i,o,i,r,s,o,s,r),A.push(e.x,e.y,e.x,e.y+e.height,e.x+e.width,e.y,e.x+e.width,e.y+e.height),R.push(a,c,h,l,a,c,h,l,a,c,h,l,a,c,h,l),y.push(m+0,m+1,m+2,m+1,m+2,m+3),w+=e.width,m+=4}return e.set(new P(x),new Y(A),new N(R),new z(y),new W(Array(m).fill(i.activeCamera))),d.texture})(t.ecs.get(h),t,r,n);n.push({z:i,entity:t,texture:a}),t.set(new L(r.x,r.y,s,o))},j=(t,...e)=>{const[n,i]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]];return t.entity(new u(i),new g(n.fontSize??24),new f(n.fontFamily??"monospace"),new b(n.color??{h:0,s:1,l:1,a:1}),new M(q),new X($))},K=(t,e)=>{const n=t.get(w).entity,i=n.get(M).layout(n,e);n.update(D,(t=>{t.x=e.maxWidth/2-i.width/2,t.y=e.maxHeight/2-i.height/2}));const s=new U(e.maxWidth,e.maxHeight);return t.set(e,s,new D(0,0)),s},Z=(t,e,n,i)=>{const{width:s,height:o}=t.get(U),r=e.add(t.get(D)),a=t.get(w).entity;a.get(X).geometry(a,r,n,i),t.set(new L(r.x,r.y,s,o))},J=(t,e)=>t.entity(new M(K),new X(Z),new w(e)),Q=(t,e)=>{let n=0,i=0;const s=t.get(m).entities;for(const t of s){const s=t.get(M).layout(t,e);t.update(D,(t=>t.y=i)),i+=s.height,n=Math.max(n,s.width)}switch(t.get(p).alignment){case R.START:break;case R.CENTER:for(const t of s){const e=t.get(U).width;t.update(D,(t=>t.x=n/2-e/2))}break;case R.END:for(const t of s){const e=t.get(U).width;t.update(D,(t=>t.x=n-e))}}const o=new U(n,i);return t.set(e,o,new D(0,0)),o},tt=(t,e,n,i)=>{const{width:s,height:o}=t.get(U),r=e.add(t.get(D));for(const e of t.get(m).entities)e.get(X).geometry(e,r,n,i);t.set(new L(r.x,r.y,s,o))},et=(t,...e)=>{const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return t.entity(new M(Q),new X(tt),new m(i),new p(n.crossAxisAlignment??R.START))},nt=(t,e)=>{let n=0,i=0;const s=t.get(m).entities;for(const t of s){const s=t.get(M).layout(t,e);t.update(D,(t=>t.x=n)),n+=s.width,i=Math.max(i,s.height)}switch(t.get(p).alignment){case R.START:break;case R.CENTER:for(const t of s){const e=t.get(U).height;t.update(D,(t=>t.y=i/2-e/2))}break;case R.END:for(const t of s){const e=t.get(U).height;t.update(D,(t=>t.y=i-e))}}const o=new U(n,i);return t.set(e,o,new D(0,0)),o},it=(t,e,n,i)=>{const{width:s,height:o}=t.get(U),r=e.add(t.get(D));for(const e of t.get(m).entities)e.get(X).geometry(e,r,n,i);t.set(new L(r.x,r.y,s,o))},st=(t,...e)=>{const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return t.entity(new M(nt),new X(it),new m(i),new p(n.crossAxisAlignment??R.START))},ot=(t,e,n)=>Math.max(Math.min(t,n),e),rt=(t,e)=>{const n=t.get(C).value,i=t.get(w),{x:s,y:o}=t.get(T),r=new D(s,o);if(i){const s=i.entity.get(M).layout(i.entity,e),o=new U(Math.min(e.maxWidth,s.width+2*n),Math.min(e.maxHeight,s.height+2*n));return i.entity.update(D,(t=>{t.x=n,t.y=n})),t.set(e,o,r),o}const a=new U(ot(t.get(v).value,e.minWidth,e.maxWidth),ot(t.get(E).value,e.minHeight,e.maxHeight));return t.set(e,a,r),a},at=(t,e,n,i)=>{const s=e.add(t.get(D)),{width:o,height:r}=t.get(U),a=s.x,c=a+o,h=s.y,l=h+r,d=t.get(b);if(d){const{h:e,s:s,l:o,a:r}=d;t.set(new P([a,h,a,l,c,h,c,l]),new Y([0,0,0,0,0,0,0,0]),new N([e,s,o,r,e,s,o,r,e,s,o,r,e,s,o,r]),new z([0,1,2,1,2,3]),new W(Array(4).fill(n.activeCamera))),n.push({z:i,texture:0,entity:t})}const u=t.get(w);u&&u.entity.get(X).geometry(u.entity,s,n,i),t.set(new L(a,h,o,r))},ct=(t,e,n)=>{const i=t.entity(new M(rt),new X(at),new C(e.padding??0),new v(e.width??0),new E(e.height??0),new T(e.x??0,e.y??0));return e.color&&i.set(new b(e.color)),n&&i.set(new w(n)),i},ht=(t,e,n)=>{const i=e.x+e.width/2,s=e.y+e.height/2,o=i+50,r=s,a=n.x+n.width/2,c=n.y+n.height/2,h=a-50,l=c,d=[];let u=0,g=0;for(const e of t){const t=e*e,n=t*e,f=1-e,w=f*f,m=w*f,x=3*w*e,A=3*f*t,R=m*i+x*o+A*h+n*a,y=m*s+x*r+A*l+n*c;d.length?d.push(u,g):d.push(R,y),d.push(R,y),u=R,g=y}return d},lt=(t,e)=>{const n=((t,e,n)=>{const i=(e-t)/(n-1);return Array.from({length:n},((e,n)=>t+i*n))})(0,1,20),i=Array(80).fill(0);for(const s of t){const t=s.get(F).entity.get(L),o=s.get(S).entity.get(L),r=ht(n,t,o),{h:a,s:c,l:h,a:l}=s.get(b),d=[];for(let t=0;t<40;++t)d.push(a,c,h,l);s.set(new P(r),new Y(i),new N(d),new W(Array(r.length/2).fill(e.activeCamera))),e.lines.push(s)}},dt=(t,e)=>t.entity(new F(e.from),new S(e.to),new b(e.color??{h:0,s:1,l:1,a:1})),ut=(t,e)=>{for(const n of t.get(m).entities)n.get(M).layout(n,e);const n=new U(e.maxWidth,e.maxHeight);return t.set(e,n,new D(0,0)),n},gt=(t,e,n,i)=>{const s=t.get(A).entity.get(_).matrix;n.pushAndSetActiveCamera(s);const{width:o,height:r}=t.get(U),a=e.add(t.get(D));for(const e of t.get(m).entities)e.get(X).geometry(e,a,n,i);lt(t.get(x).entities,n),t.set(new L(a.x,a.y,o,r))},ft=(t,e)=>t.entity(new M(ut),new X(gt),new m(e.children),new x(e.connections),new A(e.camera));class wt{constructor(){this.clear()}get=t=>{const e=this.lookup.get(t.id);return null!=e?this.data[e]:void 0};hasId=t=>this.lookup.has(t);set=(t,e)=>{const n=this.lookup.get(t.id);if(n)return this.data[n]=e,void(this.inverses[n]=t.id);this.lookup.set(t.id,this.data.length),this.data.push(e),this.inverses.push(t.id)};clear=()=>{this.lookup=new Map,this.data=[],this.inverses=[]}}class mt{constructor(t,e){this.id=t,this.ecs=e,this.set=(...t)=>{for(const e of t){const t=e.constructor;let n=this.ecs.storages.get(t);n||(n=new wt,this.ecs.storages.set(t,n)),n.set(this,e)}return this},this.get=t=>{const e=this.ecs.storages.get(t);return e?e.get(this):void 0},this.update=(t,e)=>{const n=this.ecs.storages.get(t);if(!n)return;const i=n.get(this);i&&e(i)}}}class xt{constructor(){this.nextEntityId=0,this.storages=new Map,this.resources=new Map}entity=(...t)=>{const e=new mt(this.nextEntityId,this);return e.set(...t),++this.nextEntityId,e};query=function*(...t){const e=this.storages.get(t[0]);if(!e)return;const n=t.slice(1).map((t=>this.storages.get(t)));for(const t of e.inverses)n.every((e=>e.hasId(t)))&&(yield new mt(t,this))};set=(...t)=>{for(const e of t){const t=e.constructor;this.resources.set(t,e)}};get=t=>this.resources.get(t);unsetAll=t=>{const e=this.storages.get(t);e&&e.clear()}}const{ECS:At,Renderer:Rt}=s,{UIRoot:yt,Alignment:pt,Transform:vt}=s.components,{text:Et,column:Tt,row:_t,container:Bt,scene:Ft,connection:St}=s.ui,{render:bt}=s.systems,Ct=new At,It=new Rt(window.innerWidth,window.innerHeight);It.canvas.style.width="100%",It.canvas.style.height="100%";const Ut=Bt(Ct,{width:18,height:18,color:{h:70,s:1,l:.7,a:1}}),Dt=Bt(Ct,{color:{h:110,s:1,l:.3,a:1},padding:10,x:25,y:200},Tt(Ct,{crossAxisAlignment:pt.CENTER},[Bt(Ct,{padding:5},Et(Ct,"Source")),Bt(Ct,{height:10}),_t(Ct,[Tt(Ct,[_t(Ct,[Bt(Ct,{width:18,height:18,color:{h:70,s:1,l:.7,a:1}}),Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 0"))]),_t(Ct,[Bt(Ct,{width:18,height:18,color:{h:70,s:1,l:.7,a:1}}),Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 1"))])]),Bt(Ct,{width:30}),Tt(Ct,{crossAxisAlignment:pt.END},[_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 0")),Bt(Ct,{width:5}),Ut]),_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 1")),Bt(Ct,{width:5}),Bt(Ct,{width:18,height:18,color:{h:70,s:1,l:.7,a:1}})])])])])),Mt=Bt(Ct,{width:18,height:18,color:{h:170,s:1,l:.7,a:1}}),Lt=Bt(Ct,{width:18,height:18,color:{h:170,s:1,l:.7,a:1}}),Pt=Bt(Ct,{color:{h:210,s:1,l:.3,a:1},padding:10,x:300,y:100},Tt(Ct,{crossAxisAlignment:pt.CENTER},[Bt(Ct,{padding:5},Et(Ct,"Transform")),Bt(Ct,{height:10}),_t(Ct,[Tt(Ct,[_t(Ct,[Mt,Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 0"))]),_t(Ct,[Bt(Ct,{width:18,height:18,color:{h:170,s:1,l:.7,a:1}}),Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 1"))])]),Bt(Ct,{width:30}),Tt(Ct,{crossAxisAlignment:pt.END},[_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 0")),Bt(Ct,{width:5}),Bt(Ct,{width:18,height:18,color:{h:170,s:1,l:.7,a:1}})]),_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 1")),Bt(Ct,{width:5}),Lt])])])])),Yt=Bt(Ct,{width:18,height:18,color:{h:270,s:1,l:.7,a:1}}),Nt=Bt(Ct,{color:{h:310,s:1,l:.3,a:1},padding:10,x:550,y:250},Tt(Ct,{crossAxisAlignment:pt.CENTER},[Bt(Ct,{padding:5},Et(Ct,"Sink")),Bt(Ct,{height:10}),_t(Ct,[Tt(Ct,[_t(Ct,[Bt(Ct,{width:18,height:18,color:{h:270,s:1,l:.7,a:1}}),Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 0"))]),_t(Ct,[Yt,Bt(Ct,{width:5}),Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"in 1"))])]),Bt(Ct,{width:30}),Tt(Ct,{crossAxisAlignment:pt.END},[_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 0")),Bt(Ct,{width:5}),Bt(Ct,{width:18,height:18,color:{h:270,s:1,l:.7,a:1}})]),_t(Ct,[Bt(Ct,{padding:2},Et(Ct,{fontSize:18},"out 1")),Bt(Ct,{width:5}),Bt(Ct,{width:18,height:18,color:{h:270,s:1,l:.7,a:1}})])])])])),zt=Ct.entity(new vt(i.identity())),Wt=Ft(Ct,{camera:zt,children:[Dt,Pt,Nt],connections:[St(Ct,{from:Ut,to:Mt}),St(Ct,{from:Lt,to:Yt})]});Ct.set(It,new yt(Wt)),requestAnimationFrame((()=>bt(Ct)));const Xt=[];let Ht=!1,Gt=0;document.addEventListener("pointerdown",(t=>{Xt.push(t),1==Xt.length&&(Ht=!0)})),document.addEventListener("pointermove",(t=>{if(Xt[Xt.findIndex((e=>e.pointerId==t.pointerId))]=t,Ht&&1==Xt.length)zt.update(vt,(e=>{const n=i.translation(-t.movementX,-t.movementY);e.matrix=e.matrix.matMul(n)})),requestAnimationFrame((()=>bt(Ct)));else if(2==Xt.length){const[e,n]=[Xt[0].clientX,Xt[0].clientY],[s,o]=[Xt[1].clientX,Xt[1].clientY],r=Math.sqrt(Math.pow(s-e,2)+Math.pow(o-n,2));if(Gt>0){const e=i.translation(t.clientX,t.clientY),n=Math.pow(2,.01*(Gt-r)),s=i.scaling(n,n),o=i.translation(-t.clientX,-t.clientY),a=e.matMul(s).matMul(o);zt.update(vt,(t=>t.matrix=t.matrix.matMul(a)))}Gt=r,requestAnimationFrame((()=>bt(Ct)))}})),document.addEventListener("pointerup",(t=>{Xt.splice(Xt.findIndex((e=>e.pointerId==t.pointerId)),1),0==Xt.length&&(Ht=!1,Gt=0)})),window.addEventListener("resize",(()=>{It.setSize(It.canvas.clientWidth,It.canvas.clientHeight),requestAnimationFrame((()=>bt(Ct)))})),document.body.appendChild(It.canvas),document.addEventListener("touchend",(()=>{It.canvas.requestFullscreen()})),document.addEventListener("wheel",(t=>{t.preventDefault(),zt.update(vt,(e=>{const n=i.translation(t.clientX,t.clientY),s=Math.pow(2,.01*t.deltaY),o=i.scaling(s,s),r=i.translation(-t.clientX,-t.clientY),a=n.matMul(o).matMul(r);e.matrix=e.matrix.matMul(a)})),requestAnimationFrame((()=>bt(Ct)))}),{passive:!1}),document.addEventListener("keydown",(t=>t.preventDefault()));
//# sourceMappingURL=index.a3f8458f.js.map

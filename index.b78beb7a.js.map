{"mappings":"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","sources":["src/components.ts","src/linear_algebra.ts","src/renderer.ts","src/systems/render.ts","src/systems/layout.ts","src/layers.ts","src/systems/geometry.ts","src/systems/ray_cast.ts","src/ui/text.ts","src/ui/center.ts","src/ui/column.ts","src/ui/row.ts","src/ui/container.ts","src/ui/connection.ts","src/ui/scene.ts","src/ecs.ts","src/index.ts"],"sourcesContent":["import { Entity } from \"./ecs\";\r\nimport { Layers } from \"./layers\";\r\nimport { Mat3 } from \"./linear_algebra\";\r\n\r\nexport class UIRoot { constructor(public entity: Entity) { } }\r\n\r\nexport class Text { constructor(public value: string) { } }\r\n\r\nexport class FontSize { constructor(public value: number) { } }\r\n\r\nexport class FontFamily { constructor(public value: string) { } }\r\n\r\nexport class Child { constructor(public entity: Entity) { } }\r\n\r\nexport class Children { constructor(public entities: Entity[]) { } }\r\n\r\nexport class Connections { constructor(public entities: Entity[]) { } }\r\n\r\nexport class Camera { constructor(public entity: Entity) { } }\r\n\r\nexport enum Alignment { START, CENTER, END }\r\n\r\nexport class CrossAxisAlignment { constructor(public alignment: Alignment) { } }\r\n\r\nexport class Width { constructor(public value: number) { } }\r\n\r\nexport class Height { constructor(public value: number) { } }\r\n\r\nexport class Translate {\r\n    constructor(public x: number, public y: number) { }\r\n}\r\n\r\nexport class Transform { constructor(public matrix: Mat3) { } }\r\n\r\nexport class Zoom {\r\n    constructor(\r\n        public scale: number,\r\n        public x: number,\r\n        public y: number,\r\n    ) { }\r\n}\r\n\r\nexport class From { constructor(public entity: Entity) { } }\r\n\r\nexport class To { constructor(public entity: Entity) { } }\r\n\r\nexport interface Hsla {\r\n    h: number\r\n    s: number\r\n    l: number\r\n    a: number\r\n}\r\n\r\nexport class Color {\r\n    h: number\r\n    s: number\r\n    l: number\r\n    a: number\r\n\r\n    constructor({ h, s, l, a }: Hsla) {\r\n        this.h = h\r\n        this.s = s\r\n        this.l = l\r\n        this.a = a\r\n    }\r\n}\r\n\r\nexport class Padding { constructor(public value: number) { } }\r\n\r\nexport class Constraints {\r\n    constructor(\r\n        public minWidth: number,\r\n        public maxWidth: number,\r\n        public minHeight: number,\r\n        public maxHeight: number\r\n    ) { }\r\n}\r\n\r\nexport class Size {\r\n    constructor(\r\n        public width: number,\r\n        public height: number,\r\n    ) { }\r\n}\r\n\r\nexport class Offset {\r\n    constructor(\r\n        public x: number,\r\n        public y: number,\r\n    ) { }\r\n\r\n    add = (other: Offset) => new Offset(this.x + other.x, this.y + other.y)\r\n}\r\n\r\nexport class Layout {\r\n    constructor(\r\n        private impl: (self: Entity, constraints: Constraints) => Size\r\n    ) { }\r\n\r\n    layout = (self: Entity, constraints: Constraints) =>\r\n        this.impl(self, constraints)\r\n}\r\n\r\nexport class WorldSpace {\r\n    constructor(\r\n        public x: number,\r\n        public y: number,\r\n        public width: number,\r\n        public height: number\r\n    ) { }\r\n}\r\n\r\nexport class Vertices { constructor(public data: number[]) { } }\r\n\r\nexport class TextureCoordinates { constructor(public data: number[]) { } }\r\n\r\nexport class Colors { constructor(public data: number[]) { } }\r\n\r\nexport class VertexIndices { constructor(public data: number[]) { } }\r\n\r\nexport class CameraIndices { constructor(public data: number[]) { } }\r\n\r\nexport class Geometry {\r\n    constructor(\r\n        private impl: (self: Entity, parentOffset: Offset, layers: Layers, z: number) => void\r\n    ) { }\r\n\r\n    geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) =>\r\n        this.impl(self, parentOffset, layers, z)\r\n}\r\n\r\nexport class OnDrag {\r\n    constructor(public callback: (entity: Entity, x: number, y: number) => void) { }\r\n}","export class Vec3 {\r\n    constructor(public data: number[]) { }\r\n}\r\n\r\nexport class Mat3 {\r\n    constructor(public data: number[]) { }\r\n\r\n    static identity = () => new Mat3([\r\n        1, 0, 0,\r\n        0, 1, 0,\r\n        0, 0, 1,\r\n    ])\r\n\r\n    static projection = (width: number, height: number) => new Mat3([\r\n        2 / width, 0, -1,\r\n        0, -2 / height, 1,\r\n        0, 0, 1\r\n    ])\r\n\r\n    static translation = (x: number, y: number) => new Mat3([\r\n        1, 0, x,\r\n        0, 1, y,\r\n        0, 0, 1\r\n    ])\r\n\r\n    static rotation = (radians: number) => {\r\n        const c = Math.cos(radians)\r\n        const s = Math.sin(radians)\r\n        return new Mat3([\r\n            c, s, 0,\r\n            -s, c, 0,\r\n            0, 0, 1\r\n        ])\r\n    }\r\n\r\n    static scaling = (x: number, y: number) => new Mat3([\r\n        x, 0, 0,\r\n        0, y, 0,\r\n        0, 0, 1\r\n    ])\r\n\r\n    matMul = (other: Mat3) => {\r\n        const a = this.data\r\n        const b = other.data\r\n        const a11 = a[0]\r\n        const a12 = a[1]\r\n        const a13 = a[2]\r\n        const a21 = a[3]\r\n        const a22 = a[4]\r\n        const a23 = a[5]\r\n        const a31 = a[6]\r\n        const a32 = a[7]\r\n        const a33 = a[8]\r\n        const b11 = b[0]\r\n        const b12 = b[1]\r\n        const b13 = b[2]\r\n        const b21 = b[3]\r\n        const b22 = b[4]\r\n        const b23 = b[5]\r\n        const b31 = b[6]\r\n        const b32 = b[7]\r\n        const b33 = b[8]\r\n        const c11 = a11 * b11 + a12 * b21 + a13 * b31\r\n        const c12 = a11 * b12 + a12 * b22 + a13 * b32\r\n        const c13 = a11 * b13 + a12 * b23 + a13 * b33\r\n        const c21 = a21 * b11 + a22 * b21 + a23 * b31\r\n        const c22 = a21 * b12 + a22 * b22 + a23 * b32\r\n        const c23 = a21 * b13 + a22 * b23 + a23 * b33\r\n        const c31 = a31 * b11 + a32 * b21 + a33 * b31\r\n        const c32 = a31 * b12 + a32 * b22 + a33 * b32\r\n        const c33 = a31 * b13 + a32 * b23 + a33 * b33\r\n        return new Mat3([\r\n            c11, c12, c13,\r\n            c21, c22, c23,\r\n            c31, c32, c33,\r\n        ])\r\n    }\r\n\r\n    vecMul = (other: Vec3) => {\r\n        const a = this.data\r\n        const b = other.data\r\n        const a11 = a[0]\r\n        const a12 = a[1]\r\n        const a13 = a[2]\r\n        const a21 = a[3]\r\n        const a22 = a[4]\r\n        const a23 = a[5]\r\n        const a31 = a[6]\r\n        const a32 = a[7]\r\n        const a33 = a[8]\r\n        const b1 = b[0]\r\n        const b2 = b[1]\r\n        const b3 = b[2]\r\n        const c1 = a11 * b1 + a12 * b2 + a13 * b3\r\n        const c2 = a21 * b1 + a22 * b2 + a23 * b3\r\n        const c3 = a31 * b1 + a32 * b2 + a33 * b3\r\n        return new Vec3([c1, c2, c3])\r\n    }\r\n\r\n    inverse = () => {\r\n        const a = this.data\r\n        const a11 = a[0]\r\n        const a12 = a[1]\r\n        const a13 = a[2]\r\n        const a21 = a[3]\r\n        const a22 = a[4]\r\n        const a23 = a[5]\r\n        const a31 = a[6]\r\n        const a32 = a[7]\r\n        const a33 = a[8]\r\n        const b11 = a22 * a33 - a23 * a32\r\n        const b12 = a21 * a33 - a23 * a31\r\n        const b13 = a21 * a32 - a22 * a31\r\n        const b21 = a12 * a33 - a13 * a32\r\n        const b22 = a11 * a33 - a13 * a31\r\n        const b23 = a11 * a32 - a12 * a31\r\n        const b31 = a12 * a23 - a13 * a22\r\n        const b32 = a11 * a23 - a13 * a21\r\n        const b33 = a11 * a22 - a12 * a21\r\n        const det = a31 * b31 - a32 * b32 + a33 * b33\r\n        const idet = 1 / det\r\n        return new Mat3([\r\n            idet * b11, idet * -b21, idet * b31,\r\n            idet * -b12, idet * b22, idet * -b32,\r\n            idet * b13, idet * -b23, idet * b33\r\n        ])\r\n    }\r\n}","import { Mat3 } from \"./linear_algebra\"\r\n\r\nclass DefaultProgram {\r\n    positionBuffer: WebGLBuffer\r\n    colorBuffer: WebGLBuffer\r\n    textureCoordinatesBuffer: WebGLBuffer\r\n    indexBuffer: WebGLBuffer\r\n    resolutionLocation: WebGLUniformLocation\r\n    devicePixelRatioLocation: WebGLUniformLocation\r\n    matricesLocation: WebGLUniformLocation\r\n    matrixIndexBuffer: WebGLBuffer\r\n\r\n    constructor(gl: WebGL2RenderingContext) {\r\n        const aPositionLocation = 0\r\n        const aTextureCoordinatesLocation = 1\r\n        const aColorLocation = 2\r\n        const aMatrixIndexLocation = 3\r\n\r\n        const vertexShaderSource = `#version 300 es\r\n  uniform float u_devicePixelRatio;\r\n  uniform mat3 u_matrices[10];\r\n\r\n  layout(location = ${aPositionLocation}) in vec2 a_position;\r\n  layout(location = ${aTextureCoordinatesLocation}) in vec2 a_textureCoordinates;\r\n  layout(location = ${aColorLocation}) in vec4 a_color;\r\n  layout(location = ${aMatrixIndexLocation}) in uint a_matrixIndex;\r\n\r\n  out vec2 v_textureCoordinates;\r\n  out vec4 v_color;\r\n\r\n  void main() {\r\n    gl_Position = vec4((u_matrices[a_matrixIndex] * vec3(a_position, 1)).xy, 0, 1);\r\n    v_textureCoordinates = a_textureCoordinates * u_devicePixelRatio;\r\n    v_color = a_color;\r\n  }\r\n  `\r\n        const fragmentShaderSource = `#version 300 es\r\n  precision highp float;\r\n\r\n  uniform sampler2D u_texture;\r\n\r\n  in vec2 v_textureCoordinates;\r\n  in vec4 v_color;\r\n\r\n  out vec4 fragColor;\r\n  \r\n  vec4 hslToRgb(in vec4 hsl) {\r\n    float h = hsl.x / 360.0;\r\n    vec3 rgb = clamp(abs(mod(h * 6.0 + vec3(0.0,4.0,2.0), 6.0) - 3.0) - 1.0, 0.0, 1.0);\r\n    return vec4(hsl.z + hsl.y * (rgb - 0.5) * (1.0 - abs(2.0 * hsl.z - 1.0)), hsl.w);\r\n  }\r\n\r\n  void main() {\r\n    ivec2 size = textureSize(u_texture, 0);\r\n    vec2 coordinate = v_textureCoordinates / vec2(float(size.x), float(size.y));\r\n    fragColor = texture(u_texture, coordinate) * hslToRgb(v_color);\r\n  }\r\n  `\r\n        const vertexShader = gl.createShader(gl.VERTEX_SHADER)!\r\n        gl.shaderSource(vertexShader, vertexShaderSource)\r\n        gl.compileShader(vertexShader)\r\n\r\n        const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)!\r\n        gl.shaderSource(fragmentShader, fragmentShaderSource)\r\n        gl.compileShader(fragmentShader)\r\n\r\n        const program = gl.createProgram()!\r\n        gl.attachShader(program, vertexShader)\r\n        gl.attachShader(program, fragmentShader)\r\n        gl.linkProgram(program)\r\n\r\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\r\n            console.log(gl.getShaderInfoLog(vertexShader))\r\n            console.log(gl.getShaderInfoLog(fragmentShader))\r\n        }\r\n\r\n        gl.useProgram(program)\r\n\r\n        const vertexArrayObject = gl.createVertexArray()!\r\n        gl.bindVertexArray(vertexArrayObject)\r\n\r\n        this.positionBuffer = gl.createBuffer()!\r\n        gl.bindAttribLocation(program, aPositionLocation, 'a_position')\r\n        gl.enableVertexAttribArray(aPositionLocation)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.positionBuffer)\r\n        gl.vertexAttribPointer(\r\n            aPositionLocation,\r\n        /*size*/2,\r\n        /*type*/gl.FLOAT,\r\n        /*normalize*/false,\r\n        /*stride*/0,\r\n        /*offset*/0\r\n        )\r\n\r\n        this.textureCoordinatesBuffer = gl.createBuffer()!\r\n        gl.bindAttribLocation(program, aTextureCoordinatesLocation, 'a_textureCoordinates')\r\n        gl.enableVertexAttribArray(aTextureCoordinatesLocation)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordinatesBuffer)\r\n        gl.vertexAttribPointer(\r\n            aTextureCoordinatesLocation,\r\n        /*size*/2,\r\n        /*type*/gl.FLOAT,\r\n        /*normalize*/false,\r\n        /*stride*/0,\r\n        /*offset*/0\r\n        )\r\n\r\n        this.colorBuffer = gl.createBuffer()!\r\n        gl.bindAttribLocation(program, aColorLocation, 'a_color')\r\n        gl.enableVertexAttribArray(aColorLocation)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.colorBuffer)\r\n        gl.vertexAttribPointer(\r\n            aColorLocation,\r\n        /*size*/4,\r\n        /*type*/gl.FLOAT,\r\n        /*normalize*/false,\r\n        /*stride*/0,\r\n        /*offset*/0\r\n        )\r\n\r\n        this.matrixIndexBuffer = gl.createBuffer()!\r\n        gl.bindAttribLocation(program, aMatrixIndexLocation, 'a_matrixIndex')\r\n        gl.enableVertexAttribArray(aMatrixIndexLocation)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.matrixIndexBuffer)\r\n        gl.vertexAttribIPointer(\r\n            aMatrixIndexLocation,\r\n        /*size*/1,\r\n        /*type*/gl.UNSIGNED_BYTE,\r\n        /*stride*/0,\r\n        /*offset*/0\r\n        )\r\n\r\n        this.indexBuffer = gl.createBuffer()!\r\n        this.devicePixelRatioLocation = gl.getUniformLocation(program, 'u_devicePixelRatio')!\r\n        this.matricesLocation = gl.getUniformLocation(program, 'u_matrices')!\r\n    }\r\n}\r\n\r\nconst nearestPowerOfTwo = (x: number): number => {\r\n    let current = 1\r\n    while (current < x) {\r\n        current <<= 1\r\n    }\r\n    return current\r\n}\r\n\r\ninterface Metric {\r\n    x: number\r\n    y: number\r\n    width: number\r\n    height: number\r\n}\r\n\r\nclass FontAtlas {\r\n    constructor(\r\n        public texture: number,\r\n        public metrics: Metric[],\r\n        public fontFamily: string,\r\n        public fontSize: number,\r\n    ) { }\r\n\r\n    metric = (c: string) => this.metrics[c.charCodeAt(0)]\r\n}\r\n\r\ninterface DrawData {\r\n    vertices: number[]\r\n    colors: number[]\r\n    textureCoordinates: number[]\r\n    vertexIndices: number[]\r\n    cameraIndices: number[]\r\n}\r\n\r\ninterface DrawLineData {\r\n    vertices: number[]\r\n    colors: number[]\r\n    textureCoordinates: number[]\r\n    cameraIndices: number[]\r\n}\r\n\r\nconst createFontMetrics = (gl: WebGL2RenderingContext, texture: WebGLTexture, font: string, fontSize: number) => {\r\n    const canvas = document.createElement('canvas')\r\n    const ctx = canvas.getContext('2d')!\r\n    const totalCells = 256\r\n    const rows = Math.sqrt(totalCells)\r\n    const size = nearestPowerOfTwo(fontSize * rows)\r\n    const cellSize = size / rows\r\n    canvas.width = size * window.devicePixelRatio\r\n    canvas.height = size * window.devicePixelRatio\r\n    canvas.style.width = `${size}px`\r\n    canvas.style.height = `${size}px`\r\n    ctx.scale(window.devicePixelRatio, window.devicePixelRatio)\r\n    ctx.textAlign = 'left'\r\n    ctx.textBaseline = 'top'\r\n    ctx.font = font\r\n    ctx.fillStyle = 'white'\r\n    const ascii = Array.from({ length: totalCells }, (v, i) => i)\r\n    const chars = ascii.map(c => String.fromCharCode(c))\r\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n    const metrics = chars.map((c, i) => {\r\n        const metric = ctx.measureText(c)\r\n        const width = Math.ceil(metric.width)\r\n        const height = fontSize\r\n        const x = i % rows * cellSize\r\n        const y = Math.floor(i / rows) * cellSize\r\n        ctx.fillText(c, x, y)\r\n        return {\r\n            x: x,\r\n            y: y,\r\n            width: width,\r\n            height: height\r\n        }\r\n    })\r\n    gl.bindTexture(gl.TEXTURE_2D, texture)\r\n    gl.texImage2D(\r\n        gl.TEXTURE_2D,\r\n      /*mipLevel*/0,\r\n      /*internalformat*/gl.RGBA,\r\n      /*srcFormat*/gl.RGBA,\r\n      /*srcType*/gl.UNSIGNED_BYTE,\r\n      /*source*/canvas)\r\n    gl.generateMipmap(gl.TEXTURE_2D)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\r\n    return metrics\r\n}\r\n\r\nexport class Renderer {\r\n    gl: WebGL2RenderingContext\r\n    canvas: HTMLCanvasElement\r\n    program: DefaultProgram\r\n    width: number\r\n    height: number\r\n    fontAtlasses: Map<string, FontAtlas>\r\n    textures: WebGLTexture[]\r\n    devicePixelRatio: number\r\n\r\n    constructor(width: number, height: number) {\r\n        const canvas = document.createElement('canvas')\r\n        canvas.style.touchAction = 'none'\r\n        const gl = canvas.getContext('webgl2')!\r\n        gl.clearColor(0.0, 0.0, 0.0, 1.0)\r\n        gl.enable(gl.BLEND)\r\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA)\r\n        gl.depthMask(false)\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true)\r\n        gl.activeTexture(gl.TEXTURE0)\r\n        this.gl = gl\r\n        this.canvas = canvas\r\n        this.program = new DefaultProgram(gl)\r\n        this.fontAtlasses = new Map()\r\n        this.textures = []\r\n        this.devicePixelRatio = window.devicePixelRatio\r\n        this.setSize(width, height)\r\n        const texture = gl.createTexture()!\r\n        gl.bindTexture(gl.TEXTURE_2D, texture)\r\n        gl.texImage2D(\r\n            gl.TEXTURE_2D,\r\n      /*mipLevel*/0,\r\n      /*internalformat*/gl.RGBA,\r\n      /*width*/1,\r\n      /*height*/1,\r\n      /*border*/0,\r\n      /*srcFormat*/gl.RGBA,\r\n      /*srcType*/gl.UNSIGNED_BYTE,\r\n      /*data*/new Uint8Array([255, 255, 255, 255]))\r\n        this.textures.push(texture)\r\n    }\r\n\r\n    setSize = (width: number, height: number) => {\r\n        const { gl, canvas } = this\r\n        canvas.width = width * window.devicePixelRatio\r\n        canvas.height = height * window.devicePixelRatio\r\n        gl.uniform2f(this.program.resolutionLocation, canvas.width, canvas.height)\r\n        gl.uniform1f(this.program.devicePixelRatioLocation, window.devicePixelRatio)\r\n        gl.viewport(0, 0, canvas.width, canvas.height)\r\n        this.width = width\r\n        this.height = height\r\n        if (this.devicePixelRatio == window.devicePixelRatio) return\r\n        this.devicePixelRatio = window.devicePixelRatio\r\n        this.recreateFontAtlasses()\r\n    }\r\n\r\n    clear = () => {\r\n        const { gl } = this\r\n        gl.clear(gl.COLOR_BUFFER_BIT)\r\n    }\r\n\r\n    setMatrices = (matrices: Mat3[]) => {\r\n        const { gl } = this\r\n        const data: number[] = []\r\n        for (const matrix of matrices) {\r\n            data.push(...matrix.data)\r\n        }\r\n        gl.uniformMatrix3fv(this.program.matricesLocation, /*transpose*/true, /*data*/data)\r\n    }\r\n\r\n    draw = ({ vertices, colors, textureCoordinates, vertexIndices, cameraIndices }: DrawData) => {\r\n        const { gl, program } = this\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.positionBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.colorBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.textureCoordinatesBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, program.indexBuffer)\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(vertexIndices), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.matrixIndexBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Uint8Array(cameraIndices), gl.STATIC_DRAW)\r\n        gl.drawElements(gl.TRIANGLES, /*count*/vertexIndices.length, /*type*/gl.UNSIGNED_SHORT, /*offset*/0)\r\n    }\r\n\r\n    drawLines = ({ vertices, colors, textureCoordinates, cameraIndices }: DrawLineData) => {\r\n        const { gl, program } = this\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.positionBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.colorBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(colors), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.textureCoordinatesBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(textureCoordinates), gl.STATIC_DRAW)\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, program.indexBuffer)\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, program.matrixIndexBuffer)\r\n        gl.bufferData(gl.ARRAY_BUFFER, new Uint8Array(cameraIndices), gl.STATIC_DRAW)\r\n        gl.drawArrays(gl.LINES, 0, vertices.length / 2)\r\n    }\r\n\r\n    recreateFontAtlasses = () => {\r\n        for (const [font, fontAtlas] of this.fontAtlasses) {\r\n            const texture = this.textures[fontAtlas.texture]\r\n            const metrics = createFontMetrics(this.gl, texture, font, fontAtlas.fontSize)\r\n            fontAtlas.metrics = metrics\r\n        }\r\n    }\r\n\r\n    fontAtlas = (fontFamily: string, fontSize: number): FontAtlas => {\r\n        const font = `${fontSize}px ${fontFamily}`\r\n        const atlas = this.fontAtlasses.get(font)\r\n        if (atlas) return atlas\r\n        const { gl } = this\r\n        const texture = gl.createTexture()!\r\n        const metrics = createFontMetrics(gl, texture, font, fontSize)\r\n        const textureIndex = this.textures.length\r\n        this.textures.push(texture)\r\n        const newAtlas = new FontAtlas(textureIndex, metrics, fontFamily, fontSize)\r\n        this.fontAtlasses.set(font, newAtlas)\r\n        return newAtlas\r\n    }\r\n}","import { Renderer } from \"../renderer\";\r\nimport { ECS } from \"../ecs\";\r\nimport { CameraIndices, Colors, TextureCoordinates, VertexIndices, Vertices } from \"../components\";\r\nimport { Layers } from \"../layers\";\r\nimport { layout, geometry } from './'\r\nimport { Mat3 } from \"../linear_algebra\";\r\n\r\nconst renderTriangles = (renderer: Renderer, layers: Layers) => {\r\n    const { gl } = renderer\r\n    let vertices: number[] = []\r\n    let colors: number[] = []\r\n    let textureCoordinates: number[] = []\r\n    let vertexIndices: number[] = []\r\n    let cameraIndices: number[] = []\r\n    let previousTexture: number = -1\r\n    for (const layer of layers.layers) {\r\n        for (const [texture, entities] of layer) {\r\n            if (texture != previousTexture) {\r\n                if (vertices.length) {\r\n                    renderer.draw({ vertices, colors, textureCoordinates, vertexIndices, cameraIndices })\r\n                    vertices = []\r\n                    colors = []\r\n                    textureCoordinates = []\r\n                    vertexIndices = []\r\n                    cameraIndices = []\r\n                }\r\n                previousTexture = texture\r\n                gl.bindTexture(gl.TEXTURE_2D, renderer.textures[texture])\r\n            }\r\n            for (const entity of entities) {\r\n                const offset = vertices.length / 2\r\n                vertices.push(...entity.get(Vertices)!.data)\r\n                colors.push(...entity.get(Colors)!.data)\r\n                textureCoordinates.push(...entity.get(TextureCoordinates)!.data)\r\n                for (const index of entity.get(VertexIndices)!.data) {\r\n                    vertexIndices.push(offset + index)\r\n                }\r\n                cameraIndices.push(...entity.get(CameraIndices)!.data)\r\n            }\r\n        }\r\n    }\r\n    if (vertices.length == 0) return\r\n    renderer.draw({ vertices, colors, textureCoordinates, vertexIndices, cameraIndices })\r\n}\r\n\r\nconst renderLines = (renderer: Renderer, layers: Layers) => {\r\n    const { gl } = renderer\r\n    let vertices: number[] = []\r\n    let colors: number[] = []\r\n    let textureCoordinates: number[] = []\r\n    let cameraIndices: number[] = []\r\n    gl.bindTexture(gl.TEXTURE_2D, renderer.textures[0])\r\n    for (const entity of layers.lines) {\r\n        vertices.push(...entity.get(Vertices)!.data)\r\n        colors.push(...entity.get(Colors)!.data)\r\n        textureCoordinates.push(...entity.get(TextureCoordinates)!.data)\r\n        cameraIndices.push(...entity.get(CameraIndices)!.data)\r\n    }\r\n    if (vertices.length == 0) return\r\n    renderer.drawLines({ vertices, colors, textureCoordinates, cameraIndices })\r\n}\r\n\r\nexport const render = (ecs: ECS) => {\r\n    layout(ecs)\r\n    const layers = geometry(ecs)\r\n    const renderer = ecs.get(Renderer)!\r\n    const projection = Mat3.projection(renderer.width, renderer.height)\r\n    renderer.setMatrices(layers.cameras.map(camera => projection.matMul(camera.inverse())))\r\n    renderer.clear()\r\n    renderTriangles(renderer, layers)\r\n    renderLines(renderer, layers)\r\n    ecs.set(layers)\r\n}","import { Constraints, Layout, UIRoot } from \"../components\";\r\nimport { ECS } from \"../ecs\";\r\nimport { Renderer } from \"../renderer\";\r\n\r\nexport const layout = (ecs: ECS) => {\r\n    const { width, height } = ecs.get(Renderer)!\r\n    const ui = ecs.get(UIRoot)!.entity\r\n    const constraints = new Constraints(0, width, 0, height)\r\n    ui.get(Layout)!.layout(ui, constraints)\r\n}","import { Entity } from \"./ecs\";\r\nimport { Mat3 } from \"./linear_algebra\";\r\n\r\ninterface Data {\r\n    z: number\r\n    texture: number\r\n    entity: Entity\r\n}\r\n\r\nexport class Layers {\r\n    layers: Map<number, Entity[]>[]\r\n    lines: Entity[]\r\n    cameras: Mat3[]\r\n    activeCamera: number\r\n\r\n    constructor() {\r\n        this.layers = []\r\n        this.lines = []\r\n        this.cameras = [Mat3.identity()]\r\n        this.activeCamera = 0\r\n    }\r\n\r\n    pushAndSetActiveCamera = (camera: Mat3) => {\r\n        this.activeCamera = this.cameras.length\r\n        this.cameras.push(camera)\r\n    }\r\n\r\n    push = ({ z, texture, entity }: Data): void => {\r\n        for (let i = this.layers.length; i < z + 1; ++i) {\r\n            this.layers.push(new Map())\r\n        }\r\n        const layer = this.layers[z]\r\n        const entities = layer.get(texture)\r\n        if (entities) {\r\n            entities.push(entity)\r\n            return\r\n        }\r\n        layer.set(texture, [entity])\r\n    }\r\n}","import { UIRoot, Geometry, Offset } from \"../components\";\r\nimport { ECS } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nexport const geometry = (ecs: ECS): Layers => {\r\n    const layers = new Layers()\r\n    const ui = ecs.get(UIRoot)!.entity\r\n    ui.get(Geometry)!.geometry(ui, new Offset(0, 0), layers, 0)\r\n    return layers\r\n}","import { WorldSpace } from \"../components\"\r\nimport { ECS, Entity } from \"../ecs\"\r\nimport { Layers } from \"../layers\"\r\nimport { Mat3, Vec3 } from \"../linear_algebra\"\r\n\r\nexport function* rayCast(ecs: ECS, camera: Mat3, vec: Vec3): Generator<Entity> {\r\n    const [mx, my, _] = camera.vecMul(vec).data\r\n    for (const layer of ecs.get(Layers)!.layers.reverse()) {\r\n        for (const entities of layer.values()) {\r\n            for (const entity of entities) {\r\n                const { x, y, width, height } = entity.get(WorldSpace)!\r\n                if (mx > x && mx < x + width && my > y && my < y + height) {\r\n                    yield entity\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {\r\n    Layout,\r\n    Text,\r\n    FontSize,\r\n    FontFamily,\r\n    Constraints,\r\n    Color,\r\n    Offset,\r\n    Geometry,\r\n    Size,\r\n    Vertices,\r\n    TextureCoordinates,\r\n    Colors,\r\n    VertexIndices,\r\n    Hsla,\r\n    WorldSpace,\r\n    CameraIndices\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\nimport { Renderer } from \"../renderer\";\r\n\r\nconst textSize = (renderer: Renderer, entity: Entity) => {\r\n    const text = entity.get(Text)!.value\r\n    const fontSize = entity.get(FontSize)!.value\r\n    const fontFamily = entity.get(FontFamily)!.value\r\n    const atlas = renderer.fontAtlas(fontFamily, fontSize)\r\n    let size = new Size(0, 0)\r\n    for (const c of text) {\r\n        const metric = atlas.metric(c)\r\n        size.width += metric.width\r\n        size.height = Math.max(metric.height, size.height)\r\n    }\r\n    return size\r\n}\r\n\r\nconst textGeometry = (renderer: Renderer, entity: Entity, offset: Offset, layers: Layers): number => {\r\n    const text = entity.get(Text)!.value\r\n    const fontSize = entity.get(FontSize)!.value\r\n    const fontFamily = entity.get(FontFamily)!.value\r\n    const { h, s, l, a } = entity.get(Color)!\r\n    const atlas = renderer.fontAtlas(fontFamily, fontSize)\r\n    let x = 0\r\n    let indexOffset = 0\r\n    const vertices: number[] = []\r\n    const textureCoordinates: number[] = []\r\n    const colors: number[] = []\r\n    const indices: number[] = []\r\n    for (const c of text) {\r\n        const metric = atlas.metric(c)\r\n        const x0 = offset.x + x\r\n        const x1 = x0 + metric.width\r\n        const y0 = offset.y\r\n        const y1 = y0 + metric.height\r\n        vertices.push(\r\n            x0, y0,\r\n            x0, y1,\r\n            x1, y0,\r\n            x1, y1,\r\n        )\r\n        textureCoordinates.push(\r\n            metric.x, metric.y,\r\n            metric.x, metric.y + metric.height,\r\n            metric.x + metric.width, metric.y,\r\n            metric.x + metric.width, metric.y + metric.height,\r\n        )\r\n        colors.push(\r\n            h, s, l, a,\r\n            h, s, l, a,\r\n            h, s, l, a,\r\n            h, s, l, a,\r\n        )\r\n        indices.push(\r\n            indexOffset + 0, indexOffset + 1, indexOffset + 2,\r\n            indexOffset + 1, indexOffset + 2, indexOffset + 3,\r\n        )\r\n        x += metric.width\r\n        indexOffset += 4\r\n    }\r\n    entity.set(\r\n        new Vertices(vertices),\r\n        new TextureCoordinates(textureCoordinates),\r\n        new Colors(colors),\r\n        new VertexIndices(indices),\r\n        new CameraIndices(Array(indexOffset).fill(layers.activeCamera))\r\n    )\r\n    return atlas.texture\r\n}\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    const size = textSize(self.ecs.get(Renderer)!, self)\r\n    self.set(constraints, size, new Offset(0, 0))\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const { width, height } = self.get(Size)!\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    const texture = textGeometry(self.ecs.get(Renderer)!, self, offset, layers)\r\n    layers.push({ z, entity: self, texture })\r\n    self.set(new WorldSpace(offset.x, offset.y, width, height))\r\n}\r\n\r\ninterface Properties {\r\n    fontSize?: number\r\n    fontFamily?: number\r\n    color?: Hsla\r\n}\r\n\r\ntype Overload = {\r\n    (ecs: ECS, data: string): Entity\r\n    (ecs: ECS, properties: Properties, data: string): Entity\r\n}\r\n\r\nexport const text: Overload = (ecs: ECS, ...args: any[]): Entity => {\r\n    const [properties, data] = (() => {\r\n        if (typeof args[0] === 'string') return [{}, args[0]]\r\n        return [args[0], args[1]]\r\n    })()\r\n    return ecs.entity(\r\n        new Text(data),\r\n        new FontSize(properties.fontSize ?? 24),\r\n        new FontFamily(properties.fontFamily ?? \"monospace\"),\r\n        new Color(properties.color ?? { h: 0, s: 1, l: 1, a: 1 }),\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n    )\r\n}","import {\r\n    Layout,\r\n    Constraints,\r\n    Geometry,\r\n    Size,\r\n    Child,\r\n    Offset,\r\n    WorldSpace,\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    const child = self.get(Child)!.entity\r\n    const childSize = child.get(Layout)!.layout(child, constraints)\r\n    child.update(Offset, offset => {\r\n        offset.x = constraints.maxWidth / 2 - childSize.width / 2\r\n        offset.y = constraints.maxHeight / 2 - childSize.height / 2\r\n    })\r\n    const size = new Size(constraints.maxWidth, constraints.maxHeight)\r\n    self.set(constraints, size, new Offset(0, 0))\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const { width, height } = self.get(Size)!\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    const child = self.get(Child)!.entity\r\n    child.get(Geometry)!.geometry(child, offset, layers, z)\r\n    self.set(new WorldSpace(offset.x, offset.y, width, height))\r\n}\r\n\r\nexport const center = (ecs: ECS, child: Entity) =>\r\n    ecs.entity(\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n        new Child(child)\r\n    )","import {\r\n    Layout,\r\n    Constraints,\r\n    Geometry,\r\n    Size,\r\n    Offset,\r\n    Children,\r\n    Alignment,\r\n    CrossAxisAlignment,\r\n    WorldSpace,\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    let width = 0\r\n    let height = 0\r\n    const children = self.get(Children)!.entities\r\n    for (const child of children) {\r\n        const size = child.get(Layout)!.layout(child, constraints)\r\n        child.update(Offset, offset => offset.y = height)\r\n        height += size.height\r\n        width = Math.max(width, size.width)\r\n    }\r\n    switch (self.get(CrossAxisAlignment)!.alignment) {\r\n        case Alignment.START:\r\n            break\r\n        case Alignment.CENTER:\r\n            for (const child of children) {\r\n                const childWidth = child.get(Size)!.width\r\n                child.update(Offset, offset => offset.x = width / 2 - childWidth / 2)\r\n            }\r\n            break\r\n        case Alignment.END:\r\n            for (const child of children) {\r\n                const childWidth = child.get(Size)!.width\r\n                child.update(Offset, offset => offset.x = width - childWidth)\r\n            }\r\n            break\r\n    }\r\n    const size = new Size(width, height)\r\n    self.set(constraints, size, new Offset(0, 0))\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const { width, height } = self.get(Size)!\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    for (const child of self.get(Children)!.entities) {\r\n        child.get(Geometry)!.geometry(child, offset, layers, z)\r\n    }\r\n    self.set(new WorldSpace(offset.x, offset.y, width, height))\r\n}\r\n\r\ninterface Properties {\r\n    crossAxisAlignment?: Alignment\r\n}\r\n\r\ntype Overload = {\r\n    (ecs: ECS, children: Entity[]): Entity\r\n    (ecs: ECS, properties: Properties, children: Entity[]): Entity\r\n}\r\n\r\nexport const column: Overload = (ecs: ECS, ...args: any[]): Entity => {\r\n    const [properties, children] = (() => {\r\n        if (args[0] instanceof Array) return [{}, args[0]]\r\n        return [args[0], args[1]]\r\n    })()\r\n    return ecs.entity(\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n        new Children(children),\r\n        new CrossAxisAlignment(properties.crossAxisAlignment ?? Alignment.START)\r\n    )\r\n}","import {\r\n    Layout,\r\n    Constraints,\r\n    Geometry,\r\n    Size,\r\n    Offset,\r\n    Children,\r\n    Alignment,\r\n    CrossAxisAlignment,\r\n    WorldSpace,\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    let width = 0\r\n    let height = 0\r\n    const children = self.get(Children)!.entities\r\n    for (const child of children) {\r\n        const size = child.get(Layout)!.layout(child, constraints)\r\n        child.update(Offset, offset => offset.x = width)\r\n        width += size.width\r\n        height = Math.max(height, size.height)\r\n    }\r\n    switch (self.get(CrossAxisAlignment)!.alignment) {\r\n        case Alignment.START:\r\n            break\r\n        case Alignment.CENTER:\r\n            for (const child of children) {\r\n                const childHeight = child.get(Size)!.height\r\n                child.update(Offset, offset => offset.y = height / 2 - childHeight / 2)\r\n            }\r\n            break\r\n        case Alignment.END:\r\n            for (const child of children) {\r\n                const childHeight = child.get(Size)!.height\r\n                child.update(Offset, offset => offset.y = height - childHeight)\r\n            }\r\n            break\r\n    }\r\n    const size = new Size(width, height)\r\n    self.set(constraints, size, new Offset(0, 0))\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const { width, height } = self.get(Size)!\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    for (const child of self.get(Children)!.entities) {\r\n        child.get(Geometry)!.geometry(child, offset, layers, z)\r\n    }\r\n    self.set(new WorldSpace(offset.x, offset.y, width, height))\r\n}\r\n\r\ninterface Properties {\r\n    crossAxisAlignment?: Alignment\r\n}\r\n\r\ntype Overload = {\r\n    (ecs: ECS, children: Entity[]): Entity\r\n    (ecs: ECS, properties: Properties, children: Entity[]): Entity\r\n}\r\n\r\nexport const row: Overload = (ecs: ECS, ...args: any[]): Entity => {\r\n    const [properties, children] = (() => {\r\n        if (args[0] instanceof Array) return [{}, args[0]]\r\n        return [args[0], args[1]]\r\n    })()\r\n    return ecs.entity(\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n        new Children(children),\r\n        new CrossAxisAlignment(properties.crossAxisAlignment ?? Alignment.START)\r\n    )\r\n}","import {\r\n    Layout,\r\n    Constraints,\r\n    Geometry,\r\n    Size,\r\n    Child,\r\n    Offset,\r\n    Hsla,\r\n    Color,\r\n    Vertices,\r\n    TextureCoordinates,\r\n    Colors,\r\n    VertexIndices,\r\n    Padding,\r\n    Width,\r\n    Height,\r\n    WorldSpace,\r\n    Translate,\r\n    CameraIndices\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nconst clamp = (value: number, min: number, max: number): number =>\r\n    Math.max(Math.min(value, max), min)\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    const padding = self.get(Padding)!.value\r\n    const child = self.get(Child)\r\n    const { x, y } = self.get(Translate)!\r\n    const offset = new Offset(x, y)\r\n    if (child) {\r\n        const childSize = child.entity.get(Layout)!.layout(child.entity, constraints)\r\n        const size = new Size(\r\n            Math.min(constraints.maxWidth, childSize.width + 2 * padding),\r\n            Math.min(constraints.maxHeight, childSize.height + 2 * padding),\r\n        )\r\n        child.entity.update(Offset, offset => {\r\n            offset.x = padding\r\n            offset.y = padding\r\n        })\r\n        self.set(constraints, size, offset)\r\n        return size\r\n    }\r\n    const size = new Size(\r\n        clamp(self.get(Width)!.value, constraints.minWidth, constraints.maxWidth),\r\n        clamp(self.get(Height)!.value, constraints.minHeight, constraints.maxHeight),\r\n    )\r\n    self.set(constraints, size, offset)\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    const { width, height } = self.get(Size)!\r\n    const x0 = offset.x\r\n    const x1 = x0 + width\r\n    const y0 = offset.y\r\n    const y1 = y0 + height\r\n    const color = self.get(Color)\r\n    if (color) {\r\n        const { h, s, l, a } = color\r\n        self.set(\r\n            new Vertices([\r\n                x0, y0,\r\n                x0, y1,\r\n                x1, y0,\r\n                x1, y1,\r\n            ]),\r\n            new TextureCoordinates([\r\n                0, 0,\r\n                0, 0,\r\n                0, 0,\r\n                0, 0,\r\n            ]),\r\n            new Colors([\r\n                h, s, l, a,\r\n                h, s, l, a,\r\n                h, s, l, a,\r\n                h, s, l, a,\r\n            ]),\r\n            new VertexIndices([\r\n                0, 1, 2,\r\n                1, 2, 3,\r\n            ]),\r\n            new CameraIndices(Array(4).fill(layers.activeCamera))\r\n        )\r\n        layers.push({ z, texture: 0, entity: self })\r\n    }\r\n    const child = self.get(Child)\r\n    if (child) {\r\n        child.entity.get(Geometry)!.geometry(child.entity, offset, layers, z + 1)\r\n    }\r\n    self.set(new WorldSpace(x0, y0, width, height))\r\n}\r\n\r\ninterface Properties {\r\n    color?: Hsla\r\n    padding?: number\r\n    width?: number\r\n    height?: number\r\n    x?: number\r\n    y?: number\r\n}\r\n\r\ntype Overload = {\r\n    (ecs: ECS, properties: Properties): Entity\r\n    (ecs: ECS, properties: Properties, child: Entity): Entity\r\n}\r\n\r\nexport const container: Overload = (ecs: ECS, properties: Properties, child?: Entity) => {\r\n    const entity = ecs.entity(\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n        new Padding(properties.padding ?? 0),\r\n        new Width(properties.width ?? 0),\r\n        new Height(properties.height ?? 0),\r\n        new Translate(properties.x ?? 0, properties.y ?? 0)\r\n    )\r\n    if (properties.color) entity.set(new Color(properties.color))\r\n    if (child) entity.set(new Child(child))\r\n    return entity\r\n}","import { CameraIndices, Color, Colors, From, Hsla, TextureCoordinates, To, Vertices, WorldSpace } from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\n\r\nconst linspace = (start: number, stop: number, num: number): number[] => {\r\n    const step = (stop - start) / (num - 1)\r\n    return Array.from({ length: num }, (_, i) => start + step * i)\r\n}\r\n\r\nconst cubicBezier = (ts: number[], from: WorldSpace, to: WorldSpace): number[] => {\r\n    const p0x = from.x + from.width / 2\r\n    const p0y = from.y + from.height / 2\r\n    const p1x = p0x + 50\r\n    const p1y = p0y\r\n    const p3x = to.x + to.width / 2\r\n    const p3y = to.y + to.height / 2\r\n    const p2x = p3x - 50\r\n    const p2y = p3y\r\n    const result: number[] = []\r\n    let lastX = 0\r\n    let lastY = 0\r\n    for (const t of ts) {\r\n        const tSquared = t * t\r\n        const tCubed = tSquared * t\r\n        const oneMinusT = 1 - t\r\n        const oneMinusTSquared = oneMinusT * oneMinusT\r\n        const oneMinusTCubed = oneMinusTSquared * oneMinusT\r\n        const a = oneMinusTCubed\r\n        const b = 3 * oneMinusTSquared * t\r\n        const c = 3 * oneMinusT * tSquared\r\n        const d = tCubed\r\n        const x = a * p0x + b * p1x + c * p2x + d * p3x\r\n        const y = a * p0y + b * p1y + c * p2y + d * p3y\r\n        if (result.length) result.push(lastX, lastY)\r\n        else result.push(x, y)\r\n        result.push(x, y)\r\n        lastX = x\r\n        lastY = y\r\n    }\r\n    return result\r\n}\r\n\r\nexport const geometry = (connections: Entity[], layers: Layers) => {\r\n    const samples = 20\r\n    const ts = linspace(0, 1, samples)\r\n    const textureCoordinates = Array(samples * 4).fill(0)\r\n    for (const entity of connections) {\r\n        const from = entity.get(From)!.entity.get(WorldSpace)!\r\n        const to = entity.get(To)!.entity.get(WorldSpace)!\r\n        const vertices = cubicBezier(ts, from, to)\r\n        const { h, s, l, a } = entity.get(Color)!\r\n        const colors: number[] = []\r\n        for (let i = 0; i < samples * 2; ++i) colors.push(h, s, l, a)\r\n        entity.set(\r\n            new Vertices(vertices),\r\n            new TextureCoordinates(textureCoordinates),\r\n            new Colors(colors),\r\n            new CameraIndices(Array(vertices.length / 2).fill(layers.activeCamera))\r\n        )\r\n        layers.lines.push(entity)\r\n    }\r\n}\r\n\r\ninterface Properties {\r\n    from: Entity\r\n    to: Entity\r\n    color?: Hsla\r\n}\r\n\r\nexport const connection = (ecs: ECS, properties: Properties): Entity =>\r\n    ecs.entity(\r\n        new From(properties.from),\r\n        new To(properties.to),\r\n        new Color(properties.color ?? { h: 0, s: 1, l: 1, a: 1 }),\r\n    )","import {\r\n    Layout,\r\n    Constraints,\r\n    Geometry,\r\n    Size,\r\n    Offset,\r\n    Children,\r\n    Connections,\r\n    WorldSpace,\r\n    Camera,\r\n    Translate,\r\n    Zoom,\r\n    Transform,\r\n} from \"../components\";\r\nimport { ECS, Entity } from \"../ecs\";\r\nimport { Layers } from \"../layers\";\r\nimport { Mat3 } from \"../linear_algebra\";\r\nimport { geometry as connectionGeometry } from './connection'\r\n\r\nconst layout = (self: Entity, constraints: Constraints) => {\r\n    for (const child of self.get(Children)!.entities) {\r\n        child.get(Layout)!.layout(child, constraints)\r\n    }\r\n    const size = new Size(constraints.maxWidth, constraints.maxHeight)\r\n    self.set(constraints, size, new Offset(0, 0))\r\n    return size\r\n}\r\n\r\nconst geometry = (self: Entity, parentOffset: Offset, layers: Layers, z: number) => {\r\n    const camera = self.get(Camera)!.entity.get(Transform)!.matrix\r\n    layers.pushAndSetActiveCamera(camera)\r\n    const { width, height } = self.get(Size)!\r\n    const offset = parentOffset.add(self.get(Offset)!)\r\n    for (const child of self.get(Children)!.entities) {\r\n        child.get(Geometry)!.geometry(child, offset, layers, z)\r\n    }\r\n    connectionGeometry(self.get(Connections)!.entities, layers)\r\n    self.set(new WorldSpace(offset.x, offset.y, width, height))\r\n}\r\n\r\ninterface Properties {\r\n    camera: Entity,\r\n    children: Entity[],\r\n    connections: Entity[],\r\n}\r\n\r\nexport const scene = (ecs: ECS, properties: Properties) =>\r\n    ecs.entity(\r\n        new Layout(layout),\r\n        new Geometry(geometry),\r\n        new Children(properties.children),\r\n        new Connections(properties.connections),\r\n        new Camera(properties.camera),\r\n    )","type Component<T> = { new(...args: any[]): T }\r\n\r\nclass Storage<T> {\r\n  lookup: Map<number, number>\r\n  data: T[]\r\n  inverses: number[]\r\n\r\n  constructor() {\r\n    this.clear()\r\n  }\r\n\r\n  get = (entity: Entity): T | undefined => {\r\n    const index = this.lookup.get(entity.id)\r\n    return index != undefined ? this.data[index] : undefined\r\n  }\r\n\r\n  hasId = (id: number): boolean => {\r\n    return this.lookup.has(id)\r\n  }\r\n\r\n  set = (entity: Entity, component: T): void => {\r\n    const index = this.lookup.get(entity.id)\r\n    if (index) {\r\n      this.data[index] = component\r\n      this.inverses[index] = entity.id\r\n      return\r\n    }\r\n    this.lookup.set(entity.id, this.data.length)\r\n    this.data.push(component)\r\n    this.inverses.push(entity.id)\r\n  }\r\n\r\n  clear = (): void => {\r\n    this.lookup = new Map()\r\n    this.data = []\r\n    this.inverses = []\r\n  }\r\n}\r\n\r\nexport class Entity {\r\n  constructor(public id: number, public ecs: ECS) { }\r\n\r\n  set = (...components: any): Entity => {\r\n    for (const component of components) {\r\n      const Type = component.constructor\r\n      let storage = this.ecs.storages.get(Type)\r\n      if (!storage) {\r\n        storage = new Storage()\r\n        this.ecs.storages.set(Type, storage)\r\n      }\r\n      storage.set(this, component)\r\n    }\r\n    return this\r\n  }\r\n\r\n  get = <T>(Type: Component<T>): Readonly<T> | undefined => {\r\n    const storage = this.ecs.storages.get(Type)\r\n    return storage ? storage.get(this) : undefined\r\n  }\r\n\r\n  update = <T>(Type: Component<T>, f: (_: T) => void): void => {\r\n    const storage = this.ecs.storages.get(Type)\r\n    if (!storage) return\r\n    const component = storage.get(this)\r\n    if (!component) return\r\n    f(component)\r\n  }\r\n}\r\n\r\nexport class ECS {\r\n  nextEntityId: number\r\n  storages: Map<Component<any>, Storage<any>>\r\n  resources: Map<Component<any>, any>\r\n\r\n  constructor() {\r\n    this.nextEntityId = 0\r\n    this.storages = new Map()\r\n    this.resources = new Map()\r\n  }\r\n\r\n  entity = (...components: any): Entity => {\r\n    const entity = new Entity(this.nextEntityId, this)\r\n    entity.set(...components)\r\n    ++this.nextEntityId\r\n    return entity\r\n  }\r\n\r\n  query = function* (...components: any): Generator<Entity> {\r\n    const primary = this.storages.get(components[0])\r\n    if (!primary) return\r\n    const secondary = components.slice(1).map(s => this.storages.get(s))\r\n    for (const id of primary.inverses) {\r\n      if (secondary.every(storage => storage.hasId(id))) {\r\n        yield new Entity(id, this)\r\n      }\r\n    }\r\n  }\r\n\r\n  set = <T>(...components: any): void => {\r\n    for (const component of components) {\r\n      const Type = component.constructor\r\n      this.resources.set(Type, component)\r\n    }\r\n  }\r\n\r\n  get = <T>(Type: Component<T>): T | undefined => {\r\n    return this.resources.get(Type)\r\n  }\r\n\r\n  unsetAll = <T>(Type: Component<T>): void => {\r\n    const storage = this.storages.get(Type)\r\n    if (!storage) return\r\n    storage.clear()\r\n  }\r\n}\r\n","import { OnDrag, Translate } from './components'\r\nimport { Mat3, Vec3 } from './linear_algebra'\r\nimport * as Studio from './studio'\r\nimport { Entity } from './studio'\r\nconst { ECS, Renderer } = Studio\r\nconst { UIRoot, Alignment, Transform } = Studio.components\r\nconst { text, column, row, container, scene, connection } = Studio.ui\r\nconst { render, rayCast } = Studio.systems\r\n\r\nconst ecs = new ECS()\r\nconst renderer = new Renderer(window.innerWidth, window.innerHeight)\r\nrenderer.canvas.style.width = '100%'\r\nrenderer.canvas.style.height = '100%'\r\n\r\nconst dragSelf = (entity: Entity, x: number, y: number) =>\r\n    entity.update(Translate, translate => {\r\n        translate.x += x\r\n        translate.y += y\r\n    })\r\n\r\nconst sourceOut = container(ecs, { width: 18, height: 18, color: { h: 70, s: 1, l: 0.7, a: 1 } })\r\nconst source = container(ecs, { color: { h: 110, s: 1, l: 0.3, a: 1 }, padding: 10, x: 25, y: 200 },\r\n    column(ecs, { crossAxisAlignment: Alignment.CENTER }, [\r\n        container(ecs, { padding: 5 }, text(ecs, \"Source\")),\r\n        container(ecs, { height: 10 }),\r\n        row(ecs, [\r\n            column(ecs, [\r\n                row(ecs, [\r\n                    container(ecs, { width: 18, height: 18, color: { h: 70, s: 1, l: 0.7, a: 1 } }),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 0\")),\r\n                ]),\r\n                row(ecs, [\r\n                    container(ecs, { width: 18, height: 18, color: { h: 70, s: 1, l: 0.7, a: 1 } }),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 1\")),\r\n                ]),\r\n            ]),\r\n            container(ecs, { width: 30 }),\r\n            column(ecs, { crossAxisAlignment: Alignment.END }, [\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 0\")),\r\n                    container(ecs, { width: 5 }),\r\n                    sourceOut\r\n                ]),\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 1\")),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { width: 18, height: 18, color: { h: 70, s: 1, l: 0.7, a: 1 } })\r\n                ]),\r\n            ])\r\n        ])\r\n    ])\r\n)\r\nsource.set(new OnDrag(dragSelf))\r\n\r\nconst transformIn = container(ecs, { width: 18, height: 18, color: { h: 170, s: 1, l: 0.7, a: 1 } })\r\nconst transformOut = container(ecs, { width: 18, height: 18, color: { h: 170, s: 1, l: 0.7, a: 1 } })\r\nconst transform = container(ecs, { color: { h: 210, s: 1, l: 0.3, a: 1 }, padding: 10, x: 300, y: 100 },\r\n    column(ecs, { crossAxisAlignment: Alignment.CENTER }, [\r\n        container(ecs, { padding: 5 }, text(ecs, \"Transform\")),\r\n        container(ecs, { height: 10 }),\r\n        row(ecs, [\r\n            column(ecs, [\r\n                row(ecs, [\r\n                    transformIn,\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 0\")),\r\n                ]),\r\n                row(ecs, [\r\n                    container(ecs, { width: 18, height: 18, color: { h: 170, s: 1, l: 0.7, a: 1 } }),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 1\")),\r\n                ]),\r\n            ]),\r\n            container(ecs, { width: 30 }),\r\n            column(ecs, { crossAxisAlignment: Alignment.END }, [\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 0\")),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { width: 18, height: 18, color: { h: 170, s: 1, l: 0.7, a: 1 } })\r\n                ]),\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 1\")),\r\n                    container(ecs, { width: 5 }),\r\n                    transformOut\r\n                ]),\r\n            ])\r\n        ])\r\n    ])\r\n)\r\ntransform.set(new OnDrag(dragSelf))\r\n\r\nconst sinkIn = container(ecs, { width: 18, height: 18, color: { h: 270, s: 1, l: 0.7, a: 1 } })\r\nconst sink = container(ecs, { color: { h: 310, s: 1, l: 0.3, a: 1 }, padding: 10, x: 550, y: 250 },\r\n    column(ecs, { crossAxisAlignment: Alignment.CENTER }, [\r\n        container(ecs, { padding: 5 }, text(ecs, \"Sink\")),\r\n        container(ecs, { height: 10 }),\r\n        row(ecs, [\r\n            column(ecs, [\r\n                row(ecs, [\r\n                    container(ecs, { width: 18, height: 18, color: { h: 270, s: 1, l: 0.7, a: 1 } }),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 0\")),\r\n                ]),\r\n                row(ecs, [\r\n                    sinkIn,\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"in 1\")),\r\n                ]),\r\n            ]),\r\n            container(ecs, { width: 30 }),\r\n            column(ecs, { crossAxisAlignment: Alignment.END }, [\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 0\")),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { width: 18, height: 18, color: { h: 270, s: 1, l: 0.7, a: 1 } })\r\n                ]),\r\n                row(ecs, [\r\n                    container(ecs, { padding: 2 }, text(ecs, { fontSize: 18 }, \"out 1\")),\r\n                    container(ecs, { width: 5 }),\r\n                    container(ecs, { width: 18, height: 18, color: { h: 270, s: 1, l: 0.7, a: 1 } })\r\n                ]),\r\n            ])\r\n        ])\r\n    ])\r\n)\r\nsink.set(new OnDrag(dragSelf))\r\n\r\nconst camera = ecs.entity(new Transform(Mat3.identity()),)\r\n\r\nconst root = scene(ecs, {\r\n    camera,\r\n    children: [source, transform, sink],\r\n    connections: [\r\n        connection(ecs, { from: sourceOut, to: transformIn }),\r\n        connection(ecs, { from: transformOut, to: sinkIn }),\r\n    ]\r\n})\r\n\r\necs.set(renderer, new UIRoot(root))\r\n\r\nrequestAnimationFrame(() => render(ecs))\r\n\r\nconst pointers: PointerEvent[] = []\r\nlet dragging = false\r\nlet pointerDistance = 0\r\n\r\ndocument.addEventListener('pointerdown', (e) => {\r\n    pointers.push(e)\r\n    if (pointers.length == 1) dragging = true\r\n})\r\n\r\n\r\nlet draggedEntity: Entity | null = null\r\n\r\ndocument.addEventListener('pointermove', (e) => {\r\n    pointers[pointers.findIndex(p => p.pointerId == e.pointerId)] = e\r\n    if (dragging && pointers.length == 1) {\r\n        if (draggedEntity) {\r\n            const onDrag = draggedEntity.get(OnDrag)!.callback\r\n            onDrag(draggedEntity, e.movementX, e.movementY)\r\n            requestAnimationFrame(() => render(ecs))\r\n            return\r\n        }\r\n        const cameraMatrix = camera.get(Transform)!.matrix\r\n        const mouse = new Vec3([e.clientX, e.clientY, 1])\r\n        for (const entity of rayCast(ecs, cameraMatrix, mouse)) {\r\n            const onDrag = entity.get(OnDrag)\r\n            if (onDrag) {\r\n                draggedEntity = entity\r\n                onDrag.callback(entity, e.movementX, e.movementY)\r\n                requestAnimationFrame(() => render(ecs))\r\n                return\r\n            }\r\n        }\r\n        camera.update(Transform, transform => {\r\n            const translate = Mat3.translation(-e.movementX, -e.movementY)\r\n            transform.matrix = transform.matrix.matMul(translate)\r\n        })\r\n        requestAnimationFrame(() => render(ecs))\r\n    } else if (pointers.length == 2) {\r\n        const [x1, y1] = [pointers[0].clientX, pointers[0].clientY]\r\n        const [x2, y2] = [pointers[1].clientX, pointers[1].clientY]\r\n        const distance = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2))\r\n        if (pointerDistance > 0) {\r\n            const move = Mat3.translation(e.clientX, e.clientY)\r\n            const zoom = Math.pow(2, (pointerDistance - distance) * 0.01)\r\n            const scale = Mat3.scaling(zoom, zoom)\r\n            const moveBack = Mat3.translation(-e.clientX, -e.clientY)\r\n            const result = move.matMul(scale).matMul(moveBack)\r\n            camera.update(Transform, transform =>\r\n                transform.matrix = transform.matrix.matMul(result)\r\n            )\r\n        }\r\n        pointerDistance = distance\r\n        requestAnimationFrame(() => render(ecs))\r\n    }\r\n})\r\n\r\ndocument.addEventListener('pointerup', (e) => {\r\n    pointers.splice(pointers.findIndex(p => p.pointerId == e.pointerId), 1)\r\n    if (pointers.length == 0) {\r\n        dragging = false\r\n        pointerDistance = 0\r\n        draggedEntity = null\r\n    }\r\n})\r\n\r\nwindow.addEventListener('resize', () => {\r\n    renderer.setSize(renderer.canvas.clientWidth, renderer.canvas.clientHeight)\r\n    requestAnimationFrame(() => render(ecs))\r\n})\r\n\r\ndocument.body.appendChild(renderer.canvas)\r\n\r\ndocument.addEventListener('touchend', () => {\r\n    renderer.canvas.requestFullscreen()\r\n})\r\n\r\ndocument.addEventListener('wheel', (e) => {\r\n    e.preventDefault()\r\n    camera.update(Transform, transform => {\r\n        const move = Mat3.translation(e.clientX, e.clientY)\r\n        const zoom = Math.pow(2, e.deltaY * 0.01)\r\n        const scale = Mat3.scaling(zoom, zoom)\r\n        const moveBack = Mat3.translation(-e.clientX, -e.clientY)\r\n        const result = move.matMul(scale).matMul(moveBack)\r\n        transform.matrix = transform.matrix.matMul(result)\r\n    })\r\n    requestAnimationFrame(() => render(ecs))\r\n}, { passive: false })\r\n\r\n//document.addEventListener('keydown', (e) => e.preventDefault())"],"names":["$b28c6149dbdf1c74$export$63548ce3f438e2c4","constructor","entity","$b28c6149dbdf1c74$export$5f1af8db9871e1d6","value","$b28c6149dbdf1c74$export$80f2abd03de5ca5a","$b28c6149dbdf1c74$export$cd0608c167c7849e","$b28c6149dbdf1c74$export$3edfc50f178e5b0b","$b28c6149dbdf1c74$export$dca3b0875bd9a954","entities","$b28c6149dbdf1c74$export$f3ea0776119f0e84","$b28c6149dbdf1c74$export$79f141de891a5fed","$b28c6149dbdf1c74$export$9d7927214ed7d2cf","Alignment1","$b28c6149dbdf1c74$export$66a3248d846611ce","alignment","$b28c6149dbdf1c74$export$8ee255758437644c","$b28c6149dbdf1c74$export$8954cfac7c08d16a","$b28c6149dbdf1c74$export$9db2ba50894db2b9","x","y","$b28c6149dbdf1c74$export$563a914cafbdc389","matrix","$b28c6149dbdf1c74$export$65cfd44a2050f99","scale","$b28c6149dbdf1c74$export$678de176a9a9dea","$b28c6149dbdf1c74$export$d10b08d1cf690764","$b28c6149dbdf1c74$export$892596cec99bc70e","h","s","l","a","this","$b28c6149dbdf1c74$export$8ee6ea94b5aedb49","$b28c6149dbdf1c74$export$6e8e053b4dff75fa","minWidth","maxWidth","minHeight","maxHeight","$b28c6149dbdf1c74$export$cb6da89c6af1a8ec","width","height","$b28c6149dbdf1c74$export$8caee09accd95d7f","add","other","$b28c6149dbdf1c74$export$c84671f46d6a1ca","impl","layout","self","constraints","$b28c6149dbdf1c74$export$77f0fd777d3cc7db","$b28c6149dbdf1c74$export$92bffd8adab203ca","data","$b28c6149dbdf1c74$export$535dd6b7931a007","$b28c6149dbdf1c74$export$c537fa0d021d010b","$b28c6149dbdf1c74$export$fc4f2b7e7f87722c","$b28c6149dbdf1c74$export$39d3d935cf79db44","$b28c6149dbdf1c74$export$2db6c17465f94a2","geometry","parentOffset","layers","z","$b28c6149dbdf1c74$export$b11ff02aa7665438","callback","$a26733d1baff63db$export$838423f3adec30fa","$a26733d1baff63db$export$83f4edd572c84121","matMul","b","a11","a12","a13","a21","a22","a23","a31","a32","a33","b11","b12","b13","b21","b22","b23","b31","b32","b33","vecMul","b1","b2","b3","inverse","idet","static","radians","c","Math","cos","sin","$621f3774f67738fc$var$DefaultProgram","gl","vertexShader","createShader","VERTEX_SHADER","shaderSource","compileShader","fragmentShader","FRAGMENT_SHADER","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","log","getShaderInfoLog","vertexArrayObject","createVertexArray","bindVertexArray","positionBuffer","createBuffer","bindAttribLocation","enableVertexAttribArray","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","FLOAT","textureCoordinatesBuffer","colorBuffer","matrixIndexBuffer","vertexAttribIPointer","UNSIGNED_BYTE","indexBuffer","devicePixelRatioLocation","getUniformLocation","matricesLocation","texture","metrics","fontFamily","fontSize","metric","charCodeAt","$621f3774f67738fc$var$createFontMetrics","font","canvas","document","createElement","ctx","getContext","rows","sqrt","size","current","$621f3774f67738fc$var$nearestPowerOfTwo","cellSize","window","devicePixelRatio","style","textAlign","textBaseline","fillStyle","chars","Array","from","length","v","i","map","String","fromCharCode","clearRect","measureText","ceil","floor","fillText","TEXTURE_2D","RGBA","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","touchAction","clearColor","enable","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","depthMask","pixelStorei","UNPACK_PREMULTIPLY_ALPHA_WEBGL","activeTexture","TEXTURE0","fontAtlasses","Map","textures","setSize","createTexture","bindTexture","texImage2D","Uint8Array","push","uniform2f","resolutionLocation","uniform1f","viewport","recreateFontAtlasses","COLOR_BUFFER_BIT","matrices","uniformMatrix3fv","vertices","colors","textureCoordinates","vertexIndices","cameraIndices","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","$9a7c059fd1344034$export$b3890eb0ae9dca99","ecs","$cb3d056828175573$export$b3219800bda33a1f","$90a5a29c0fcb75eb$export$42a7622cbf932bb","renderer","get","$621f3774f67738fc$export$88530751e3977073","projection","setMatrices","cameras","camera","clear","previousTexture","layer","draw","offset","index","$9a7c059fd1344034$var$renderTriangles","lines","drawLines","$9a7c059fd1344034$var$renderLines","set","ui","$3b19fb344542138e$export$89312ce47c0ca777","identity","activeCamera","pushAndSetActiveCamera","$231f2a51c75bf33f$export$51be7442bbfe168a","vec","mx","my","_","reverse","values","$2d5075f154be1094$var$layout","text1","atlas","fontAtlas","max","$2d5075f154be1094$var$textSize","$2d5075f154be1094$var$geometry","text2","indexOffset","indices","x0","x1","y0","y1","fill","$2d5075f154be1094$var$textGeometry","$2d5075f154be1094$export$6f093cfa640b7166","args","properties","color","$fd89ce3675dee463$var$layout","child","childSize","update","$fd89ce3675dee463$var$geometry","$fd89ce3675dee463$export$3481c78889e8fbe8","$518015a6e3cc694d$var$layout","children","START","CENTER","child1","childWidth","END","child2","$518015a6e3cc694d$var$geometry","$518015a6e3cc694d$export$4e0c71f277ca26b3","crossAxisAlignment","$9e4edab979495f0d$var$layout","childHeight","$9e4edab979495f0d$var$geometry","$9e4edab979495f0d$export$120ff0929b202a6d","$8a99d960732a172f$var$clamp","min","$8a99d960732a172f$var$layout","padding","offset1","$8a99d960732a172f$var$geometry","$8a99d960732a172f$export$34e0f9847d4c02dd","$5dee3d2e57488100$var$cubicBezier","ts","to","p0x","p0y","p1x","p1y","p3x","p3y","p2x","p2y","result","lastX","lastY","t","tSquared","tCubed","oneMinusT","oneMinusTSquared","oneMinusTCubed","$5dee3d2e57488100$export$42a7622cbf932bb","connections","start","stop","num","step","$5dee3d2e57488100$var$linspace","samples","$5dee3d2e57488100$export$412d2991813e589a","$864b15efd9f5e1a7$var$layout","$864b15efd9f5e1a7$var$geometry","$864b15efd9f5e1a7$export$33aff30b8aa0934e","$556f46b6ec271235$var$Storage","lookup","id","undefined","hasId","has","component","inverses","$556f46b6ec271235$export$bc644a473284d944","components","Type","storage","storages","f","$556f46b6ec271235$export$d01098d378880d3","nextEntityId","resources","query","primary","secondary","slice","every","unsetAll","ECS","$b4e14b6b8da86996$var$ECS","Renderer","$b4e14b6b8da86996$var$Renderer","$91ae824a8b26c87f$exports","UIRoot","$b4e14b6b8da86996$var$UIRoot","Alignment","$b4e14b6b8da86996$var$Alignment","Transform","$b4e14b6b8da86996$var$Transform","text","$b4e14b6b8da86996$var$text","column","$b4e14b6b8da86996$var$column","row","$b4e14b6b8da86996$var$row","container","$b4e14b6b8da86996$var$container","scene","$b4e14b6b8da86996$var$scene","connection","$b4e14b6b8da86996$var$connection","render","$b4e14b6b8da86996$var$render","rayCast","$b4e14b6b8da86996$var$rayCast","systems","$b4e14b6b8da86996$var$ecs","$b4e14b6b8da86996$var$renderer","innerWidth","innerHeight","$b4e14b6b8da86996$var$dragSelf","translate","$b4e14b6b8da86996$var$sourceOut","$b4e14b6b8da86996$var$source","$b4e14b6b8da86996$var$transformIn","$b4e14b6b8da86996$var$transformOut","$b4e14b6b8da86996$var$transform","$b4e14b6b8da86996$var$sinkIn","$b4e14b6b8da86996$var$sink","$b4e14b6b8da86996$var$camera","$b4e14b6b8da86996$var$root","requestAnimationFrame","$b4e14b6b8da86996$var$pointers","$b4e14b6b8da86996$var$dragging","$b4e14b6b8da86996$var$pointerDistance","addEventListener","e","$b4e14b6b8da86996$var$draggedEntity","findIndex","p","pointerId","onDrag","movementX","movementY","cameraMatrix","mouse","clientX","clientY","transform1","translation","x2","y2","distance","pow","move","zoom","scaling","moveBack","transform2","splice","clientWidth","clientHeight","body","appendChild","requestFullscreen","preventDefault","transform3","deltaY","passive"],"version":3,"file":"index.b78beb7a.js.map"}
function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}var e={};t(e,"UIRoot",(()=>n)),t(e,"Text",(()=>i)),t(e,"FontSize",(()=>s)),t(e,"FontFamily",(()=>o)),t(e,"Child",(()=>r)),t(e,"Children",(()=>a)),t(e,"Connections",(()=>c)),t(e,"Camera",(()=>h)),t(e,"Alignment",(()=>l)),t(e,"CrossAxisAlignment",(()=>d)),t(e,"Width",(()=>g)),t(e,"Height",(()=>f)),t(e,"Translate",(()=>w)),t(e,"Transform",(()=>m)),t(e,"Zoom",(()=>x)),t(e,"From",(()=>y)),t(e,"To",(()=>A)),t(e,"Color",(()=>p)),t(e,"Padding",(()=>v)),t(e,"Constraints",(()=>R)),t(e,"Size",(()=>E)),t(e,"Offset",(()=>_)),t(e,"Layout",(()=>T)),t(e,"WorldSpace",(()=>F)),t(e,"Vertices",(()=>C)),t(e,"TextureCoordinates",(()=>B)),t(e,"Colors",(()=>b)),t(e,"VertexIndices",(()=>S)),t(e,"CameraIndices",(()=>D)),t(e,"Geometry",(()=>I)),t(e,"OnDrag",(()=>U)),t(e,"OnClick",(()=>M)),t(e,"Pointers",(()=>P)),t(e,"PointerDistance",(()=>L)),t(e,"Dragging",(()=>Y)),t(e,"DraggedEntity",(()=>k)),t(e,"ConnectionFrom",(()=>N)),t(e,"ConnectionTo",(()=>W));class n{constructor(t){this.entity=t}}class i{constructor(t){this.value=t}}class s{constructor(t){this.value=t}}class o{constructor(t){this.value=t}}class r{constructor(t){this.entity=t}}class a{constructor(t){this.entities=t}}class c{constructor(t){this.entities=t}}class h{constructor(t){this.entity=t}}let l;var u;(u=l||(l={}))[u.START=0]="START",u[u.CENTER=1]="CENTER",u[u.END=2]="END";class d{constructor(t){this.alignment=t}}class g{constructor(t){this.value=t}}class f{constructor(t){this.value=t}}class w{constructor(t,e){this.x=t,this.y=e}}class m{constructor(t){this.matrix=t}}class x{constructor(t,e,n){this.scale=t,this.x=e,this.y=n}}class y{constructor(t){this.entity=t}}class A{constructor(t){this.entity=t}}class p{constructor(t,e,n,i){this.r=t,this.g=e,this.b=n,this.a=i}}class v{constructor(t){this.value=t}}class R{constructor(t,e,n,i){this.minWidth=t,this.maxWidth=e,this.minHeight=n,this.maxHeight=i}}class E{constructor(t,e){this.width=t,this.height=e}}class _{constructor(t,e){this.x=t,this.y=e,this.add=t=>new _(this.x+t.x,this.y+t.y)}}class T{constructor(t){this.impl=t,this.layout=(t,e)=>this.impl(t,e)}}class F{constructor(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}}class C{constructor(t){this.data=t}}class B{constructor(t){this.data=t}}class b{constructor(t){this.data=t}}class S{constructor(t){this.data=t}}class D{constructor(t){this.data=t}}class I{constructor(t){this.impl=t,this.geometry=(t,e,n,i)=>this.impl(t,e,n,i)}}class U{constructor(t){this.callback=t}}class M{constructor(t){this.callback=t}}class P{constructor(t){this.events=t}}class L{constructor(t){this.value=t}}class Y{constructor(t){this.value=t}}class k{constructor(t){this.entity=t}}class N{constructor(t){this.entity=t}}class W{constructor(t){this.entity=t}}var X={};t(X,"Vec3",(()=>H)),t(X,"Mat3",(()=>q));class H{constructor(t){this.data=t,this.length=()=>{const[t,e,n]=this.data;return Math.sqrt(Math.pow(t,2)+Math.pow(e,2)+Math.pow(n,2))}}}class q{constructor(t){this.data=t,this.matMul=t=>{const e=this.data,n=t.data,i=e[0],s=e[1],o=e[2],r=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=n[0],g=n[1],f=n[2],w=n[3],m=n[4],x=n[5],y=n[6],A=n[7],p=n[8];return new q([i*d+s*w+o*y,i*g+s*m+o*A,i*f+s*x+o*p,r*d+a*w+c*y,r*g+a*m+c*A,r*f+a*x+c*p,h*d+l*w+u*y,h*g+l*m+u*A,h*f+l*x+u*p])},this.vecMul=t=>{const e=this.data,n=t.data,i=e[0],s=e[1],o=e[2],r=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],d=n[0],g=n[1],f=n[2];return new H([i*d+s*g+o*f,r*d+a*g+c*f,h*d+l*g+u*f])},this.inverse=()=>{const t=this.data,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],r=t[5],a=t[6],c=t[7],h=t[8],l=n*r-i*o,u=e*r-i*s,d=e*o-n*s,g=1/(a*l-c*u+h*d);return new q([g*(o*h-r*c),g*-(n*h-i*c),g*l,g*-(s*h-r*a),g*(e*h-i*a),g*-u,g*(s*c-o*a),g*-(e*c-n*a),g*d])}}static identity=()=>new q([1,0,0,0,1,0,0,0,1]);static projection=(t,e)=>new q([2/t,0,-1,0,-2/e,1,0,0,1]);static translation=(t,e)=>new q([1,0,t,0,1,e,0,0,1]);static rotation=t=>{const e=Math.cos(t),n=Math.sin(t);return new q([e,n,0,-n,e,0,0,0,1])};static scaling=(t,e)=>new q([t,0,0,0,e,0,0,0,1])}var z={};t(z,"ECS",(()=>Nt)),t(z,"Entity",(()=>kt)),t(z,"Renderer",(()=>$)),t(z,"systems",(()=>O)),t(z,"components",(()=>e)),t(z,"ui",(()=>ht)),t(z,"Layers",(()=>J)),t(z,"linear_algebra",(()=>X));var O={};t(O,"render",(()=>K)),t(O,"layout",(()=>Z)),t(O,"geometry",(()=>Q)),t(O,"rayCast",(()=>tt)),t(O,"init",(()=>ct)),t(O,"pointerDown",(()=>et)),t(O,"pointerMove",(()=>it)),t(O,"pointerUp",(()=>st)),t(O,"clickInput",(()=>Mt)),t(O,"clickOutput",(()=>Pt)),t(O,"drag",(()=>Lt));class G{constructor(t){const e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,"#version 300 es\n  uniform float u_devicePixelRatio;\n  uniform mat3[8] u_cameras;\n  uniform mat3 u_projection;\n\n  layout(location = 0) in vec2 a_position;\n  layout(location = 1) in vec2 a_textureCoordinates;\n  layout(location = 2) in vec4 a_color;\n  layout(location = 3) in uint a_cameraIndex;\n\n  out vec2 v_textureCoordinates;\n  out vec4 v_color;\n\n  void main() {\n    mat3 matrix = u_projection * inverse(u_cameras[a_cameraIndex]);\n    gl_Position = vec4((matrix * vec3(a_position, 1)).xy, 0, 1);\n    v_textureCoordinates = a_textureCoordinates * u_devicePixelRatio;\n    v_color = a_color / 255.0;\n  }\n  "),t.compileShader(e);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec2 v_textureCoordinates;\n  in vec4 v_color;\n\n  out vec4 fragColor;\n  \n  void main() {\n    ivec2 size = textureSize(u_texture, 0);\n    vec2 coordinate = v_textureCoordinates / vec2(float(size.x), float(size.y));\n    fragColor = texture(u_texture, coordinate) * v_color;\n  }\n  "),t.compileShader(n);const i=t.createProgram();t.attachShader(i,e),t.attachShader(i,n),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||(console.log(t.getShaderInfoLog(e)),console.log(t.getShaderInfoLog(n))),t.useProgram(i);const s=t.createVertexArray();t.bindVertexArray(s),this.positionBuffer=t.createBuffer(),t.bindAttribLocation(i,0,"a_position"),t.enableVertexAttribArray(0),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0),this.textureCoordinatesBuffer=t.createBuffer(),t.bindAttribLocation(i,1,"a_textureCoordinates"),t.enableVertexAttribArray(1),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordinatesBuffer),t.vertexAttribPointer(1,2,t.FLOAT,!1,0,0),this.colorBuffer=t.createBuffer(),t.bindAttribLocation(i,2,"a_color"),t.enableVertexAttribArray(2),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.vertexAttribPointer(2,4,t.FLOAT,!1,0,0),this.cameraIndexBuffer=t.createBuffer(),t.bindAttribLocation(i,3,"a_cameraIndex"),t.enableVertexAttribArray(3),t.bindBuffer(t.ARRAY_BUFFER,this.cameraIndexBuffer),t.vertexAttribIPointer(3,1,t.UNSIGNED_SHORT,0,0),this.indexBuffer=t.createBuffer(),this.devicePixelRatioLocation=t.getUniformLocation(i,"u_devicePixelRatio"),this.camerasLocation=t.getUniformLocation(i,"u_cameras"),this.projectionLocation=t.getUniformLocation(i,"u_projection")}}class j{constructor(t,e,n,i){this.texture=t,this.metrics=e,this.fontFamily=n,this.fontSize=i,this.metric=t=>this.metrics[t.charCodeAt(0)]}}const V=(t,e,n,i)=>{const s=document.createElement("canvas"),o=s.getContext("2d"),r=Math.sqrt(256),a=(t=>{let e=1;for(;e<t;)e<<=1;return e})(i*r),c=a/r;s.width=a*window.devicePixelRatio,s.height=a*window.devicePixelRatio,s.style.width=`${a}px`,s.style.height=`${a}px`,o.scale(window.devicePixelRatio,window.devicePixelRatio),o.textAlign="left",o.textBaseline="top",o.font=n,o.fillStyle="white";const h=Array.from({length:256},((t,e)=>e)).map((t=>String.fromCharCode(t)));o.clearRect(0,0,o.canvas.width,o.canvas.height);const l=h.map(((t,e)=>{const n=o.measureText(t),s=Math.ceil(n.width),a=i,h=e%r*c,l=Math.floor(e/r)*c;return o.fillText(t,h,l),{x:h,y:l,width:s,height:a}}));return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),l};class ${constructor(t,e){const n=document.createElement("canvas");n.style.touchAction="none";const i=n.getContext("webgl2");i.clearColor(0,0,0,1),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthMask(!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),i.activeTexture(i.TEXTURE0),this.gl=i,this.canvas=n,this.program=new G(i),this.fontAtlasses=new Map,this.textures=[],this.devicePixelRatio=window.devicePixelRatio,this.setSize(t,e);const s=i.createTexture();i.bindTexture(i.TEXTURE_2D,s),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,1,1,0,i.RGBA,i.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this.textures.push(s)}setSize=(t,e)=>{const{gl:n,canvas:i}=this;i.width=t*window.devicePixelRatio,i.height=e*window.devicePixelRatio,n.uniform2f(this.program.resolutionLocation,i.width,i.height),n.uniform1f(this.program.devicePixelRatioLocation,window.devicePixelRatio),n.viewport(0,0,i.width,i.height),this.width=t,this.height=e,this.devicePixelRatio!==window.devicePixelRatio&&(this.devicePixelRatio=window.devicePixelRatio,this.recreateFontAtlasses())};clear=()=>{const{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)};setCameras=t=>{const e=[];for(const n of t)e.push(...n.data);this.gl.uniformMatrix3fv(this.program.camerasLocation,!0,e)};setProjection=t=>this.gl.uniformMatrix3fv(this.program.projectionLocation,!0,t.data);draw=({vertices:t,colors:e,textureCoordinates:n,vertexIndices:i,cameraIndices:s})=>{const{gl:o,program:r}=this;o.bindBuffer(o.ARRAY_BUFFER,r.positionBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.colorBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.textureCoordinatesBuffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(n),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,r.cameraIndexBuffer),o.bufferData(o.ARRAY_BUFFER,new Uint16Array(s),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,r.indexBuffer),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),o.STATIC_DRAW),o.drawElements(o.TRIANGLES,i.length,o.UNSIGNED_SHORT,0)};drawLines=({vertices:t,colors:e,textureCoordinates:n,cameraIndices:i})=>{const{gl:s,program:o}=this;s.bindBuffer(s.ARRAY_BUFFER,o.positionBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(t),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,o.colorBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(e),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,o.textureCoordinatesBuffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(n),s.STATIC_DRAW),s.bindBuffer(s.ARRAY_BUFFER,o.cameraIndexBuffer),s.bufferData(s.ARRAY_BUFFER,new Uint16Array(i),s.STATIC_DRAW),s.drawArrays(s.LINES,0,t.length/2)};recreateFontAtlasses=()=>{for(const[t,e]of this.fontAtlasses){const n=this.textures[e.texture],i=V(this.gl,n,t,e.fontSize);e.metrics=i}};fontAtlas=(t,e)=>{const n=`${e}px ${t}`,i=this.fontAtlasses.get(n);if(i)return i;const{gl:s}=this,o=s.createTexture(),r=V(s,o,n,e),a=this.textures.length;this.textures.push(o);const c=new j(a,r,t,e);return this.fontAtlasses.set(n,c),c}}const K=t=>{const e=t.get(n).entity;Z(e);const i=Q(e),s=t.get($),o=q.projection(s.width,s.height);s.setProjection(o),s.setCameras(i.cameras),s.clear(),((t,e)=>{const{gl:n}=t;let i=[],s=[],o=[],r=[],a=[],c=-1;for(const h of e.layers)for(const[e,l]of h){e!==c&&(i.length&&(t.draw({vertices:i,colors:s,textureCoordinates:o,vertexIndices:a,cameraIndices:r}),i=[],s=[],o=[],r=[],a=[]),c=e,n.bindTexture(n.TEXTURE_2D,t.textures[e]));for(const t of l){const e=i.length/2;i.push(...t.get(C).data),s.push(...t.get(b).data),o.push(...t.get(B).data);for(const n of t.get(S).data)a.push(e+n);r.push(...t.get(D).data)}}0!==i.length&&t.draw({vertices:i,colors:s,textureCoordinates:o,vertexIndices:a,cameraIndices:r})})(s,i),((t,e)=>{const{gl:n}=t;let i=[],s=[],o=[],r=[];n.bindTexture(n.TEXTURE_2D,t.textures[0]);for(const t of e.lines)i.push(...t.get(C).data),s.push(...t.get(b).data),o.push(...t.get(B).data),r.push(...t.get(D).data);0!==i.length&&t.drawLines({vertices:i,colors:s,textureCoordinates:o,cameraIndices:r})})(s,i),t.set(i)},Z=t=>{const{width:e,height:n}=t.ecs.get($),i=new R(0,e,0,n);t.get(T).layout(t,i)};class J{constructor(){this.cameras=[q.identity()],this.cameraStack=[0],this.cameraForEntity=new Map,this.layers=[],this.lines=[]}activeCamera=()=>this.cameraStack.slice(-1)[0];pushCamera=t=>{const e=this.cameras.length;return this.cameras.push(t),this.cameraStack.push(e),e};popCamera=()=>this.cameraStack.pop();push=({z:t,texture:e,entity:n})=>{this.cameraForEntity.set(n,this.activeCamera());for(let e=this.layers.length;e<t+1;++e)this.layers.push(new Map);const i=this.layers[t],s=i.get(e);s?s.push(n):i.set(e,[n])}}const Q=t=>{const e=new J;return t.get(I).geometry(t,new _(0,0),e,0),e};function*tt(t,e,n){const[i,s,o]=e.vecMul(n).data;for(const e of t.get(J).layers.reverse())for(const t of e.values())for(const e of t){const{x:t,y:n,width:o,height:r}=e.get(F);i>t&&i<t+o&&s>n&&s<n+r&&(yield e)}}const et=t=>{const e=t.ecs;document.addEventListener("pointerdown",(n=>{if(1!==e.update(P,(t=>(t.events.push(n),t.events.length))))return;const i=t.get(h).entity.get(m).matrix,s=new H([n.clientX,n.clientY,1]);for(const t of tt(e,i,s)){console.log(t.id);const n=t.get(M);if(n)return n.callback(t),void requestAnimationFrame((()=>K(e)))}e.update(Y,(t=>t.value=!0))}))},nt=(t,e)=>{const n=t.ecs,i=n.get(P).events,s=i.findIndex((t=>t.pointerId===e.pointerId));if(-1===s)return;const o=e.clientX-i[s].clientX,r=e.clientY-i[s].clientY;i[s]=e,n.get(Y).value&&1===i.length?((t,e,n,i)=>{const s=t.ecs,o=t.get(h).entity,r=s.get(k).entity;if(r){const t=r.get(U).callback,e=o.get(m).matrix.vecMul(new H([0,1,0])).length();return t(r,n*e,i*e),void requestAnimationFrame((()=>K(s)))}const a=o.get(m).matrix,c=new H([e.clientX,e.clientY,1]);for(const t of tt(s,a,c)){const e=t.get(U);if(e){s.update(k,(e=>e.entity=t));const r=o.get(m).matrix.vecMul(new H([0,1,0])).length();return e.callback(t,n*r,i*r),void requestAnimationFrame((()=>K(s)))}}o.update(m,(t=>{const e=q.translation(-n,-i);t.matrix=t.matrix.matMul(e)})),requestAnimationFrame((()=>K(s)))})(t,e,o,r):2===i.length&&((t,e,n)=>{const i=t.ecs,[s,o]=[e[0].clientX,e[0].clientY],[r,a]=[e[1].clientX,e[1].clientY],c=Math.sqrt(Math.pow(r-s,2)+Math.pow(a-o,2)),l=i.get(L).value;if(l>0){const e=q.translation(n.clientX,n.clientY),i=Math.pow(2,.01*(l-c)),s=q.scaling(i,i),o=q.translation(-n.clientX,-n.clientY),r=e.matMul(s).matMul(o);t.get(h).entity.update(m,(t=>t.matrix=t.matrix.matMul(r)))}i.update(L,(t=>t.value=c)),requestAnimationFrame((()=>K(i)))})(t,i,e)},it=t=>{"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>e.getCoalescedEvents().forEach((e=>nt(t,e))))):document.addEventListener("pointermove",(e=>nt(t,e)))},st=t=>{document.addEventListener("pointerup",(e=>{0===t.update(P,(t=>(t.events.splice(t.events.findIndex((t=>t.pointerId===e.pointerId)),1),t.events.length)))&&(t.update(Y,(t=>t.value=!1)),t.update(L,(t=>t.value=0)),t.update(k,(t=>t.entity=null)))}))},ot=t=>{const e=t.get($);window.addEventListener("resize",(()=>{e.setSize(e.canvas.clientWidth,e.canvas.clientHeight),requestAnimationFrame((()=>K(t)))}))},rt=t=>{const e=t.get($);document.addEventListener("touchend",(()=>{e.canvas.requestFullscreen()}))},at=t=>{document.addEventListener("wheel",(e=>{const n=t.get(h).entity;e.preventDefault(),n.update(m,(t=>{const n=q.translation(e.clientX,e.clientY),i=Math.pow(2,.01*e.deltaY),s=q.scaling(i,i),o=q.translation(-e.clientX,-e.clientY),r=n.matMul(s).matMul(o);t.matrix=t.matrix.matMul(r)})),requestAnimationFrame((()=>K(t.ecs)))}),{passive:!1})},ct=t=>{const e=t.ecs;e.set(new P([]),new L(0),new Y(!1),new k(null),new N(null),new W(null)),et(t),it(t),st(e),ot(e),rt(e),at(t)};var ht={};t(ht,"text",(()=>dt)),t(ht,"center",(()=>wt)),t(ht,"column",(()=>yt)),t(ht,"row",(()=>vt)),t(ht,"container",(()=>_t)),t(ht,"scene",(()=>St)),t(ht,"stack",(()=>Ut)),t(ht,"connection",(()=>Ct));const lt=(t,e)=>{const n=((t,e)=>{const n=e.get(i).value,r=e.get(s).value,a=e.get(o).value,c=t.fontAtlas(a,r);let h=new E(0,0);for(const t of n){const e=c.metric(t);h.width+=e.width,h.height=Math.max(e.height,h.height)}return h})(t.ecs.get($),t);return t.set(e,n,new _(0,0)),n},ut=(t,e,n,r)=>{const{width:a,height:c}=t.get(E),h=e.add(t.get(_));((t,e,n,r,a)=>{const c=e.get(i).value,h=e.get(s).value,l=e.get(o).value,{r:u,g:d,b:g,a:f}=e.get(p),w=t.fontAtlas(l,h);let m=0,x=0;const y=[],A=[],v=[],R=[];for(const t of c){const e=w.metric(t),i=n.x+m,s=i+e.width,o=n.y,r=o+e.height;y.push(i,o,i,r,s,o,s,r),A.push(e.x,e.y,e.x,e.y+e.height,e.x+e.width,e.y,e.x+e.width,e.y+e.height),v.push(u,d,g,f,u,d,g,f,u,d,g,f,u,d,g,f),R.push(x+0,x+1,x+2,x+1,x+2,x+3),m+=e.width,x+=4}r.push({z:a,entity:e,texture:w.texture}),e.set(new C(y),new B(A),new b(v),new S(R),new D(Array(y.length/2).fill(r.cameraForEntity.get(e)))),w.texture})(t.ecs.get($),t,h,n,r),t.set(new F(h.x,h.y,a,c))},dt=(t,...e)=>{const[n,r]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]];return t.entity(new i(r),new s(n.fontSize??28),new o(n.fontFamily??"monospace"),n.color??new p(255,255,255,255),new T(lt),new I(ut))},gt=(t,e)=>{const n=t.get(r).entity,i=n.get(T).layout(n,e);n.update(_,(t=>{t.x=e.maxWidth/2-i.width/2,t.y=e.maxHeight/2-i.height/2}));const s=new E(e.maxWidth,e.maxHeight);return t.set(e,s,new _(0,0)),s},ft=(t,e,n,i)=>{const{width:s,height:o}=t.get(E),a=e.add(t.get(_)),c=t.get(r).entity;c.get(I).geometry(c,a,n,i),t.set(new F(a.x,a.y,s,o))},wt=(t,e)=>t.entity(new T(gt),new I(ft),new r(e)),mt=(t,e)=>{let n=0,i=0;const s=t.get(a).entities;for(const t of s){const s=t.get(T).layout(t,e);t.update(_,(t=>t.y=i)),i+=s.height,n=Math.max(n,s.width)}switch(t.get(d).alignment){case l.START:break;case l.CENTER:for(const t of s){const e=t.get(E).width;t.update(_,(t=>t.x=n/2-e/2))}break;case l.END:for(const t of s){const e=t.get(E).width;t.update(_,(t=>t.x=n-e))}}const o=new E(n,i);return t.set(e,o,new _(0,0)),o},xt=(t,e,n,i)=>{const{width:s,height:o}=t.get(E),r=e.add(t.get(_));for(const e of t.get(a).entities)e.get(I).geometry(e,r,n,i);t.set(new F(r.x,r.y,s,o))},yt=(t,...e)=>{const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return t.entity(new T(mt),new I(xt),new a(i),new d(n.crossAxisAlignment??l.START))},At=(t,e)=>{let n=0,i=0;const s=t.get(a).entities;for(const t of s){const s=t.get(T).layout(t,e);t.update(_,(t=>t.x=n)),n+=s.width,i=Math.max(i,s.height)}switch(t.get(d).alignment){case l.START:break;case l.CENTER:for(const t of s){const e=t.get(E).height;t.update(_,(t=>t.y=i/2-e/2))}break;case l.END:for(const t of s){const e=t.get(E).height;t.update(_,(t=>t.y=i-e))}}const o=new E(n,i);return t.set(e,o,new _(0,0)),o},pt=(t,e,n,i)=>{const{width:s,height:o}=t.get(E),r=e.add(t.get(_));for(const e of t.get(a).entities)e.get(I).geometry(e,r,n,i);t.set(new F(r.x,r.y,s,o))},vt=(t,...e)=>{const[n,i]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return t.entity(new T(At),new I(pt),new a(i),new d(n.crossAxisAlignment??l.START))},Rt=(t,e)=>{const n=t.get(v).value,i=t.get(r),{x:s,y:o}=t.get(w),a=new _(s,o);if(i){const s=i.entity.get(T).layout(i.entity,e),o=new E(Math.min(e.maxWidth,s.width+2*n),Math.min(e.maxHeight,s.height+2*n));return i.entity.update(_,(t=>{t.x=n,t.y=n})),t.set(e,o,a),o}const c=(()=>{const n=t.get(g);return void 0!==n?n.value:e.maxWidth})(),h=(()=>{const n=t.get(f);return void 0!==n?n.value:e.maxHeight})(),l=new E(c,h);return t.set(e,l,a),l},Et=(t,e,n,i)=>{const s=e.add(t.get(_)),{width:o,height:a}=t.get(E),c=s.x,h=c+o,l=s.y,u=l+a,d=t.get(p);if(d){const{r:e,g:s,b:o,a:r}=d;n.push({z:i,texture:0,entity:t}),t.set(new C([c,l,c,u,h,l,h,u]),new B(Array(8).fill(0)),new b([e,s,o,r,e,s,o,r,e,s,o,r,e,s,o,r]),new S([0,1,2,1,2,3]),new D(Array(4).fill(n.cameraForEntity.get(t))))}const g=t.get(r);g&&g.entity.get(I).geometry(g.entity,s,n,i+1),t.set(new F(c,l,o,a))},_t=(t,e,n)=>{const i=t.entity(new T(Rt),new I(Et),new v(e.padding??0),new w(e.x??0,e.y??0));return void 0!==e.width&&i.set(new g(e.width)),void 0!==e.height&&i.set(new f(e.height)),void 0!==n&&i.set(new r(n)),void 0!==e.color&&i.set(e.color),void 0!==e.onDrag&&i.set(new U(e.onDrag)),void 0!==e.onClick&&i.set(new M(e.onClick)),i},Tt=(t,e,n)=>{const i=e.x+e.width/2,s=e.y+e.height/2,o=i+50,r=s,a=n.x+n.width/2,c=n.y+n.height/2,h=a-50,l=c,u=[];let d=0,g=0;for(const e of t){const t=e*e,n=t*e,f=1-e,w=f*f,m=w*f,x=3*w*e,y=3*f*t,A=m*i+x*o+y*h+n*a,p=m*s+x*r+y*l+n*c;u.length?u.push(d,g):u.push(A,p),u.push(A,p),d=A,g=p}return u},Ft=(t,e)=>{const n=((t,e,n)=>{const i=(e-t)/(n-1);return Array.from({length:n},((e,n)=>t+i*n))})(0,1,20),i=Array(80).fill(0),s=e.activeCamera();for(const o of t){const t=o.get(y).entity.get(F),r=o.get(A).entity.get(F),a=Tt(n,t,r),{r:c,g:h,b:l,a:u}=o.get(p),d=[];for(let t=0;t<40;++t)d.push(c,h,l,u);e.lines.push(o),e.cameraForEntity.set(o,s),o.set(new C(a),new B(i),new b(d),new D(Array(a.length/2).fill(s)))}},Ct=(t,e)=>t.entity(new y(e.from),new A(e.to),e.color??new p(255,255,255,255)),Bt=(t,e)=>{for(const n of t.get(a).entities)n.get(T).layout(n,e);const n=new E(e.maxWidth,e.maxHeight);return t.set(e,n,new _(0,0)),n},bt=(t,e,n,i)=>{const{width:s,height:o}=t.get(E),r=e.add(t.get(_));n.pushCamera(t.get(h).entity.get(m).matrix);for(const e of t.get(a).entities)e.get(I).geometry(e,r,n,i);Ft(t.get(c).entities,n),t.set(new F(r.x,r.y,s,o))},St=(t,e)=>(e=e??{},t.entity(new T(Bt),new I(bt),new a(e.children??[]),new c(e.connections??[]))),Dt=(t,e)=>{const n=t.get(a).entities;for(const t of n)t.get(T).layout(t,e);const i=new E(e.maxWidth,e.maxHeight);return t.set(e,i,new _(0,0)),i},It=(t,e,n,i)=>{const{width:s,height:o}=t.get(E),r=e.add(t.get(_));for(const e of t.get(a).entities)e.get(I).geometry(e,r,n,i),i+=1;t.set(new F(r.x,r.y,s,o))},Ut=(t,e)=>t.entity(new T(Dt),new I(It),new a(e)),Mt=t=>e=>{const n=e.ecs,i=n.get(W).entity,s=n.get(N).entity;if(s){const i=Ct(n,{from:s,to:e});t.update(c,(t=>t.entities.push(i))),s.set(new p(101,215,249,255)),n.update(N,(t=>t.entity=null)),requestAnimationFrame((()=>K(n)))}else{if(i===e)return;null!==i&&i.set(new p(101,215,249,255)),n.update(W,(t=>t.entity=e)),e.set(new p(67,76,112,255)),requestAnimationFrame((()=>K(n)))}},Pt=t=>e=>{const n=e.ecs,i=n.get(W).entity,s=n.get(N).entity;if(i){const s=Ct(n,{from:e,to:i});t.update(c,(t=>t.entities.push(s))),i.set(new p(101,215,249,255)),n.update(W,(t=>t.entity=null)),requestAnimationFrame((()=>K(n)))}else{if(s===e)return;null!==s&&s.set(new p(101,215,249,255)),n.update(N,(t=>t.entity=e)),e.set(new p(67,76,112,255)),requestAnimationFrame((()=>K(n)))}},Lt=(t,e,n)=>t.update(w,(t=>{t.x+=e,t.y+=n}));class Yt{constructor(){this.clear()}get=t=>{const e=this.lookup.get(t.id);return void 0!==e?this.data[e]:void 0};hasId=t=>this.lookup.has(t);set=(t,e)=>{const n=this.lookup.get(t.id);if(n)return this.data[n]=e,void(this.inverses[n]=t.id);this.lookup.set(t.id,this.data.length),this.data.push(e),this.inverses.push(t.id)};clear=()=>{this.lookup=new Map,this.data=[],this.inverses=[]}}class kt{constructor(t,e){this.id=t,this.ecs=e,this.set=(...t)=>{for(const e of t){const t=e.constructor;let n=this.ecs.storages.get(t);n||(n=new Yt,this.ecs.storages.set(t,n)),n.set(this,e)}return this},this.get=t=>{const e=this.ecs.storages.get(t);return e?e.get(this):void 0},this.update=(t,e)=>e(this.ecs.storages.get(t).get(this))}}class Nt{constructor(){this.nextEntityId=0,this.storages=new Map,this.resources=new Map}entity=(...t)=>{const e=new kt(this.nextEntityId,this);return e.set(...t),++this.nextEntityId,e};set=(...t)=>{for(const e of t){const t=e.constructor;this.resources.set(t,e)}};get=t=>this.resources.get(t);update=(t,e)=>e(this.resources.get(t));unsetAll=t=>{const e=this.storages.get(t);e&&e.clear()}}const{ECS:Wt,Renderer:Xt}=z,{UIRoot:Ht,Alignment:qt,Transform:zt}=z.components,{text:Ot,column:Gt,row:jt,container:Vt,scene:$t,stack:Kt}=z.ui,{render:Zt,init:Jt}=z.systems,Qt=new Wt,te=new Xt(window.innerWidth,window.innerHeight);te.canvas.style.width="100%",te.canvas.style.height="100%";const ee=Qt.entity(new zt(q.identity())),ne=$t(Qt).set(new h(ee)),ie=Kt(Qt,[Vt(Qt,{color:new p(71,52,129,255)}),ne]),se=t=>Gt(Qt,Array.from({length:t},((t,e)=>jt(Qt,[Vt(Qt,{width:28,height:28,color:new p(101,215,249,255),onClick:Mt(ne)}),Vt(Qt,{width:5,height:0}),Vt(Qt,{padding:5},Ot(Qt,`in ${e}`))])))),oe=t=>Gt(Qt,{crossAxisAlignment:qt.END},Array.from({length:t},((t,e)=>jt(Qt,[Vt(Qt,{padding:5},Ot(Qt,`out ${e}`)),Vt(Qt,{width:5,height:0}),Vt(Qt,{width:28,height:28,color:new p(101,215,249,255),onClick:Pt(ne)})])))),re=Vt(Qt,{color:new p(0,0,0,50),padding:10,x:25,y:200,onDrag:Lt},Gt(Qt,{crossAxisAlignment:qt.CENTER},[Vt(Qt,{padding:5},Ot(Qt,"Source")),Vt(Qt,{width:0,height:10}),jt(Qt,[se(3),Vt(Qt,{width:30,height:0}),oe(2)])])),ae=Vt(Qt,{color:new p(0,0,0,50),padding:10,x:400,y:100,onDrag:Lt},Gt(Qt,{crossAxisAlignment:qt.CENTER},[Vt(Qt,{padding:5},Ot(Qt,"Transform")),Vt(Qt,{width:0,height:10}),jt(Qt,[se(2),Vt(Qt,{width:30,height:0}),oe(4)])])),ce=Vt(Qt,{color:new p(0,0,0,50),padding:10,x:750,y:250,onDrag:Lt},Gt(Qt,{crossAxisAlignment:qt.CENTER},[Vt(Qt,{padding:5},Ot(Qt,"Sink")),Vt(Qt,{width:0,height:10}),jt(Qt,[se(3),Vt(Qt,{width:30,height:0}),oe(3)])]));ne.update(a,(t=>t.entities.push(re,ae,ce))),Qt.set(te,new Ht(ie)),Jt(ne),requestAnimationFrame((()=>Zt(Qt))),document.body.appendChild(te.canvas);
//# sourceMappingURL=index.5b9bd7ee.js.map

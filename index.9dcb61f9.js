let e;var t;let n;var r;(t=e||(e={}))[t.START=0]="START",t[t.CENTER=1]="CENTER",t[t.END=2]="END",t[t.SPACE_EVENLY=3]="SPACE_EVENLY",t[t.SPACE_BETWEEN=4]="SPACE_BETWEEN",(r=n||(n={}))[r.START=0]="START",r[r.CENTER=1]="CENTER",r[r.END=2]="END";const i=({haystack:e,needle:t})=>{let n=0,r=0;for(;r<t.length;){const i=t[r].toLowerCase();for(;n<e.length&&i!==e[n].toLowerCase();)++n;if(n===e.length)return!1;++r}return!0},s=({width:e,height:t})=>[2/e,0,-1,0,-2/t,1,0,0,1],o=(e,t)=>[1,0,e,0,1,t,0,0,1],a=(e,t)=>[e,0,0,0,t,0,0,0,1],c=(...e)=>{const[t,...n]=e;return n.reduce(((e,t)=>{const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],d=e[7],h=e[8],u=t[0],l=t[1],p=t[2],x=t[3],g=t[4],m=t[5],f=t[6],E=t[7],A=t[8];return[n*u+r*x+i*f,n*l+r*g+i*E,n*p+r*m+i*A,s*u+o*x+a*f,s*l+o*g+a*E,s*p+o*m+a*A,c*u+d*x+h*f,c*l+d*g+h*E,c*p+d*m+h*A]}),t)},d=(e,t)=>{const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],d=e[7],h=e[8],u=t[0],l=t[1],p=t[2];return[n*u+r*l+i*p,s*u+o*l+a*p,c*u+d*l+h*p]},h=e=>{const t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],a=e[6],c=e[7],d=e[8],h=n*o-r*s,u=t*o-r*i,l=t*s-n*i,p=1/(a*h-c*u+d*l);return[p*(s*d-o*c),p*-(n*d-r*c),p*h,p*-(i*d-o*a),p*(t*d-r*a),p*-u,p*(i*c-s*a),p*-(t*c-n*a),p*l]},u=([e,t,n])=>Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2));let l;var p;(p=l||(l={}))[p.POINTER_MOVE=0]="POINTER_MOVE",p[p.POINTER_DOWN=1]="POINTER_DOWN",p[p.POINTER_UP=2]="POINTER_UP",p[p.CLICKED_NODE=3]="CLICKED_NODE",p[p.WHEEL=4]="WHEEL",p[p.CLICKED_INPUT=5]="CLICKED_INPUT",p[p.CLICKED_OUTPUT=6]="CLICKED_OUTPUT",p[p.DOUBLE_CLICK_TIMEOUT=7]="DOUBLE_CLICK_TIMEOUT",p[p.DOUBLE_CLICK=8]="DOUBLE_CLICK",p[p.KEYDOWN=9]="KEYDOWN",p[p.VIRTUAL_KEYDOWN=10]="VIRTUAL_KEYDOWN",p[p.CLICKED_FINDER_OPTION=11]="CLICKED_FINDER_OPTION";const x=(e,t)=>{if(!e.dragging&&!e.zooming)return e.finder.show||(e.nodePlacementLocation={x:t.pointer.x,y:t.pointer.y}),{state:e,rerender:!1};const n=e.pointers.findIndex((e=>e.id===t.pointer.id)),r=e.pointers[n];if(e.pointers[n]=t.pointer,e.dragging){const n=t.pointer.x-r.x,i=t.pointer.y-r.y;if(null!==e.draggedNode){const t=u(d(e.camera,[0,1,0])),r=e.graph.nodes[e.draggedNode];r.x+=n*t,r.y+=i*t}else e.camera=c(e.camera,o(-n,-i));return{state:e,render:!0}}if(e.zooming){const[t,n]=[e.pointers[0],e.pointers[1]],[r,i]=[t.x,t.y],[s,d]=[n.x,n.y],h=Math.sqrt(Math.pow(s-r,2)+Math.pow(d-i,2)),u=e.pointerDistance,l=e.pointerCenter;e.pointerDistance=h;const p=(t.x+n.x)/2,x=(t.y+n.y)/2;if(e.pointerCenter=[p,x],u>0){const t=o(p,x),n=Math.pow(2,.01*(u-h)),r=o(-p,-x),i=p-l[0],s=x-l[1];return e.camera=c(e.camera,t,a(n,n),r,o(-i,-s)),{state:e,render:!0}}return{state:e}}return{state:e}},g=e=>(e.finder.options=Object.keys(e.operations).filter((t=>i({haystack:t,needle:e.finder.search}))),e),m=e=>(e.finder.show=!1,e.finder.search="",e),f=(e,t)=>{const n=(e=m(e)).operations[t],[r,i,s]=d(e.camera,[e.nodePlacementLocation.x,e.nodePlacementLocation.y,1]);return e.graph.nodes.push({name:t,inputs:n.inputs.map((e=>({name:e,selected:!1,edgeIndices:[]}))),outputs:n.outputs.map((e=>({name:e,selected:!1,edgeIndices:[]}))),x:r,y:i}),e};class E{constructor(e,t,n,r){this.top=e,this.right=t,this.bottom=n,this.left=r}}const A=e=>new E(e,e,e,e),y=({x0:e,y0:t,x1:n,y1:r},i)=>e<=i.x&&i.x<=n&&t<=i.y&&i.y<=r,I=(e,t)=>{for(let n=e.clickHandlers.length;n>0;--n)for(const{onClick:r,worldSpace:i}of e.clickHandlers[n-1])if(y(i,t))return r(t),e;return e},T=e=>({vertices:[],colors:[],vertexIndices:[],textureIndex:e,textureCoordinates:[],cameraIndex:[]}),C=e=>{const t=[];let n=T(0);for(const r of e)for(const[e,i]of r){n.textureIndex!==e&&(0!==n.vertices.length&&t.push(n),n=T(e));for(const e of i){const t=n.vertices.length/2;n.vertices.push(...e.vertices),n.colors.push(...e.colors);for(const r of e.vertexIndices)n.vertexIndices.push(r+t);n.textureCoordinates.push(...e.textureCoordinates),n.cameraIndex.push(...e.cameraIndex)}}return 0!==n.vertices.length&&t.push(n),t};class w{constructor(){const e=[1,0,0,0,1,0,0,0,1];this.cameras=[[1,0,0,0,1,0,0,0,1]],this.stack=[0],this.transform=h(e)}pushCamera=e=>{const t=this.cameras.length;this.cameras.push(e),this.stack.push(t),this.transform=h(e)};popCamera=()=>{this.stack.pop(),this.transform=h(this.cameras[this.activeCamera()])};activeCamera=()=>this.stack.slice(-1)[0];transformWorldSpace=e=>{const[t,n,r]=d(this.transform,[e.x0,e.y0,1]),[i,s,o]=d(this.transform,[e.x1,e.y1,1]);return{x0:t,y0:n,x1:i,y1:s}}}const _=(e,t,n,r)=>{const i=r.initial();for(const s of e.traverse(t,n,0))r.combine(i,s);return i},R={initial:()=>({}),combine:(e,t)=>t.ui.id?(e[t.ui.id]=t.geometry.worldSpace,e):e};function*v(e,t,n){const r=(t.x0+t.x1)/2,i=(t.y0+t.y1)/2,s=r+50,o=i,a=(n.x0+n.x1)/2,c=(n.y0+n.y1)/2,d=a-50,h=c;let u=0,l=0,p=!0;for(const t of e){const e=t*t,n=e*t,x=1-t,g=x*x,m=g*x,f=3*g*t,E=3*x*e,A=m*r+f*s+E*d+n*a,y=m*i+f*o+E*h+n*c;p?(yield A,yield y,p=!1):(yield u,yield l),yield A,yield y,u=A,l=y}}const D=(e,t)=>{const n=((e,t,n)=>{const r=(t-e)/(n-1);return Array.from({length:n},((t,n)=>e+r*n))})(0,1,20),r=[],i=[];for(const{from:s,to:o,color:a}of e){for(const e of v(n,t[s],t[o]))r.push(e);const{red:e,green:c,blue:d,alpha:h}=a;for(let t=0;t<40;++t)i.push(e,c,d,h)}return{vertices:r,colors:i}},b=()=>[],N=(e,t)=>{if(0==t.geometry.vertices.length)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push(new Map);const r=e[t.z];return(()=>{const e=r.get(t.geometry.textureIndex);if(e)return e;const n=[];return r.set(t.geometry.textureIndex,n),n})().push(t.geometry),e},S=()=>[],L=(e,t)=>{if(!t.ui.onClick)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({onClick:t.ui.onClick,worldSpace:t.geometry.worldSpace}),e},P=()=>[],O=(e,t)=>t.ui.connections?(e.push(...t.ui.connections),e):e,U={initial:()=>({layers:b(),clickHandlers:S(),idToWorldSpace:R.initial(),connections:P()}),combine:(e,t)=>({layers:N(e.layers,t),clickHandlers:L(e.clickHandlers,t),idToWorldSpace:R.combine(e.idToWorldSpace,t),connections:O(e.connections,t)})},z=(e,t)=>{const{width:n,height:r}=e.size;e.clear();const i={minWidth:0,maxWidth:n,minHeight:0,maxHeight:r},s=t.layout(i,e.measureText),o=new w,a=t.geometry(s,{x:0,y:0},o),{layers:c,clickHandlers:d,connections:h,idToWorldSpace:u}=_(t,s,a,U),l=C(c),p=D(h,u);e.cameras=o.cameras,e.clickHandlers=d;for(const t of l)e.draw(t);return p.vertices.length&&e.drawLines(p),e};class k{constructor(e,t,n,r,i,s,o,a){this.window=e,this.document=t,this.canvas=n,this.gl=r,this.program=i,this.textures=s,this.textMeasurementsCache=o,this.clickHandlers=a,this.clear=()=>{const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)},this.draw=({vertices:e,colors:t,vertexIndices:n,textureCoordinates:r,textureIndex:i,cameraIndex:s})=>{const{gl:o,program:a,textures:c}=this,{attributes:d}=a,h=c[i];o.bindTexture(o.TEXTURE_2D,h),o.bindBuffer(o.ARRAY_BUFFER,d.vertices.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(e),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,d.colors.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,d.textureCoordinates.buffer),o.bufferData(o.ARRAY_BUFFER,new Float32Array(r),o.STATIC_DRAW),o.bindBuffer(o.ARRAY_BUFFER,d.cameraIndex.buffer),o.bufferData(o.ARRAY_BUFFER,new Uint8Array(s),o.STATIC_DRAW),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,d.vertexIndices),o.bufferData(o.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),o.STATIC_DRAW),o.drawElements(o.TRIANGLES,n.length,o.UNSIGNED_SHORT,0)},this.drawLines=({vertices:e,colors:t})=>{const{gl:n,program:r,textures:i}=this,{attributes:s}=r,o=i[0],a=e.length/2;n.bindTexture(n.TEXTURE_2D,o),n.bindBuffer(n.ARRAY_BUFFER,s.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,s.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,s.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(Array(2*a).fill(0)),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,s.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(Array(a).fill(0)),n.STATIC_DRAW),n.drawArrays(n.LINES,0,a)},this.getTextureMeasurements=(e,t)=>{const{document:n,gl:r}=this,i=`${t} ${e.size} ${e.family}`,s=this.textMeasurementsCache.get(i);if(s)return s;const{texture:o,widths:a,textureCoordinates:c}=((e,t,n,r)=>{const i=e.createElement("canvas"),s=i.getContext("2d"),o=Math.sqrt(256),a=(e=>{let t=1;for(;t<e;)t<<=1;return t})(n.size*o),c=a/o;i.width=a*r,i.height=a*r,i.style.width=`${a}px`,i.style.height=`${a}px`,s.scale(r,r),s.textAlign="left",s.textBaseline="top",s.font=`${n.size}px ${n.family}`,s.fillStyle="white",s.clearRect(0,0,s.canvas.width,s.canvas.height);const d=n.size,h=[],u=[];for(let e=0;e<256;++e){const t=String.fromCharCode(e),n=s.measureText(t),r=Math.ceil(n.width),i=e%o*c,l=Math.floor(e/o)*c;s.fillText(t,i,l),h.push(r);const p=i/a,x=(i+r)/a,g=l/a,m=(l+d)/a;u.push([p,g,p,m,x,g,x,m])}const l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{widths:h,textureCoordinates:u,texture:l}})(n,r,e,t),d=this.textures.length;this.textures.push(o);const h={widths:a,textureIndex:d,textureCoordinates:c};return this.textMeasurementsCache.set(i,h),h},this.measureText=(e,t)=>{const{window:n}=this,r=n.devicePixelRatio,{widths:i,textureIndex:s,textureCoordinates:o}=this.getTextureMeasurements(e,r),a=((e,t)=>{let n=[];for(let r=0;r<e.length;++r)n.push(t(e[r],r));return n})(t,(e=>e.charCodeAt(0)));return{widths:a.map((e=>i[e])),textureIndex:s,textureCoordinates:a.map((e=>o[e]))}}}set size(e){const{gl:t,program:n,window:r}=this,{uniforms:i}=n,{canvas:o}=t;t.uniformMatrix3fv(i.projection,!0,s(e)),o.width=e.width*r.devicePixelRatio,o.height=e.height*r.devicePixelRatio,o.style.width=`${e.width}px`,o.style.height=`${e.height}px`,t.viewport(0,0,o.width,o.height),this._size=e}get size(){return this._size}set cameras(e){const{gl:t,program:n}=this,{uniforms:r}=n,i=[];for(const t of e)i.push(...t);t.uniformMatrix3fv(r.cameras,!0,i),this._cameras=e}get cameras(){return this._cameras}}const B=({width:e,height:t,document:n,window:r})=>{const i=n.createElement("canvas");i.style.touchAction="none";const s=i.getContext("webgl2");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.clearColor(0,0,0,1);const o=(e=>{const t={vertices:{location:0,buffer:e.createBuffer()},colors:{location:1,buffer:e.createBuffer()},textureCoordinates:{location:2,buffer:e.createBuffer()},cameraIndex:{location:3,buffer:e.createBuffer()},vertexIndices:e.createBuffer()},n=((e,t)=>{const{vertices:n,colors:r,textureCoordinates:i,cameraIndex:s}=t,o=`#version 300 es\n  uniform mat3 u_projection;\n  uniform mat3 u_cameras[8];\n\n  layout(location = ${n.location}) in vec2 a_vertex;\n  layout(location = ${r.location}) in vec4 a_color;\n  layout(location = ${i.location}) in vec2 a_textureCoordinates;\n  layout(location = ${s.location}) in uint a_cameraIndex;\n\n  out vec4 v_color;\n  out vec2 v_textureCoordinates;\n\n  void main() {\n    mat3 camera = u_cameras[a_cameraIndex];\n    mat3 transform = u_projection * inverse(camera);\n    gl_Position = vec4((transform * vec3(a_vertex, 1)).xy, 0, 1);\n    v_color = a_color / 255.0;\n    v_textureCoordinates = a_textureCoordinates;\n  }\n  `,a=e.createShader(e.VERTEX_SHADER);return e.shaderSource(a,o),e.compileShader(a),a})(e,t),r=(e=>{const t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec4 v_color;\n  in vec2 v_textureCoordinates;\n\n  out vec4 fragColor;\n  \n  void main() {\n    fragColor = texture(u_texture, v_textureCoordinates) * v_color;\n  }\n  "),e.compileShader(t),t})(e),i=e.createProgram();e.attachShader(i,n),e.attachShader(i,r),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)||(console.log(e.getShaderInfoLog(n)),console.log(e.getShaderInfoLog(r))),e.useProgram(i);const s=e.createVertexArray();return e.bindVertexArray(s),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_vertex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.vertices),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_color"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0)})(e,i,t.colors),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_textureCoordinates"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.textureCoordinates),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_cameraIndex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribIPointer(n,1,e.UNSIGNED_BYTE,0,0)})(e,i,t.cameraIndex),{vertexShader:n,fragmentShader:r,program:i,attributes:t,uniforms:{projection:e.getUniformLocation(i,"u_projection"),texture:e.getUniformLocation(i,"u_texture"),cameras:e.getUniformLocation(i,"u_cameras")}}})(s),a=s.createTexture();s.bindTexture(s.TEXTURE_2D,a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const c=new k(r,n,i,s,o,[a],new Map,[]);return c.size={width:e,height:t},c},F=e=>({x:e.clientX,y:e.clientY,id:e.pointerId});class W{constructor(e,t,n){this.size=e,this.totalChildHeight=t,this.children=n}}class M{constructor(e,t,n,r,i,s,o,a){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=a}}class Y{constructor(e,t,n){this.mainAxisAlignment=e,this.crossAxisAlignment=t,this.children=n}layout(t,n){const r={children:[],width:0,totalChildHeight:0},i=this.children.reduce(((e,r)=>{const i=r.layout(t,n);return e.children.push(i),e.totalChildHeight+=i.size.height,e.width=Math.max(e.width,i.size.width),e}),r),{children:s,width:o,totalChildHeight:a}=i;return((e,t,n)=>new W(e,t,n))({width:o,height:this.mainAxisAlignment==e.START?a:t.maxHeight},a,s)}geometry(t,r,i){const s=t,o=t.size.height-s.totalChildHeight,a={children:[],y:(()=>{switch(this.mainAxisAlignment){case e.START:return r.y;case e.CENTER:return r.y+o/2;case e.END:return r.y+o;case e.SPACE_EVENLY:return r.y+o/(this.children.length+1);case e.SPACE_BETWEEN:return r.y}})()},c=e=>e.size.height,d=e=>e.size.height,h=e=>e.size.height,u=e=>e.size.height+o/(this.children.length+1),l=e=>e.size.height+o/(this.children.length-1),p=(()=>{switch(this.mainAxisAlignment){case e.START:return c;case e.CENTER:return d;case e.END:return h;case e.SPACE_EVENLY:return u;case e.SPACE_BETWEEN:return l}})(),x=e=>r.x,g=e=>r.x+t.size.width/2-e.size.width/2,m=e=>r.x+t.size.width-e.size.width,f=(()=>{switch(this.crossAxisAlignment){case n.START:return x;case n.CENTER:return g;case n.END:return m}})(),E=this.children.reduce(((e,t,n)=>{const r=s.children[n],o={x:f(r),y:e.y},a=t.geometry(r,o,i);return e.children.push(a),e.y+=p(r),e}),a);return((e,t)=>new M(e,0,[],[],[],[],[],t))(i.transformWorldSpace({x0:r.x,y0:r.y,x1:r.x+t.size.width,y1:r.y+t.size.height}),E.children)}*traverse(e,t,n){const r=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:n};const s=n+1;let o=0;for(const e of this.children)yield*e.traverse(r[o],i[o],s),o+=1}}const K=(...t)=>{const[r,i]=t[0]instanceof Array?[{},t[0]]:[t[0],t[1]];return new Y(r.mainAxisAlignment??e.START,r.crossAxisAlignment??n.START,i)};class H{constructor(e,t){this.size=e,this.child=t}}const V=(e,t)=>new H(e,t);class ${constructor(e,t,n,r,i,s,o,a){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.child=a}}const X=(e,t)=>{const n=e.vertices??[];return new $(e.worldSpace,e.textureIndex??0,e.textureCoordinates??Array.from({length:n.length}).fill(0),e.colors??[],n,e.vertexIndices??[],e.cameraIndex??[],t)};class G{constructor(e,t,n,r,i,s,o,a,c){this.padding=e,this.width=t,this.height=n,this.x=r,this.y=i,this.color=s,this.onClick=o,this.id=a,this.child=c}layout(e,t){const{left:n,top:r,right:i,bottom:s}=this.padding;if(this.child){const o=this.child.layout(e,t),a=this.width??o.size.width+n+i,c=this.height??o.size.height+r+s;return V({width:a,height:c},o)}const o=(()=>this.width?this.width+n+i:e.maxWidth)(),a=(()=>this.height?this.height+r+s:e.maxHeight)();return V({width:o,height:a})}geometry(e,t,n){const r=t.x+(this.x??0),i=r+e.size.width,s=t.y+(this.y??0),o=s+e.size.height,a=n.transformWorldSpace({x0:r,x1:i,y0:s,y1:o}),c=(()=>{if(this.color){const{red:e,green:t,blue:c,alpha:d}=this.color;return{worldSpace:a,vertices:[r,s,r,o,i,s,i,o],colors:[e,t,c,d,e,t,c,d,e,t,c,d,e,t,c,d],vertexIndices:[0,1,2,1,2,3],cameraIndex:Array(4).fill(n.activeCamera())}}return{worldSpace:a,vertices:[],colors:[],vertexIndices:[],cameraIndex:[]}})();if(this.child){const t=e.child,i={x:r+this.padding.left,y:s+this.padding.top},o=this.child.geometry(t,i,n);return X(c,o)}return X(c)}*traverse(e,t,n){if(yield{ui:this,layout:e,geometry:t,z:n},this.child){const r=e.child,i=t.child;yield*this.child.traverse(r,i,n+1)}}}const q=({padding:e,width:t,height:n,color:r,x:i,y:s,onClick:o,id:a},c)=>new G(e??A(0),t,n,i,s,r,o,a,c);class j{constructor(e,t,n){this.size=e,this.totalChildWidth=t,this.children=n}}class J{constructor(e,t,n,r,i,s,o,a){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=a}}class Q{constructor(e,t,n){this.mainAxisAlignment=e,this.crossAxisAlignment=t,this.children=n}layout(t,n){const r={children:[],totalChildWidth:0,height:0},i=this.children.reduce(((e,r)=>{const i=r.layout(t,n);return e.children.push(i),e.totalChildWidth+=i.size.width,e.height=Math.max(e.height,i.size.height),e}),r),{children:s,totalChildWidth:o,height:a}=i;return((e,t,n)=>new j(e,t,n))({width:this.mainAxisAlignment==e.START?o:t.maxWidth,height:a},o,s)}geometry(t,r,i){const s=t,o=t.size.width-s.totalChildWidth,a={children:[],x:(()=>{switch(this.mainAxisAlignment){case e.START:return r.x;case e.CENTER:return r.x+o/2;case e.END:return r.x+o;case e.SPACE_EVENLY:return r.x+o/(this.children.length+1);case e.SPACE_BETWEEN:return r.x}})()},c=e=>e.size.width,d=e=>e.size.width,h=e=>e.size.width,u=e=>e.size.width+o/(this.children.length+1),l=e=>e.size.width+o/(this.children.length-1),p=(()=>{switch(this.mainAxisAlignment){case e.START:return c;case e.CENTER:return d;case e.END:return h;case e.SPACE_EVENLY:return u;case e.SPACE_BETWEEN:return l}})(),x=e=>r.y,g=e=>r.y+t.size.height/2-e.size.height/2,m=e=>r.y+t.size.height-e.size.height,f=(()=>{switch(this.crossAxisAlignment){case n.START:return x;case n.CENTER:return g;case n.END:return m}})(),E=this.children.reduce(((e,t,n)=>{const r=s.children[n],o={x:e.x,y:f(r)},a=t.geometry(r,o,i);return e.children.push(a),e.x+=p(r),e}),a);return((e,t)=>new J(e,0,[],[],[],[],[],t))(i.transformWorldSpace({x0:r.x,y0:r.y,x1:r.x+t.size.width,y1:r.y+t.size.height}),E.children)}*traverse(e,t,n){const r=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:n};const s=n+1;let o=0;for(const e of this.children)yield*e.traverse(r[o],i[o],s),o+=1}}const Z=(...t)=>{const[r,i]=t[0]instanceof Array?[{},t[0]]:[t[0],t[1]];return new Q(r.mainAxisAlignment??e.START,r.crossAxisAlignment??n.START,i)};class ee{constructor(e,t){this.size=e,this.children=t}}class te{constructor(e,t,n,r,i,s,o,a){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=a}}class ne{constructor(e,t,n){this.camera=e,this.children=t,this.connections=n}layout(e,t){const n=this.children.map((n=>n.layout(e,t)));return((e,t)=>new ee(e,t))({width:e.maxWidth,height:e.maxHeight},n)}geometry(e,t,n){const r=n.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),i=e.children;n.pushCamera(this.camera);const s=this.children.map(((e,r)=>e.geometry(i[r],t,n)));return n.popCamera(),((e,t)=>new te(e,0,[],[],[],[],[],t))(r,s)}*traverse(e,t,n){const r=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:n};let s=0;for(const e of this.children){for(const t of e.traverse(r[s],i[s],n))yield t,n=Math.max(n,t.z);s++,n++}}}class re{constructor(e,t){this.size=e,this.children=t}}class ie{constructor(e,t,n,r,i,s,o,a){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o,this.children=a}}class se{constructor(e){this.children=e}layout(e,t){const n=this.children.map((n=>n.layout(e,t)));return((e,t)=>new re(e,t))({width:e.maxWidth,height:e.maxHeight},n)}geometry(e,t,n){const r=e,i=this.children.map(((e,i)=>e.geometry(r.children[i],t,n)));return((e,t)=>new ie(e,0,[],[],[],[],[],t))(n.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),i)}*traverse(e,t,n){const r=e.children,i=t.children;yield{ui:this,layout:e,geometry:t,z:n};let s=0;for(const e of this.children){for(const t of e.traverse(r[s],i[s],n))yield t,n=Math.max(n,t.z);s+=1,n+=1}}}const oe=e=>new se(e);class ae{constructor(e,t){this.measurements=e,this.size=t}}class ce{constructor(e,t,n,r,i,s,o){this.worldSpace=e,this.textureIndex=t,this.textureCoordinates=n,this.colors=r,this.vertices=i,this.vertexIndices=s,this.cameraIndex=o}}const de=(e,t,n)=>{const r=[];let i=n.x;const s=n.y,o=n.y+t;for(const t of e){const e=i,n=i+t;r.push(e,s,e,o,n,s,n,o),i+=t}return r},he=(e,{red:t,green:n,blue:r,alpha:i})=>{const s=[];for(let o=0;o<e;++o)s.push(t,n,r,i,t,n,r,i,t,n,r,i,t,n,r,i);return s},ue=e=>{const t=[];let n=0;for(let r=0;r<e;++r)t.push(n,n+1,n+2,n+1,n+2,n+3),n+=4;return t};class le{constructor(e,t,n){this.font=e,this.color=t,this.str=n}layout(e,t){const{font:n,str:r}=this,i=t(n,r),s=i.widths.reduce(((e,t)=>e+t));return((e,t)=>new ae(e,t))(i,{width:s,height:n.size})}geometry(e,t,n){const r=e,{measurements:i}=r,{textureIndex:s,textureCoordinates:o,widths:a}=i;return c={worldSpace:n.transformWorldSpace({x0:t.x,y0:t.y,x1:t.x+e.size.width,y1:t.y+e.size.height}),textureIndex:s,textureCoordinates:o.flat(),colors:he(a.length,this.color),vertices:de(a,this.font.size,t),vertexIndices:ue(a.length),cameraIndex:Array(4*a.length).fill(n.activeCamera())},new ce(c.worldSpace,c.textureIndex,c.textureCoordinates,c.colors,c.vertices,c.vertexIndices,c.cameraIndex);var c}*traverse(e,t,n){yield{ui:this,layout:e,geometry:t,z:n}}}const pe=(...e)=>{const[t,n]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]],r={family:t.font??"monospace",size:t.size??14};return new le(r,t.color??{red:255,green:255,blue:255,alpha:255},n)},xe=e=>q({width:e,height:e}),ge=(e,t)=>{const n=[e[0]];for(const r of e.slice(1))n.push(t,r);return n},me=(e,t,r)=>K(ge(t.map(((t,i)=>((e,{name:t,selected:r},i,s)=>q({onClick:()=>Ie({kind:l.CLICKED_INPUT,inputPath:{nodeIndex:i,inputIndex:s}})},Z({crossAxisAlignment:n.CENTER},[q({id:`input ${i} ${s}`,width:14,height:14,color:r?e.selectedInput:e.input}),xe(4),pe(t)])))(e,t,r,i))),xe(4))),fe=(e,t,r)=>K(ge(t.map(((t,i)=>((e,{name:t,selected:r},i,s)=>q({onClick:()=>Ie({kind:l.CLICKED_OUTPUT,outputPath:{nodeIndex:i,outputIndex:s}})},Z({crossAxisAlignment:n.CENTER},[pe(t),xe(4),q({id:`output ${i} ${s}`,width:14,height:14,color:r?e.selectedInput:e.input})])))(e,t,r,i))),xe(4))),Ee=(e,t,{name:r,x:i,y:s,inputs:o,outputs:a},c)=>{const d=[];return o.length&&d.push(me(t,o,c)),o.length&&a.length&&d.push(xe(15)),a.length&&d.push(fe(t,a,c)),q({color:t.node,padding:A(4),x:i,y:s,onClick:()=>e({kind:l.CLICKED_NODE,index:c})},K({crossAxisAlignment:n.CENTER},[pe(r),xe(4),Z(d)]))},Ae=({search:e,options:t},r)=>K({crossAxisAlignment:n.CENTER},[q({height:10}),q({color:r.node,padding:A(4)},K([q({color:r.background,width:300,padding:A(4)},pe({color:r.input,size:24},e.length?e:"Search ...")),q({width:10,height:10}),...t.map(((e,t)=>q({padding:A(4),onClick:()=>Ie({kind:l.CLICKED_FINDER_OPTION,option:e})},pe({size:18,color:0==t?r.input:{red:255,green:255,blue:255,alpha:255}},e))))]))]),ye=(e,t)=>Z(t.map((t=>{return n=e,r=t,q({padding:A(10),onClick:()=>n({kind:l.VIRTUAL_KEYDOWN,key:r})},pe({size:24},r));var n,r}))),Ie=((e,t,n)=>{let r=B({width:window.innerWidth,height:window.innerHeight,window:window,document:document}),i=!1;const s=()=>{i||(i=!0,requestAnimationFrame((()=>{r=z(r,t(o,e)),i=!1})))},o=t=>{const{state:r,render:i,schedule:a,dispatch:c}=n(e,t);e=r,i&&s();for(const{after:e,event:t}of a??[]){const{milliseconds:n}=e;setTimeout((()=>o(t)),n)}for(const e of c??[])o(e)};return document.body.appendChild(r.canvas),document.addEventListener("pointerdown",(e=>{r=I(r,F(e))})),window.addEventListener("resize",(()=>{r.size={width:window.innerWidth,height:window.innerHeight},s()})),s(),o})({graph:{nodes:[{name:"Source",inputs:[],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:7,y:15},{name:"Transform",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[{name:"Out 1",selected:!1,edgeIndices:[]},{name:"Out 2",selected:!1,edgeIndices:[]}],x:window.innerWidth/2-70,y:50},{name:"Sink",inputs:[{name:"In 1",selected:!1,edgeIndices:[]},{name:"In 2",selected:!1,edgeIndices:[]}],outputs:[],x:window.innerWidth-70,y:15}],edges:[]},zooming:!1,dragging:!1,draggedNode:null,pointers:[],pointerDistance:0,pointerCenter:[0,0],camera:[1,0,0,0,1,0,0,0,1],selectedOutput:null,selectedInput:null,theme:{background:{red:2,green:22,blue:39,alpha:255},node:{red:41,green:95,blue:120,alpha:255},input:{red:188,green:240,blue:192,alpha:255},selectedInput:{red:175,green:122,blue:208,alpha:255},connection:{red:255,green:255,blue:255,alpha:255}},potentialDoubleClick:!1,nodePlacementLocation:{x:0,y:0},finder:{search:"",options:[],show:!1},operations:{Add:{name:"Add",inputs:["x","y"],outputs:["out"]},Subtract:{name:"Subtract",inputs:["x","y"],outputs:["out"]},Multiply:{name:"Multiply",inputs:["x","y"],outputs:["out"]},Divide:{name:"Divide",inputs:["x","y"],outputs:["out"]},Equal:{name:"Equal",inputs:["x","y"],outputs:["out"]},"Less Than":{name:"Less Than",inputs:["x","y"],outputs:["out"]},"Less Than Or Equal":{name:"Less Than Or Equal",inputs:["x","y"],outputs:["out"]}}},((t,r)=>{if(!r.finder.show){const e=[];if(r.graph.nodes.forEach(((n,i)=>{i!==r.draggedNode&&e.push(Ee(t,r.theme,n,i))})),null!==r.draggedNode){const n=r.draggedNode;e.push(Ee(t,r.theme,r.graph.nodes[n],n))}const n=r.graph.edges.map((({input:e,output:t})=>({from:`output ${t.nodeIndex} ${t.outputIndex}`,to:`input ${e.nodeIndex} ${e.inputIndex}`,color:r.theme.connection})));return oe([q({color:r.theme.background}),(i={camera:r.camera,children:e,connections:n},new ne(i.camera,i.children,i.connections??[]))])}var i,s,o;return oe([q({color:r.theme.background}),Ae(r.finder,r.theme),(s=t,o=r.theme,K({mainAxisAlignment:e.END},[Z({mainAxisAlignment:e.SPACE_BETWEEN},[q({padding:A(4),color:o.node},K([ye(s,["1","2","3","4","5"]),ye(s,["q","w","e","r","t"]),ye(s,["a","s","d","f","g"]),ye(s,["z","x","c","v"]),ye(s,["sft","space"])])),q({padding:A(4),color:o.node},K({crossAxisAlignment:n.END},[ye(s,["6","7","8","9","0"]),ye(s,["y","u","i","o","p"]),ye(s,["h","j","k","l"]),ye(s,["b","n","m","del"]),ye(s,["space","ret"])]))])]))])}),((e,t)=>{switch(t.kind){case l.POINTER_DOWN:return((e,t)=>e.finder.show?{state:e}:(e.pointers.push(t.pointer),e.pointers.length>1?(e.potentialDoubleClick=!1,e.dragging=!1,e.zooming=2===e.pointers.length,{state:e}):e.potentialDoubleClick?(e.potentialDoubleClick=!1,{state:e,dispatch:[{kind:l.DOUBLE_CLICK,pointer:t.pointer}]}):(e.dragging=!0,e.potentialDoubleClick=!0,{state:e,schedule:[{after:{milliseconds:300},event:{kind:l.DOUBLE_CLICK_TIMEOUT}}]})))(e,t);case l.POINTER_UP:return((e,t)=>{const n=e.pointers.findIndex((e=>e.id===t.pointer.id));return e.pointers.splice(n,1),1===e.pointers.length?(e.zooming=!1,e.dragging=!0,e.pointerDistance=0):0===e.pointers.length&&(e.dragging=!1,e.draggedNode=null,e.pointerDistance=0),{state:e}})(e,t);case l.POINTER_MOVE:return x(e,t);case l.CLICKED_NODE:return((e,t)=>(e.draggedNode=t.index,{state:e,render:!0}))(e,t);case l.WHEEL:return((e,t)=>{const n=o(t.x,t.y),r=Math.pow(2,.01*t.deltaY),i=o(-t.x,-t.y);return e.camera=c(e.camera,n,a(r,r),i),{state:e,render:!0}})(e,t);case l.CLICKED_INPUT:return((e,t)=>{if(e.draggedNode=t.inputPath.nodeIndex,e.selectedOutput){const n=e.graph.edges.length;e.graph.edges.push({input:t.inputPath,output:e.selectedOutput});{const{nodeIndex:t,outputIndex:r}=e.selectedOutput,i=e.graph.nodes[t].outputs[r];i.edgeIndices.push(n),i.selected=!1}{const{nodeIndex:r,inputIndex:i}=t.inputPath;e.graph.nodes[r].inputs[i].edgeIndices.push(n)}return e.selectedOutput=null,e.draggedNode=null,{state:e,render:!0}}if(e.selectedInput){const{nodeIndex:t,inputIndex:n}=e.selectedInput;e.graph.nodes[t].inputs[n].selected=!1}const{nodeIndex:n,inputIndex:r}=t.inputPath;return e.graph.nodes[n].inputs[r].selected=!0,e.selectedInput=t.inputPath,{state:e,render:!0}})(e,t);case l.CLICKED_OUTPUT:return((e,t)=>{if(e.draggedNode=t.outputPath.nodeIndex,e.selectedInput){const n=e.graph.edges.length;e.graph.edges.push({input:e.selectedInput,output:t.outputPath});{const{nodeIndex:t,inputIndex:r}=e.selectedInput,i=e.graph.nodes[t].inputs[r];i.edgeIndices.push(n),i.selected=!1}{const{nodeIndex:r,outputIndex:i}=t.outputPath;e.graph.nodes[r].outputs[i].edgeIndices.push(n)}return e.selectedInput=null,e.draggedNode=null,{state:e,render:!0}}if(e.selectedOutput){const{nodeIndex:t,outputIndex:n}=e.selectedOutput;e.graph.nodes[t].outputs[n].selected=!1}const{nodeIndex:n,outputIndex:r}=t.outputPath;return e.graph.nodes[n].outputs[r].selected=!0,e.selectedOutput=t.outputPath,{state:e,render:!0}})(e,t);case l.DOUBLE_CLICK_TIMEOUT:return((e,t)=>(e.potentialDoubleClick&&(e.potentialDoubleClick=!1),{state:e}))(e);case l.DOUBLE_CLICK:return((e,{pointer:t})=>(e.potentialDoubleClick=!1,e.finder.show=!0,e.nodePlacementLocation={x:t.x,y:t.y},{state:g(e),render:!0}))(e,t);case l.KEYDOWN:return((e,{key:t})=>{if(e.finder.show){switch(t){case"Backspace":e.finder.search=e.finder.search.slice(0,-1);break;case"Shift":case"Alt":case"Control":case"Meta":case"Tab":break;case"Enter":if(e.finder.options.length>0){const t=e.finder.options[0];e=f(e,t)}else e=m(e);break;case"Escape":e=m(e);break;default:e.finder.search+=t}return{state:g(e),render:!0}}return"f"==t?(e.finder.show=!0,{state:g(e),render:!0}):{state:e}})(e,t);case l.VIRTUAL_KEYDOWN:return((e,{key:t})=>{if(e.finder.show){switch(t){case"del":e.finder.search=e.finder.search.slice(0,-1);break;case"sft":break;case"space":e.finder.search+=" ";break;case"ret":if(e.finder.options.length>0){const t=e.finder.options[0];e=f(e,t)}else e=m(e);break;default:e.finder.search+=t}return{state:g(e),render:!0}}return{state:e}})(e,t);case l.CLICKED_FINDER_OPTION:return((e,{option:t})=>({state:f(e,t),render:!0}))(e,t)}}));"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>{e.getCoalescedEvents().forEach((e=>{Ie({kind:l.POINTER_MOVE,pointer:F(e)})}))})):document.addEventListener("pointermove",(e=>Ie({kind:l.POINTER_MOVE,pointer:F(e)}))),document.addEventListener("pointerdown",(e=>{Ie({kind:l.POINTER_DOWN,pointer:F(e)})})),document.addEventListener("pointerup",(e=>{Ie({kind:l.POINTER_UP,pointer:F(e)})})),document.addEventListener("wheel",(e=>{e.preventDefault(),Ie({kind:l.WHEEL,x:e.clientX,y:e.clientY,deltaY:e.deltaY})}),{passive:!1}),document.addEventListener("contextmenu",(e=>{e.preventDefault()})),document.addEventListener("touchend",(()=>{document.body.requestFullscreen()})),document.addEventListener("keydown",(e=>{e.preventDefault(),Ie({kind:l.KEYDOWN,key:e.key})}));
//# sourceMappingURL=index.9dcb61f9.js.map

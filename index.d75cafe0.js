function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},n={},r={},o=t.parcelRequire045c;null==o&&((o=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var o={id:e,exports:{}};return n[e]=o,t.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){r[e]=t},t.parcelRequire045c=o),o.register("27Lyk",(function(t,n){var r,o;e(t.exports,"register",(()=>r),(e=>r=e)),e(t.exports,"resolve",(()=>o),(e=>o=e));var i={};r=function(e){for(var t=Object.keys(e),n=0;n<t.length;n++)i[t[n]]=e[t[n]]},o=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),o("27Lyk").register(JSON.parse('{"1LzKV":"index.d75cafe0.js","g0Phv":"service_worker.js"}'));const i=({haystack:e,needle:t})=>{let n=0,r=0;for(;r<t.length;){const o=t[r].toLowerCase();for(;n<e.length&&o!==e[n].toLowerCase();)++n;if(n===e.length)return!1;++r}return!0},s=({width:e,height:t})=>[2/e,0,-1,0,-2/t,1,0,0,1],a=(e,t)=>[1,0,e,0,1,t,0,0,1],c=(e,t)=>[e,0,0,0,t,0,0,0,1],d=(...e)=>{const[t,...n]=e;return n.reduce(((e,t)=>{const n=e[0],r=e[1],o=e[2],i=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2],m=t[3],f=t[4],E=t[5],g=t[6],N=t[7],A=t[8];return[n*l+r*m+o*g,n*h+r*f+o*N,n*p+r*E+o*A,i*l+s*m+a*g,i*h+s*f+a*N,i*p+s*E+a*A,c*l+d*m+u*g,c*h+d*f+u*N,c*p+d*E+u*A]}),t)},u=(e,t)=>{const n=e[0],r=e[1],o=e[2],i=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2];return[n*l+r*h+o*p,i*l+s*h+a*p,c*l+d*h+u*p]},l=e=>{const t=e[0],n=e[1],r=e[2],o=e[3],i=e[4],s=e[5],a=e[6],c=e[7],d=e[8],u=n*s-r*i,l=t*s-r*o,h=t*i-n*o,p=1/(a*u-c*l+d*h);return[p*(i*d-s*c),p*-(n*d-r*c),p*u,p*-(o*d-s*a),p*(t*d-r*a),p*-l,p*(o*c-i*a),p*-(t*c-n*a),p*h]},h=([e,t,n])=>Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2));let p;var m;let f;var E;(m=p||(p={}))[m.NODE=0]="NODE",m[m.INPUT=1]="INPUT",m[m.OUTPUT=2]="OUTPUT",m[m.BODY=3]="BODY",m[m.FINDER=4]="FINDER",m[m.NONE=5]="NONE",(E=f||(f={}))[E.PAN=0]="PAN",E[E.ZOOM=1]="ZOOM",E[E.NONE=2]="NONE";const g=({graph:e,operation:t,position:n,generateUUID:r})=>{const o=r(),i={...e.inputs},s=[];for(const e of t.inputs){const t=r();i[t]={uuid:t,node:o,name:e},s.push(t)}const a={...e.outputs},c=[];for(const e of t.outputs){const t=r();a[t]={uuid:t,node:o,name:e,edges:[]},c.push(t)}const d={uuid:o,name:t.name,inputs:s,outputs:c,position:n};if(void 0!==t.body){const n={uuid:r(),node:o,value:t.body};return{graph:{...e,nodes:{...e.nodes,[d.uuid]:{...d,body:n.uuid}},inputs:i,outputs:a,bodys:{...e.bodys,[n.uuid]:n}},node:o}}return{graph:{...e,nodes:{...e.nodes,[d.uuid]:d},inputs:i,outputs:a},node:o}},N=(e,t)=>{const n={...e.nodes},r=n[t];delete n[t];const o=[];for(const t of r.inputs){const n=e.inputs[t].edge;n&&o.push(n)}for(const t of r.outputs)for(const n of e.outputs[t].edges)o.push(n);const i={...e.edges},s={...e.inputs},a={...e.outputs};for(const e of o){const t=i[e],n=s[t.input];s[t.input]={...n,edge:void 0};const r=a[t.output];a[t.output]={...r,edges:r.edges.filter((t=>t!==e))},delete i[e]}for(const e of r.inputs)delete s[e];for(const e of r.outputs)delete a[e];return{...e,nodes:n,edges:i,inputs:s,outputs:a}},A=(e,t)=>{const n=e.inputs[t].edge;if(n){const t=e.edges[n],r=e.outputs[t.output],o={...e.outputs,[t.output]:{...r,edges:r.edges.filter((e=>e!==t.uuid))}},i=e.inputs[t.input],s={...e.inputs,[t.input]:{...i,edge:void 0}},a={...e.edges};return delete a[n],{...e,outputs:o,inputs:s,edges:a}}return e},x=(e,t)=>{const n={...e.edges},r={...e.inputs},o={...e.outputs};for(const i of e.outputs[t].edges){const t=e.edges[i],s=r[t.input];r[t.input]={...s,edge:void 0};const a=o[t.output];o[t.output]={...a,edges:a.edges.filter((e=>e!==i))},delete n[i]}return{...e,outputs:o,inputs:r,edges:n}},C=({graph:e,input:t,output:n,generateUUID:r})=>{const o={uuid:r(),input:t,output:n},i={...e.inputs,[t]:{...e.inputs[t],edge:o.uuid}},s=e.outputs[n],a={...e.outputs,[n]:{...s,edges:[...s.edges,o.uuid]}};return{graph:{...e,inputs:i,outputs:a,edges:{...e.edges,[o.uuid]:o}},edge:o.uuid}},T=(e,t,n)=>{const r=e.nodes[t];return{...e,nodes:{...e.nodes,[t]:{...r,position:n(r.position)}}}},w=(e,t,n)=>{const r=e.bodys[t];return{...e,bodys:{...e.bodys,[t]:{...r,value:n(r.value)}}}};let y;var k;(k=y||(y={}))[k.NONE=0]="NONE",k[k.INPUT=1]="INPUT",k[k.OUTPUT=2]="OUTPUT",k[k.NODE=3]="NODE",k[k.BODY=4]="BODY";const O=e=>({...e,focus:{kind:p.NONE,pointerAction:{kind:f.NONE},quickSelect:{kind:y.NONE}}}),D=(e,t,n)=>{if(e.focus.kind===p.OUTPUT){const r=e.graph.inputs[t],o=e.graph.outputs[e.focus.output];if(r.node===o.node)return{model:e};{const o=void 0!==r.edge?A(e.graph,r.uuid):e.graph,{graph:i}=C({graph:o,input:t,output:e.focus.output,generateUUID:n});return{model:O({...e,graph:i}),render:!0}}}return{model:{...e,focus:{kind:p.INPUT,input:t,quickSelect:{kind:y.NONE}}},render:!0}},R=(e,t,n)=>{if(e.focus.kind===p.INPUT){const r=e.graph.inputs[e.focus.input];if(e.graph.outputs[t].node===r.node)return{model:e};{const o=void 0!==r.edge?A(e.graph,r.uuid):e.graph,{graph:i}=C({graph:o,input:e.focus.input,output:t,generateUUID:n});return{model:O({...e,graph:i}),render:!0}}}return{model:{...e,focus:{kind:p.OUTPUT,output:t,quickSelect:{kind:y.NONE}}},render:!0}},_=(e,t,n)=>{switch(n){case"i":{const n={};return Object.keys(e.graph.inputs).forEach(((e,t)=>{n[e]=String.fromCharCode(97+t)})),{model:{...e,focus:{...t,quickSelect:{kind:y.INPUT,hotkeys:n}}},render:!0}}case"o":{const n={};return Object.keys(e.graph.outputs).forEach(((e,t)=>{n[e]=String.fromCharCode(97+t)})),{model:{...e,focus:{...t,quickSelect:{kind:y.OUTPUT,hotkeys:n}}},render:!0}}case"n":{const n={};return Object.keys(e.graph.nodes).forEach(((e,t)=>{n[e]=String.fromCharCode(97+t)})),{model:{...e,focus:{...t,quickSelect:{kind:y.NODE,hotkeys:n}}},render:!0}}case"b":{const n={};return Object.keys(e.graph.bodys).forEach(((e,t)=>{n[e]=String.fromCharCode(97+t)})),{model:{...e,focus:{...t,quickSelect:{kind:y.BODY,hotkeys:n}}},render:!0}}default:return{model:e}}},U=(e,t,n,r)=>{const o=Object.entries(t.hotkeys).find((([e,t])=>t===n));if(void 0!==o){const[t,n]=o;return D(e,t,r)}return{model:{...e,focus:{...e.focus,quickSelect:{kind:y.NONE}}},render:!0}},I=(e,t,n,r)=>{const o=Object.entries(t.hotkeys).find((([e,t])=>t===n));if(void 0!==o){const[t,n]=o;return R(e,t,r)}return{model:{...e,focus:{...e.focus,quickSelect:{kind:y.NONE}}},render:!0}},v=(e,t,n)=>{const r=Object.entries(t.hotkeys).find((([e,t])=>t===n));if(void 0!==r){const[t,n]=r;return{model:{...e,focus:{kind:p.NODE,node:t,drag:!1,move:{left:!1,up:!1,down:!1,right:!1,now:0},quickSelect:{kind:y.NONE}}},render:!0}}return{model:{...e,focus:{...e.focus,quickSelect:{kind:y.NONE}}},render:!0}},b=(e,t,n)=>{const r=Object.entries(t.hotkeys).find((([e,t])=>t===n));if(void 0!==r){const[t,n]=r;return{model:{...e,focus:{kind:p.BODY,body:t,quickSelect:{kind:y.NONE}}},render:!0}}return{model:{...e,focus:{...e.focus,quickSelect:{kind:y.NONE}}},render:!0}},S=(e,{key:t,ctrl:n},r)=>{const o=()=>{const{left:t,down:n,up:o,right:i}=e.panCamera;return!(t||n||o||i)?{now:r(),dispatch:[{kind:M.PAN_CAMERA}]}:{now:e.panCamera.now}},i=()=>!(e.zoomCamera.in||e.zoomCamera.out)?{now:r(),dispatch:[{kind:M.ZOOM_CAMERA}]}:{now:e.zoomCamera.now},s={x:e.window.width/2,y:e.window.height/2,show:!0};switch(t){case"h":case"ArrowLeft":{const{now:t,dispatch:n}=o();return{model:{...e,panCamera:{...e.panCamera,left:!0,now:t},nodePlacementLocation:s},dispatch:n}}case"j":case"ArrowDown":if(n){const{now:t,dispatch:n}=i();return{model:{...e,zoomCamera:{...e.zoomCamera,out:!0,now:t},panCamera:{...e.panCamera,up:!1,down:!1},nodePlacementLocation:s},dispatch:n}}{const{now:t,dispatch:n}=o();return{model:{...e,zoomCamera:{...e.zoomCamera,in:!1,out:!1},panCamera:{...e.panCamera,down:!0,now:t},nodePlacementLocation:s},dispatch:n}}case"k":case"ArrowUp":if(n){const{now:t,dispatch:n}=i();return{model:{...e,zoomCamera:{...e.zoomCamera,in:!0,now:t},panCamera:{...e.panCamera,up:!1,down:!1},nodePlacementLocation:s},dispatch:n}}{const{now:t,dispatch:n}=o();return{model:{...e,zoomCamera:{...e.zoomCamera,in:!1,out:!1},panCamera:{...e.panCamera,up:!0,now:t},nodePlacementLocation:s},dispatch:n}}case"l":case"ArrowRight":{const{now:t,dispatch:n}=o();return{model:{...e,panCamera:{...e.panCamera,right:!0,now:t},nodePlacementLocation:s},dispatch:n}}default:return{model:e}}},P=(e,t)=>{const{left:n,down:r,up:o,right:i}=e.panCamera;if(n||r||o||i){const s=(n?-1:0)+(i?1:0),c=(o?-1:0)+(r?1:0),u=Math.max(Math.sqrt(Math.pow(Math.abs(s),2)+Math.pow(Math.abs(c),2)),1),l=t(),h=.5*(l-e.panCamera.now);return{model:{...e,panCamera:{...e.panCamera,now:l},camera:d(e.camera,a(s/u*h,c/u*h))},render:!0,schedule:[{after:{milliseconds:10},event:{kind:M.PAN_CAMERA}}]}}return{model:e}},L=(e,t)=>{if(e.zoomCamera.in||e.zoomCamera.out){const n=t(),r=(n-e.zoomCamera.now)*((e.zoomCamera.in?-1:0)+(e.zoomCamera.out?1:0)),{x:o,y:i}=e.nodePlacementLocation,s=a(o,i),u=Math.pow(2,.01*r),l=a(-o,-i),h=d(e.camera,s,c(u,u),l);return{model:{...e,zoomCamera:{...e.zoomCamera,now:n},camera:h},render:!0,schedule:[{after:{milliseconds:10},event:{kind:M.ZOOM_CAMERA}}]}}return{model:e}},z=(e,t,n,r)=>{const{left:o,down:i,up:s,right:a}=t.move,c=!(o||i||s||a),{now:d,dispatch:u}=c?{now:r(),dispatch:[{kind:M.MOVE_NODE}]}:{now:t.move.now},l={...e.nodePlacementLocation,show:!1};switch(n){case"h":case"ArrowLeft":return{model:{...e,focus:{...t,move:{...t.move,left:!0,now:d}},nodePlacementLocation:l},dispatch:u};case"j":case"ArrowDown":return{model:{...e,focus:{...t,move:{...t.move,down:!0,now:d}},nodePlacementLocation:l},dispatch:u};case"k":case"ArrowUp":return{model:{...e,focus:{...t,move:{...t.move,up:!0,now:d}},nodePlacementLocation:l},dispatch:u};case"l":case"ArrowRight":return{model:{...e,focus:{...t,move:{...t.move,right:!0,now:d}},nodePlacementLocation:l},dispatch:u};default:return{model:e}}},F=(e,t)=>{if(e.focus.kind===p.NODE){const{left:n,down:r,up:o,right:i}=e.focus.move;if(n||r||o||i){const s=(n?-1:0)+(i?1:0),a=(o?-1:0)+(r?1:0),c=Math.max(Math.sqrt(Math.pow(Math.abs(s),2)+Math.pow(Math.abs(a),2)),1),d=t(),p=.5*(d-e.focus.move.now)/h(u(l(e.camera),[0,1,0])),m=T(e.graph,e.focus.node,(e=>({x:e.x+s/c*p,y:e.y+a/c*p})));return{model:{...e,focus:{...e.focus,move:{...e.focus.move,now:d}},graph:m},render:!0,schedule:[{after:{milliseconds:10},event:{kind:M.MOVE_NODE}}]}}return{model:e}}return{model:e}};let M;var B;(B=M||(M={}))[B.POINTER_MOVE=0]="POINTER_MOVE",B[B.POINTER_DOWN=1]="POINTER_DOWN",B[B.POINTER_UP=2]="POINTER_UP",B[B.CLICKED_NODE=3]="CLICKED_NODE",B[B.WHEEL=4]="WHEEL",B[B.CLICKED_INPUT=5]="CLICKED_INPUT",B[B.CLICKED_OUTPUT=6]="CLICKED_OUTPUT",B[B.OPEN_FINDER_TIMEOUT=7]="OPEN_FINDER_TIMEOUT",B[B.KEYDOWN=8]="KEYDOWN",B[B.KEYUP=9]="KEYUP",B[B.VIRTUAL_KEYDOWN=10]="VIRTUAL_KEYDOWN",B[B.CLICKED_FINDER_OPTION=11]="CLICKED_FINDER_OPTION",B[B.CLICKED_BODY=12]="CLICKED_BODY",B[B.CLICKED_BACKGROUND=13]="CLICKED_BACKGROUND",B[B.DELETE_NODE=14]="DELETE_NODE",B[B.DELETE_INPUT_EDGE=15]="DELETE_INPUT_EDGE",B[B.DELETE_OUTPUT_EDGES=16]="DELETE_OUTPUT_EDGES",B[B.PAN_CAMERA=17]="PAN_CAMERA",B[B.ZOOM_CAMERA=18]="ZOOM_CAMERA",B[B.MOVE_NODE=19]="MOVE_NODE";const Y=(e,t)=>Object.keys(e).filter((e=>i({haystack:e,needle:t}))),W=e=>({...e,focus:{kind:p.FINDER,search:"",options:Object.keys(e.operations),quickSelect:{kind:y.NONE}},openFinderFirstClick:!1}),K=(e,t,n)=>{const r=e.operations[t],[o,i,s]=u(e.camera,[e.nodePlacementLocation.x,e.nodePlacementLocation.y,1]),{model:a}=V({model:e,operation:r,position:{x:o,y:i},generateUUID:n});return{model:O(a),render:!0}},q=(e,t,n)=>{const r=n(t.search);return{model:{...e,focus:{kind:p.FINDER,options:Y(e.operations,r),search:r,quickSelect:{kind:y.NONE}}},render:!0}},H=(e,t,n)=>({model:{...e,graph:w(e.graph,t,n)},render:!0}),V=({model:e,operation:t,position:n,generateUUID:r})=>{const{graph:o,node:i}=g({graph:e.graph,operation:t,position:n,generateUUID:r});return{model:{...e,graph:o,nodeOrder:[...e.nodeOrder,i]},node:i}},j=(e,t)=>O({...e,graph:N(e.graph,t),nodeOrder:e.nodeOrder.filter((e=>e!==t))}),G=(e,t,{generateUUID:n,currentTime:r})=>{const{key:o}=t;switch(e.focus.quickSelect.kind){case y.INPUT:return U(e,e.focus.quickSelect,o,n);case y.OUTPUT:return I(e,e.focus.quickSelect,o,n);case y.NODE:return v(e,e.focus.quickSelect,o);case y.BODY:return b(e,e.focus.quickSelect,o);case y.NONE:switch(e.focus.kind){case p.FINDER:switch(o){case"Backspace":return q(e,e.focus,(e=>e.slice(0,-1)));case"Shift":case"Alt":case"Control":case"Meta":case"Tab":return{model:e};case"Enter":if(e.focus.options.length>0){const t=e.focus.options[0];return K(e,t,n)}return{model:O(e),render:!0};case"Escape":return{model:O(e),render:!0};default:return q(e,e.focus,(e=>e+o))}case p.BODY:switch(o){case"Backspace":return H(e,e.focus.body,(e=>{let t=e.toString().slice(0,-1);return""===t?0:parseFloat(t)}));case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":return H(e,e.focus.body,(e=>parseFloat(e.toString()+o)));case"Enter":case"Escape":return{model:O(e),render:!0};default:return _(e,e.focus,o)}case p.NODE:switch(o){case"f":return{model:W(e),render:!0};case"d":case"Backspace":case"Delete":return{model:j(e,e.focus.node),render:!0};case"Escape":return{model:O(e),render:!0};default:const t=_(e,e.focus,o);return t.render?t:z(t.model,e.focus,o,r)}case p.INPUT:switch(o){case"f":return{model:W(e),render:!0};case"d":case"Backspace":case"Delete":return{model:O({...e,graph:A(e.graph,e.focus.input)}),render:!0};case"Escape":return{model:O(e),render:!0};default:return _(e,e.focus,o)}case p.OUTPUT:switch(o){case"f":return{model:W(e),render:!0};case"d":case"Backspace":case"Delete":return{model:O({...e,graph:x(e.graph,e.focus.output)}),render:!0};case"Escape":return{model:O(e),render:!0};default:return _(e,e.focus,o)}case p.NONE:if("f"==o)return{model:W(e),render:!0};{const n=_(e,e.focus,o);return n.render?n:S(n.model,t,r)}}}},X=(e,t)=>({...e,focus:{kind:p.BODY,body:t,quickSelect:{kind:y.NONE}}}),$=({x0:e,y0:t,x1:n,y1:r},o)=>e<=o.position.x&&o.position.x<=n&&t<=o.position.y&&o.position.y<=r,Z=(e,t)=>{for(let n=e.clickHandlers.length;n>0;--n)for(const{onClick:r,worldSpace:o}of e.clickHandlers[n-1])if($(o,t))return e.dispatch(r),e;return e},J=e=>({triangles:{vertices:[],colors:[],vertexIndices:[],textureIndex:e,textureCoordinates:[],cameraIndex:[]},lines:{vertices:[],colors:[]}});function*Q(e,t,n,r){const o=(t.x0+t.x1)/2,i=(t.y0+t.y1)/2,s=o+r,a=i,c=(n.x0+n.x1)/2,d=(n.y0+n.y1)/2,u=c-r,l=d;let h=0,p=0,m=!0;for(const t of e){const e=t*t,n=e*t,r=1-t,f=r*r,E=f*r,g=3*f*t,N=3*r*e,A=E*o+g*s+N*u+n*c,x=E*i+g*a+N*l+n*d;m?(yield A,yield x,m=!1):(yield h,yield p),yield A,yield x,h=A,p=x}}const ee=(e,t,n)=>{const r=((e,t,n)=>{const r=(t-e)/(n-1);return Array.from({length:n},((t,n)=>e+r*n))})(0,1,20),o=[];let i=J(0),s=i.triangles.textureIndex.toString();return e.forEach(((e,a)=>{for(const[t,n]of Object.entries(e)){s!==t&&(0!==i.triangles.vertices.length&&o.push(i),i=J(parseInt(t)),s=t);for(const e of n){const t=i.triangles.vertices.length/2;i.triangles.vertices.push(...e.vertices),i.triangles.colors.push(...e.colors);for(const n of e.vertexIndices)i.triangles.vertexIndices.push(n+t);i.triangles.textureCoordinates.push(...e.textureCoordinates),i.triangles.cameraIndex.push(...e.cameraIndex)}}if(t.length>a){for(const{connections:e,scale:o}of t[a]){const t=50*o;for(const{from:o,to:s,color:a}of e){for(const e of Q(r,n[o],n[s],t))i.lines.vertices.push(e);const{red:e,green:c,blue:d,alpha:u}=a;for(let t=0;t<40;++t)i.lines.colors.push(e,c,d,u)}}0!==i.lines.vertices.length&&(o.push(i),i=J(0))}})),0!==i.triangles.vertices.length&&o.push(i),o},te=(e,t)=>{const n=e.cameras.length;e.cameras.push(t),e.stack.push(n),e.transform=l(t)},ne=e=>e.stack.slice(-1)[0],re=e=>{e.stack.pop(),e.transform=l(e.cameras[ne(e)])},oe=(e,t)=>{const[n,r,o]=u(e.transform,[t.x0,t.y0,1]),[i,s,a]=u(e.transform,[t.x1,t.y1,1]);return{x0:n,y0:r,x1:i,y1:s}},ie=(e,t,n)=>{const r=Ye(e.child,t,n);return{size:{width:t.maxWidth,height:t.maxHeight},child:r}},se=(e,t,n,r)=>{const o=oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),i=t.child,s={x:n.x+t.size.width/2-i.size.width/2,y:n.y+t.size.height/2-i.size.height/2};return{worldSpace:o,child:We(e.child,i,s,r)}};function*ae(e,t,n,r){yield*Ke(e.child,t.child,n.child,r+1)}let ce;var de;let ue;var le;function he(...e){const[t,n]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:Me.COLUMN,mainAxisAlignment:t.mainAxisAlignment??ce.START,crossAxisAlignment:t.crossAxisAlignment??ue.START,children:n}}(de=ce||(ce={}))[de.START=0]="START",de[de.CENTER=1]="CENTER",de[de.END=2]="END",de[de.SPACE_EVENLY=3]="SPACE_EVENLY",de[de.SPACE_BETWEEN=4]="SPACE_BETWEEN",(le=ue||(ue={}))[le.START=0]="START",le[le.CENTER=1]="CENTER",le[le.END=2]="END";const pe=(e,t,n)=>{const r={children:[],width:0,totalChildHeight:0},o=e.children.reduce(((e,r)=>{const o=Ye(r,t,n);return e.children.push(o),e.totalChildHeight+=o.size.height,e.width=Math.max(e.width,o.size.width),e}),r),{children:i,width:s,totalChildHeight:a}=o;return{size:{width:s,height:e.mainAxisAlignment==ce.START?a:t.maxHeight},totalChildHeight:a,children:i}},me=(e,t,n,r)=>{const o=t.size.height-t.totalChildHeight,i={children:[],y:(()=>{switch(e.mainAxisAlignment){case ce.START:return n.y;case ce.CENTER:return n.y+o/2;case ce.END:return n.y+o;case ce.SPACE_EVENLY:return n.y+o/(e.children.length+1);case ce.SPACE_BETWEEN:return n.y}})()},s=e=>e.size.height,a=e=>e.size.height,c=e=>e.size.height,d=t=>t.size.height+o/(e.children.length+1),u=t=>t.size.height+o/(e.children.length-1),l=(()=>{switch(e.mainAxisAlignment){case ce.START:return s;case ce.CENTER:return a;case ce.END:return c;case ce.SPACE_EVENLY:return d;case ce.SPACE_BETWEEN:return u}})(),h=e=>n.x,p=e=>n.x+t.size.width/2-e.size.width/2,m=e=>n.x+t.size.width-e.size.width,f=(()=>{switch(e.crossAxisAlignment){case ue.START:return h;case ue.CENTER:return p;case ue.END:return m}})(),E=e.children.reduce(((e,n,o)=>{const i=t.children[o],s={x:f(i),y:e.y},a=We(n,i,s,r);return e.children.push(a),e.y+=l(i),e}),i);return{worldSpace:oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:E.children}};function*fe(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const o=r+1;let i=0;for(const r of e.children)yield*Ke(r,t.children[i],n.children[i],o),i+=1}const Ee=e=>e?"number"==typeof e?{top:e,right:e,bottom:e,left:e}:e:{top:0,right:0,bottom:0,left:0},ge=({padding:e,width:t,height:n,color:r,x:o,y:i,onClick:s,id:a},c)=>({kind:Me.CONTAINER,padding:Ee(e),width:t,height:n,x:o,y:i,color:r,onClick:s,id:a,child:c}),Ne=(e,t,n)=>{const{top:r,right:o,bottom:i,left:s}=e.padding;if(e.child){const a=Ye(e.child,t,n);return{size:{width:e.width??a.size.width+s+o,height:e.height??a.size.height+r+i},child:a}}return{size:{width:e.width?e.width+s+o:t.maxWidth,height:e.height?e.height+r+i:t.maxHeight}}},Ae=(e,t,n,r)=>{const o=n.x+(e.x??0),i=o+t.size.width,s=n.y+(e.y??0),a=s+t.size.height,c=oe(r,{x0:o,x1:i,y0:s,y1:a}),d=(()=>{if(e.child){const n=t.child,i={x:o+e.padding.left,y:s+e.padding.top};return We(e.child,n,i,r)}})();if(e.color){const{red:t,green:n,blue:u,alpha:l}=e.color;return{worldSpace:c,vertices:[o,s,o,a,i,s,i,a],colors:[t,n,u,l,t,n,u,l,t,n,u,l,t,n,u,l],vertexIndices:[0,1,2,1,2,3],cameraIndex:Array(4).fill(ne(r)),textureIndex:0,textureCoordinates:Array(8).fill(0),child:d}}return{worldSpace:c,vertices:[],colors:[],vertexIndices:[],cameraIndex:[],textureIndex:0,textureCoordinates:[],child:d}};function*xe(e,t,n,r){if(yield{ui:e,layout:t,geometry:n,z:r},e.child){const o=t.child,i=n.child;yield*Ke(e.child,o,i,r+1)}}function Ce(...e){const[t,n]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:Me.ROW,mainAxisAlignment:t.mainAxisAlignment??ce.START,crossAxisAlignment:t.crossAxisAlignment??ue.START,children:n}}const Te=(e,t,n)=>{const r={children:[],totalChildWidth:0,height:0},o=e.children.reduce(((e,r)=>{const o=Ye(r,t,n);return e.children.push(o),e.totalChildWidth+=o.size.width,e.height=Math.max(e.height,o.size.height),e}),r),{children:i,totalChildWidth:s,height:a}=o;return{size:{width:e.mainAxisAlignment==ce.START?s:t.maxWidth,height:a},totalChildWidth:s,children:i}},we=(e,t,n,r)=>{const o=t.size.width-t.totalChildWidth,i={children:[],x:(()=>{switch(e.mainAxisAlignment){case ce.START:return n.x;case ce.CENTER:return n.x+o/2;case ce.END:return n.x+o;case ce.SPACE_EVENLY:return n.x+o/(e.children.length+1);case ce.SPACE_BETWEEN:return n.x}})()},s=e=>e.size.width,a=e=>e.size.width,c=e=>e.size.width,d=t=>t.size.width+o/(e.children.length+1),u=t=>t.size.width+o/(e.children.length-1),l=(()=>{switch(e.mainAxisAlignment){case ce.START:return s;case ce.CENTER:return a;case ce.END:return c;case ce.SPACE_EVENLY:return d;case ce.SPACE_BETWEEN:return u}})(),h=e=>n.y,p=e=>n.y+t.size.height/2-e.size.height/2,m=e=>n.y+t.size.height-e.size.height,f=(()=>{switch(e.crossAxisAlignment){case ue.START:return h;case ue.CENTER:return p;case ue.END:return m}})(),E=e.children.reduce(((e,n,o)=>{const i=t.children[o],s={x:e.x,y:f(i)},a=We(n,i,s,r);return e.children.push(a),e.x+=l(i),e}),i);return{worldSpace:oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:E.children}};function*ye(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const o=r+1;let i=0;for(const r of e.children)yield*Ke(r,t.children[i],n.children[i],o),i+=1}const ke=({id:e,onClick:t,camera:n,children:r,connections:o})=>({id:e,onClick:t,kind:Me.SCENE,camera:n,children:r,connections:o??[]}),Oe=(e,t,n)=>{const r=e.children.map((e=>Ye(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},De=(e,t,n,r)=>{const o=oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height});te(r,e.camera);const i=e.children.map(((e,o)=>We(e,t.children[o],n,r)));return re(r),{worldSpace:o,children:i}};function*Re(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let o=0;for(const i of e.children){for(const e of Ke(i,t.children[o],n.children[o],r))yield e,r=Math.max(r,e.z);o++,r++}}const _e=(e,t,n)=>{const r=e.children.map((e=>Ye(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},Ue=(e,t,n,r)=>{const o=e.children.map(((e,o)=>We(e,t.children[o],n,r)));return{worldSpace:oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:o}};function*Ie(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let o=0;for(const i of e.children){for(const e of Ke(i,t.children[o],n.children[o],r))yield e,r=Math.max(r,e.z);o+=1,r+=1}}function ve(...e){const[t,n]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]];return{kind:Me.TEXT,font:{family:t.font??"monospace",size:t.size??14},color:t.color??{red:255,green:255,blue:255,alpha:255},str:n}}const be=({font:e,str:t},n,r)=>{const o=r(e,t),i=o.widths.reduce(((e,t)=>e+t));return{measurements:o,size:{width:i,height:e.size}}},Se=(e,t,n)=>{const r=[];let o=n.x;const i=n.y,s=n.y+t;for(const t of e){const e=o,n=o+t;r.push(e,i,e,s,n,i,n,s),o+=t}return r},Pe=(e,{red:t,green:n,blue:r,alpha:o})=>{const i=[];for(let s=0;s<e;++s)i.push(t,n,r,o,t,n,r,o,t,n,r,o,t,n,r,o);return i},Le=e=>{const t=[];let n=0;for(let r=0;r<e;++r)t.push(n,n+1,n+2,n+1,n+2,n+3),n+=4;return t},ze=(e,t,n,r)=>{const o=t,{measurements:i}=o,{textureIndex:s,textureCoordinates:a,widths:c}=i;return{worldSpace:oe(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),textureIndex:s,textureCoordinates:a.flat(),colors:Pe(c.length,e.color),vertices:Se(c,e.font.size,n),vertexIndices:Le(c.length),cameraIndex:Array(4*c.length).fill(ne(r))}};function*Fe(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r}}let Me;var Be;(Be=Me||(Me={}))[Be.CENTER=0]="CENTER",Be[Be.COLUMN=1]="COLUMN",Be[Be.CONTAINER=2]="CONTAINER",Be[Be.ROW=3]="ROW",Be[Be.SCENE=4]="SCENE",Be[Be.STACK=5]="STACK",Be[Be.TEXT=6]="TEXT";const Ye=(e,t,n)=>{switch(e.kind){case Me.CENTER:return ie(e,t,n);case Me.COLUMN:return pe(e,t,n);case Me.CONTAINER:return Ne(e,t,n);case Me.ROW:return Te(e,t,n);case Me.SCENE:return Oe(e,t,n);case Me.STACK:return _e(e,t,n);case Me.TEXT:return be(e,0,n)}},We=(e,t,n,r)=>{switch(e.kind){case Me.CENTER:return se(e,t,n,r);case Me.COLUMN:return me(e,t,n,r);case Me.CONTAINER:return Ae(e,t,n,r);case Me.ROW:return we(e,t,n,r);case Me.SCENE:return De(e,t,n,r);case Me.STACK:return Ue(e,t,n,r);case Me.TEXT:return ze(e,t,n,r)}};function*Ke(e,t,n,r){switch(e.kind){case Me.CENTER:yield*ae(e,t,n,r);break;case Me.COLUMN:yield*fe(e,t,n,r);break;case Me.CONTAINER:yield*xe(e,t,n,r);break;case Me.ROW:yield*ye(e,t,n,r);break;case Me.SCENE:yield*Re(e,t,n,r);break;case Me.STACK:yield*Ie(e,t,n,r);break;case Me.TEXT:yield*Fe(e,t,n,r)}}const qe=(e,t,n,r)=>{const o=r.initial();for(const i of Ke(e,t,n,0))r.combine(o,i);return o};var He={};e(He,"initial",(()=>$e)),e(He,"combine",(()=>Ze));const Ve=(e,t)=>{if(void 0===t.ui.onClick)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({onClick:t.ui.onClick,worldSpace:t.geometry.worldSpace}),e},je=(e,t)=>t.ui.id?(e[t.ui.id]=t.geometry.worldSpace,e):e,Ge=(e,t)=>{switch(t.ui.kind){case Me.CONTAINER:case Me.TEXT:const n=t.geometry;if(0==n.vertices.length)return e;const r=t.z-e.length+1;for(let t=0;t<r;++t)e.push({});const o=e[t.z];return(()=>{const e=o[n.textureIndex];if(e)return e;const t=[];return o[n.textureIndex]=t,t})().push(n),e;default:return e}},Xe=(e,t)=>{if(t.ui.kind==Me.SCENE){if(0===t.ui.connections.length)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({connections:t.ui.connections,scale:h(u(l(t.ui.camera),[0,1,0]))}),e}return e},$e=()=>({layers:[],clickHandlers:[],idToWorldSpace:{},connections:[]}),Ze=(e,t)=>({layers:Ge(e.layers,t),clickHandlers:Ve(e.clickHandlers,t),idToWorldSpace:je(e.idToWorldSpace,t),connections:Xe(e.connections,t)}),Je=(e,t)=>{const{width:n,height:r}=e.size;e.clear();const o=Ye(t,{minWidth:0,maxWidth:n,minHeight:0,maxHeight:r},e.measureText),i={cameras:[[1,0,0,0,1,0,0,0,1]],stack:[0],transform:l([1,0,0,0,1,0,0,0,1])},s=We(t,o,{x:0,y:0},i),{layers:a,clickHandlers:c,connections:d,idToWorldSpace:u}=qe(t,o,s,He),h=ee(a,d,u);e.cameras=i.cameras,e.clickHandlers=c;for(const t of h)e.draw(t);return e};let Qe;var et;(et=Qe||(Qe={}))[et.DATA=0]="DATA",et[et.ERROR=1]="ERROR";class tt{constructor(e,t,n,r,o,i,s,a,c){this.window=e,this.document=t,this.canvas=n,this.gl=r,this.program=o,this.textures=i,this.textMeasurementsCache=s,this.clickHandlers=a,this.dispatch=c,this.kind=Qe.DATA,this.clear=()=>{const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)},this.draw=({triangles:e,lines:t})=>{const{gl:n,program:r,textures:o}=this,{attributes:i}=r;{const{vertices:t,colors:r,vertexIndices:s,textureCoordinates:a,textureIndex:c,cameraIndex:d}=e;if(0!==t.length){const e=o[c];n.bindTexture(n.TEXTURE_2D,e),n.bindBuffer(n.ARRAY_BUFFER,i.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(d),n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.vertexIndices),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),n.STATIC_DRAW),n.drawElements(n.TRIANGLES,s.length,n.UNSIGNED_SHORT,0)}}{const{vertices:e,colors:r}=t;if(0!==e.length){const t=o[0],s=e.length/2;n.bindTexture(n.TEXTURE_2D,t),n.bindBuffer(n.ARRAY_BUFFER,i.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(Array(2*s).fill(0)),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,i.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(Array(s).fill(0)),n.STATIC_DRAW),n.drawArrays(n.LINES,0,s)}}},this.getTextureMeasurements=(e,t)=>{const{document:n,gl:r}=this,o=`${t} ${e.size} ${e.family}`,i=this.textMeasurementsCache.get(o);if(i)return i;const{texture:s,widths:a,textureCoordinates:c}=((e,t,n,r)=>{const o=e.createElement("canvas"),i=o.getContext("2d"),s=Math.sqrt(256),a=(e=>{let t=1;for(;t<e;)t<<=1;return t})(n.size*s),c=a/s;o.width=a*r,o.height=a*r,o.style.width=`${a}px`,o.style.height=`${a}px`,i.scale(r,r),i.textAlign="left",i.textBaseline="top",i.font=`${n.size}px ${n.family}`,i.fillStyle="white",i.clearRect(0,0,i.canvas.width,i.canvas.height);const d=n.size,u=[],l=[];for(let e=0;e<256;++e){const t=String.fromCharCode(e),n=i.measureText(t),r=Math.ceil(n.width),o=e%s*c,h=Math.floor(e/s)*c;i.fillText(t,o,h),u.push(r);const p=o/a,m=(o+r)/a,f=h/a,E=(h+d)/a;l.push([p,f,p,E,m,f,m,E])}const h=t.createTexture();return t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{widths:u,textureCoordinates:l,texture:h}})(n,r,e,t),d=this.textures.length;this.textures.push(s);const u={widths:a,textureIndex:d,textureCoordinates:c};return this.textMeasurementsCache.set(o,u),u},this.measureText=(e,t)=>{const{window:n}=this,r=n.devicePixelRatio,{widths:o,textureIndex:i,textureCoordinates:s}=this.getTextureMeasurements(e,r),a=((e,t)=>{let n=[];for(let r=0;r<e.length;++r)n.push(t(e[r],r));return n})(t,(e=>e.charCodeAt(0)));return{widths:a.map((e=>o[e])),textureIndex:i,textureCoordinates:a.map((e=>s[e]))}}}set size(e){const{gl:t,program:n,window:r}=this,{uniforms:o}=n,{canvas:i}=t;t.uniformMatrix3fv(o.projection,!0,s(e)),i.width=e.width*r.devicePixelRatio,i.height=e.height*r.devicePixelRatio,i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.display="block",t.viewport(0,0,i.width,i.height),this._size=e}get size(){return this._size}set cameras(e){const{gl:t,program:n}=this,{uniforms:r}=n,o=[];for(const t of e)o.push(...t);t.uniformMatrix3fv(r.cameras,!0,o),this._cameras=e}get cameras(){return this._cameras}}const nt=({width:e,height:t,document:n,window:r,dispatch:o})=>{const i=n.createElement("canvas");i.style.touchAction="none";const s=i.getContext("webgl2");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.clearColor(0,0,0,1);const a=(e=>{const t={vertices:{location:0,buffer:e.createBuffer()},colors:{location:1,buffer:e.createBuffer()},textureCoordinates:{location:2,buffer:e.createBuffer()},cameraIndex:{location:3,buffer:e.createBuffer()},vertexIndices:e.createBuffer()},n=((e,t)=>{const{vertices:n,colors:r,textureCoordinates:o,cameraIndex:i}=t,s=`#version 300 es\n  uniform mat3 u_projection;\n  uniform mat3 u_cameras[8];\n\n  layout(location = ${n.location}) in vec2 a_vertex;\n  layout(location = ${r.location}) in vec4 a_color;\n  layout(location = ${o.location}) in vec2 a_textureCoordinates;\n  layout(location = ${i.location}) in uint a_cameraIndex;\n\n  out vec4 v_color;\n  out vec2 v_textureCoordinates;\n\n  void main() {\n    mat3 camera = u_cameras[a_cameraIndex];\n    mat3 transform = u_projection * inverse(camera);\n    gl_Position = vec4((transform * vec3(a_vertex, 1)).xy, 0, 1);\n    v_color = a_color / 255.0;\n    v_textureCoordinates = a_textureCoordinates;\n  }\n  `,a=e.createShader(e.VERTEX_SHADER);return e.shaderSource(a,s),e.compileShader(a),a})(e,t),r=(e=>{const t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec4 v_color;\n  in vec2 v_textureCoordinates;\n\n  out vec4 fragColor;\n  \n  void main() {\n    fragColor = texture(u_texture, v_textureCoordinates) * v_color;\n  }\n  "),e.compileShader(t),t})(e),o=e.createProgram();if(e.attachShader(o,n),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))return{kind:Qe.ERROR,vertexInfoLog:e.getShaderInfoLog(n),fragmentInfoLog:e.getShaderInfoLog(r)};e.useProgram(o);const i=e.createVertexArray();e.bindVertexArray(i),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_vertex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,o,t.vertices),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_color"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0)})(e,o,t.colors),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_textureCoordinates"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,o,t.textureCoordinates),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_cameraIndex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribIPointer(n,1,e.UNSIGNED_BYTE,0,0)})(e,o,t.cameraIndex);const s={projection:e.getUniformLocation(o,"u_projection"),texture:e.getUniformLocation(o,"u_texture"),cameras:e.getUniformLocation(o,"u_cameras")};return{kind:Qe.DATA,vertexShader:n,fragmentShader:r,program:o,attributes:t,uniforms:s}})(s);if(a.kind==Qe.ERROR)return a;const c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const d=new tt(r,n,i,s,a,[c],new Map,[],o??(()=>{}));return d.size={width:e,height:t},d},rt=e=>({id:e.pointerId,position:{x:e.clientX,y:e.clientY}}),ot=({items:e,backgroundColor:t})=>he({mainAxisAlignment:ce.END},[Ce({mainAxisAlignment:ce.END},[ge({padding:4,color:t},he(e.map((({name:e,shortcut:t,onClick:n})=>ge({padding:10,onClick:n},ve({size:18},`(${t}) ${e}`))))))])]),it=e=>ge({width:e,height:e}),st=(e,t)=>{const n=[e[0]];for(const r of e.slice(1))n.push(t,r);return n},at=(e,t)=>{switch(e.kind){case p.BODY:return e.body===t;case p.INPUT:return e.input===t;case p.NODE:return e.node===t;case p.OUTPUT:return e.output===t;default:return!1}},ct=(e,t,n)=>he(st(t.map((t=>((e,{name:t,uuid:n},r)=>ge({onClick:{kind:M.CLICKED_INPUT,input:n}},Ce({crossAxisAlignment:ue.CENTER},[ge({id:n,color:at(r,n)?e.focusInput:e.input,padding:{top:2,right:4,bottom:2,left:4}},ve({color:e.background},r.quickSelect.kind===y.INPUT?r.quickSelect.hotkeys[n]:" ")),it(4),ve(t)])))(e,t,n))),it(4))),dt=(e,t,n)=>he(st(t.map((t=>((e,{name:t,uuid:n},r)=>ge({onClick:{kind:M.CLICKED_OUTPUT,output:n}},Ce({crossAxisAlignment:ue.CENTER},[ve(t),it(4),ge({id:n,color:at(r,n)?e.focusInput:e.input,padding:{top:2,right:4,bottom:2,left:4}},ve({color:e.background},r.quickSelect.kind===y.OUTPUT?r.quickSelect.hotkeys[n]:" "))])))(e,t,n))),it(4))),ut=(e,t,n,r)=>{const o=n.nodes[t],i=[];o.inputs.length&&i.push(ct(e,o.inputs.map((e=>n.inputs[e])),r)),o.inputs.length&&o.outputs.length&&i.push(it(15)),o.body&&i.push(((e,t,n)=>{const r=n.quickSelect.kind===y.BODY?n.quickSelect.hotkeys[t.uuid]:t.value.toString();return ge({color:at(n,t.uuid)?e.focusInput:e.background,padding:5,onClick:{kind:M.CLICKED_BODY,body:t.uuid}},ve(r))})(e,n.bodys[o.body],r),it(15)),o.outputs.length&&i.push(dt(e,o.outputs.map((e=>n.outputs[e])),r));const s=r.quickSelect.kind===y.NODE?r.quickSelect.hotkeys[o.uuid]:o.name;return ge({color:at(r,o.uuid)?e.focusNode:e.node,padding:4,x:o.position.x,y:o.position.y,onClick:{kind:M.CLICKED_NODE,node:o.uuid}},he({crossAxisAlignment:ue.CENTER},[ve(s),it(4),Ce(i)]))},lt=e=>Ce(e.map((e=>{return t=e,ge({padding:10,onClick:{kind:M.VIRTUAL_KEYDOWN,key:t}},ve({size:24},t));var t}))),ht=[1,0,0,0,1,0,0,0,1],pt=e=>({graph:{nodes:{},edges:{},inputs:{},bodys:{},outputs:{}},nodeOrder:[],pointers:[],camera:[1,0,0,0,1,0,0,0,1],focus:{kind:p.NONE,pointerAction:{kind:f.NONE},quickSelect:{kind:y.NONE}},openFinderFirstClick:!1,nodePlacementLocation:{x:e.width/2,y:e.height/2,show:!1},window:e,operations:{},panCamera:{left:!1,down:!1,up:!1,right:!1,now:0},zoomCamera:{in:!1,out:!1,now:0},theme:{background:{red:2,green:22,blue:39,alpha:255},node:{red:41,green:95,blue:120,alpha:255},nodePlacementLocation:{red:41,green:95,blue:120,alpha:50},focusNode:{red:23,green:54,blue:69,alpha:255},input:{red:188,green:240,blue:192,alpha:255},focusInput:{red:175,green:122,blue:208,alpha:255},connection:{red:255,green:255,blue:255,alpha:255}}}),mt=()=>crypto.randomUUID(),ft=(e=>{let{model:t,view:n,update:r,window:o,document:i,requestAnimationFrame:s,setTimeout:a,effects:c}=e;const d=nt({width:o.innerWidth,height:o.innerHeight,window:o,document:i});switch(d.kind){case Qe.ERROR:return d;case Qe.DATA:let u=d,l=!1;const h=()=>{l||(l=!0,s((()=>{u=Je(u,n(t)),l=!1})))},p=e=>{const{model:n,render:o,schedule:i,dispatch:s}=r(c,t,e);t=n,o&&h();for(const{after:e,event:t}of i??[]){const{milliseconds:n}=e;a((()=>p(t)),n)}for(const e of s??[])p(e)};return u.dispatch=p,i.body.appendChild(u.canvas),i.addEventListener("pointerdown",(t=>{const n=rt(t);e.pointerDown(p,n),u=Z(u,n)})),o.addEventListener("resize",(()=>{u.size={width:o.innerWidth,height:o.innerHeight},h()})),h(),{kind:Qe.DATA,dispatch:p}}})({model:((e,t)=>{const n={...pt(e),operations:{Number:{name:"Number",inputs:[],body:0,outputs:["out"]},Add:{name:"Add",inputs:["x","y"],outputs:["out"]},Subtract:{name:"Subtract",inputs:["x","y"],outputs:["out"]},Multiply:{name:"Multiply",inputs:["x","y"],outputs:["out"]},Divide:{name:"Divide",inputs:["x","y"],outputs:["out"]},Equal:{name:"Equal",inputs:["x","y"],outputs:["out"]},"Less Than":{name:"Less Than",inputs:["x","y"],outputs:["out"]},Print:{name:"Print",inputs:["value"],outputs:[]}}},{graph:r,node:o}=g({graph:n.graph,operation:n.operations.Number,position:{x:25,y:20},generateUUID:t}),i=w(r,r.nodes[o].body,(()=>10)),{graph:s,node:a}=g({graph:i,operation:n.operations.Number,position:{x:55,y:105},generateUUID:t}),c=w(s,s.nodes[a].body,(()=>25)),{graph:d,node:u}=g({graph:c,operation:n.operations.Add,position:{x:175,y:55},generateUUID:t}),{graph:l}=C({graph:d,input:d.nodes[u].inputs[0],output:d.nodes[o].outputs[0],generateUUID:t}),{graph:h}=C({graph:l,input:l.nodes[u].inputs[1],output:l.nodes[a].outputs[0],generateUUID:t}),{graph:p,node:m}=g({graph:h,operation:n.operations.Number,position:{x:225,y:145},generateUUID:t}),f=w(p,p.nodes[m].body,(()=>5)),{graph:E,node:N}=g({graph:f,operation:n.operations.Divide,position:{x:355,y:75},generateUUID:t}),{graph:A}=C({graph:E,input:E.nodes[N].inputs[0],output:E.nodes[u].outputs[0],generateUUID:t}),{graph:x}=C({graph:A,input:A.nodes[N].inputs[1],output:A.nodes[m].outputs[0],generateUUID:t}),{graph:T,node:y}=g({graph:x,operation:n.operations.Print,position:{x:535,y:85},generateUUID:t}),{graph:k}=C({graph:T,input:T.nodes[y].inputs[0],output:T.nodes[N].outputs[0],generateUUID:t});return{...n,graph:k,nodeOrder:[o,a,u,m,N,y]}})({width:window.innerWidth,height:window.innerHeight},mt),view:e=>{const t=e.nodeOrder.map((t=>ut(e.theme,t,e.graph,e.focus))),n=Object.values(e.graph.edges).map((({input:t,output:n})=>({from:n,to:t,color:e.theme.connection}))),r=[ge({color:e.theme.background,onClick:{kind:M.CLICKED_BACKGROUND}}),ke({camera:e.camera,children:t,connections:n})];switch(e.nodePlacementLocation.show&&r.push(ke({camera:ht,children:[ge({color:e.theme.nodePlacementLocation,width:10,height:10,x:e.nodePlacementLocation.x,y:e.nodePlacementLocation.y})],connections:[]})),e.focus.kind){case p.FINDER:r.push((({search:e,options:t},n)=>he({crossAxisAlignment:ue.CENTER},[ge({height:10}),ge({color:n.node,padding:4},he([ge({color:n.background,width:300,padding:4},ve({color:n.input,size:24},e.length?e:"Search ...")),ge({width:10,height:10}),...t.map(((e,t)=>ge({padding:4,onClick:{kind:M.CLICKED_FINDER_OPTION,option:e}},ve({size:18,color:0==t?n.input:{red:255,green:255,blue:255,alpha:255}},e))))]))]))(e.focus,e.theme),(o=e.theme,he({mainAxisAlignment:ce.END},[Ce({mainAxisAlignment:ce.SPACE_BETWEEN},[ge({padding:4,color:o.node},he([lt(["1","2","3","4","5"]),lt(["q","w","e","r","t"]),lt(["a","s","d","f","g"]),lt(["z","x","c","v"]),lt(["sft","space"])])),ge({padding:4,color:o.node},he({crossAxisAlignment:ue.END},[lt(["6","7","8","9","0"]),lt(["y","u","i","o","p"]),lt(["h","j","k","l"]),lt(["b","n","m","del"]),lt(["space","ret"])]))])])));break;case p.BODY:r.push((e=>he({mainAxisAlignment:ce.END},[Ce({mainAxisAlignment:ce.END},[ge({padding:4,color:e.node},he({crossAxisAlignment:ue.END},[lt(["1","2","3","4"]),lt(["5","6","7","8"]),lt(["9","0","del"]),lt([".","ret"])]))])]))(e.theme));break;case p.NODE:r.push(ot({items:[{name:"Delete Node",shortcut:"d",onClick:{kind:M.DELETE_NODE,node:e.focus.node}}],backgroundColor:e.theme.node}));break;case p.INPUT:e.graph.inputs[e.focus.input].edge&&r.push(ot({items:[{name:"Delete Edge",shortcut:"d",onClick:{kind:M.DELETE_INPUT_EDGE,input:e.focus.input}}],backgroundColor:e.theme.node}));break;case p.OUTPUT:e.graph.outputs[e.focus.output].edges.length>0&&r.push(ot({items:[{name:"Delete Edge",shortcut:"d",onClick:{kind:M.DELETE_OUTPUT_EDGES,output:e.focus.output}}],backgroundColor:e.theme.node}))}var o,i;return i=r,{kind:Me.STACK,children:i}},update:(e,t,n)=>{switch(n.kind){case M.POINTER_DOWN:return((e,t)=>{const n=[...e.pointers,t.pointer];if(e.focus.kind!==p.NONE)return{model:{...e,pointers:n}};if(n.length>1){const t=2===n.length?{kind:f.ZOOM,pointerCenter:{x:0,y:0},pointerDistance:0}:{kind:f.NONE};return{model:{...e,openFinderFirstClick:!1,focus:{kind:p.NONE,pointerAction:t,quickSelect:{kind:y.NONE}},pointers:n}}}return{model:{...e,focus:{kind:p.NONE,pointerAction:{kind:f.PAN},quickSelect:{kind:y.NONE}},pointers:n}}})(t,n);case M.POINTER_UP:return((e,t)=>{const n=e.pointers.filter((e=>e.id!==t.pointer.id));switch(e.focus.kind){case p.NONE:switch(n.length){case 1:return{model:{...e,pointers:n,focus:{kind:p.NONE,pointerAction:{kind:f.PAN},quickSelect:{kind:y.NONE}}}};case 0:return{model:{...e,pointers:n,focus:{kind:p.NONE,pointerAction:{kind:f.NONE},quickSelect:{kind:y.NONE}}}};default:return{model:{...e,pointers:n}}}case p.NODE:if(0===n.length){const t={...e.focus,drag:!1};return{model:{...e,pointers:n,focus:t}}}return{model:{...e,pointers:n}};default:return{model:{...e,pointers:n}}}})(t,n);case M.POINTER_MOVE:return((e,t)=>{const n=e.pointers.findIndex((e=>e.id===t.pointer.id)),r=e.pointers[n],o=-1===n?e.pointers:(i=e.pointers,s=n,l=t.pointer,[...i.slice(0,s),l,...i.slice(s+1)]);var i,s,l;const m={x:t.pointer.position.x,y:t.pointer.position.y,show:!1};switch(e.focus.kind){case p.NONE:const n=e.focus.pointerAction;switch(n.kind){case f.NONE:const i=!!e.nodePlacementLocation.show||void 0;return{model:{...e,nodePlacementLocation:m,pointers:o},render:i};case f.PAN:const s=t.pointer.position.x-r.position.x,u=t.pointer.position.y-r.position.y,l=d(e.camera,a(-s,-u));return{model:{...e,pointers:o,camera:l},render:!0};case f.ZOOM:const[h,E]=[o[0],o[1]],{x:g,y:N}=h.position,{x:A,y:x}=E.position,C=(h.position.x+E.position.x)/2,T=(h.position.y+E.position.y)/2,w={kind:f.ZOOM,pointerDistance:Math.sqrt(Math.pow(A-g,2)+Math.pow(x-N,2)),pointerCenter:{x:C,y:T}},k={kind:p.NONE,pointerAction:w,quickSelect:{kind:y.NONE}};if(n.pointerDistance>0){const t=a(C,T),r=Math.pow(2,.01*(n.pointerDistance-w.pointerDistance)),i=a(-C,-T),s=C-n.pointerCenter.x,u=T-n.pointerCenter.y,l=d(e.camera,t,c(r,r),i,a(-s,-u));return{model:{...e,focus:k,pointers:o,camera:l},render:!0}}return{model:{...e,focus:k,pointers:o}}}case p.NODE:if(e.focus.drag){const n=t.pointer.position.x-r.position.x,i=t.pointer.position.y-r.position.y,s=h(u(e.camera,[0,1,0])),a=T(e.graph,e.focus.node,(e=>({x:e.x+n*s,y:e.y+i*s})));return{model:{...e,pointers:o,graph:a},render:!0}}return{model:{...e,pointers:o,nodePlacementLocation:m}};case p.BODY:case p.INPUT:case p.OUTPUT:return{model:{...e,pointers:o,nodePlacementLocation:m}};case p.FINDER:return{model:{...e,pointers:o}}}})(t,n);case M.CLICKED_NODE:return((e,t)=>{const n=e.nodeOrder.filter((e=>e!==t.node));return n.push(t.node),{model:{...e,focus:{kind:p.NODE,node:t.node,drag:!0,quickSelect:{kind:y.NONE},move:{left:!1,up:!1,down:!1,right:!1,now:0}},nodeOrder:n},render:!0}})(t,n);case M.WHEEL:return((e,t)=>{const n=a(t.position.x,t.position.y),r=Math.pow(2,.01*t.deltaY),o=a(-t.position.x,-t.position.y),i=d(e.camera,n,c(r,r),o);return{model:{...e,camera:i},render:!0}})(t,n);case M.CLICKED_INPUT:return((e,t,n)=>D(e,t.input,n))(t,n,e.generateUUID);case M.CLICKED_OUTPUT:return((e,t,n)=>R(e,t.output,n))(t,n,e.generateUUID);case M.OPEN_FINDER_TIMEOUT:return((e,t)=>({model:{...e,openFinderFirstClick:!1}}))(t);case M.KEYDOWN:return G(t,n,e);case M.KEYUP:return((e,t)=>{switch(e.focus.kind){case p.NONE:return((e,{key:t,ctrl:n})=>{switch(t){case"h":case"ArrowLeft":return{model:{...e,panCamera:{...e.panCamera,left:!1}}};case"j":case"ArrowDown":return n?{model:{...e,zoomCamera:{...e.zoomCamera,out:!1},panCamera:{...e.panCamera,up:!1,down:!1}}}:{model:{...e,zoomCamera:{...e.zoomCamera,in:!1,out:!1},panCamera:{...e.panCamera,down:!1}}};case"k":case"ArrowUp":return n?{model:{...e,zoomCamera:{...e.zoomCamera,in:!1},panCamera:{...e.panCamera,up:!1,down:!1}}}:{model:{...e,zoomCamera:{...e.zoomCamera,in:!1,out:!1},panCamera:{...e.panCamera,up:!1}}};case"l":case"ArrowRight":return{model:{...e,panCamera:{...e.panCamera,right:!1}}};default:return{model:e}}})(e,t);case p.NODE:return((e,t,n)=>{switch(n){case"h":case"ArrowLeft":return{model:{...e,focus:{...t,move:{...t.move,left:!1}}}};case"j":case"ArrowDown":return{model:{...e,focus:{...t,move:{...t.move,down:!1}}}};case"k":case"ArrowUp":return{model:{...e,focus:{...t,move:{...t.move,up:!1}}}};case"l":case"ArrowRight":return{model:{...e,focus:{...t,move:{...t.move,right:!1}}}};default:return{model:e}}})(e,e.focus,t.key);default:return{model:e}}})(t,n);case M.VIRTUAL_KEYDOWN:return((e,{key:t},n)=>{switch(e.focus.kind){case p.FINDER:switch(t){case"del":return q(e,e.focus,(e=>e.slice(0,-1)));case"sft":return{model:e};case"space":return q(e,e.focus,(e=>e+" "));case"ret":if(e.focus.options.length>0){const t=e.focus.options[0];return K(e,t,n)}return{model:O(e),render:!0};default:return q(e,e.focus,(e=>e+t))}case p.BODY:switch(t){case"del":return H(e,e.focus.body,(e=>{let t=e.toString().slice(0,-1);return""===t?0:parseFloat(t)}));case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case".":return H(e,e.focus.body,(e=>parseFloat(e.toString()+t)));case"ret":return{model:O(e),render:!0};default:return{model:e}}default:return{model:e}}})(t,n,e.generateUUID);case M.CLICKED_FINDER_OPTION:return((e,{option:t},n)=>K(e,t,n))(t,n,e.generateUUID);case M.CLICKED_BODY:return((e,{body:t})=>({model:X(O(e),t),render:!0}))(t,n);case M.CLICKED_BACKGROUND:return(e=>{if(e.focus.kind===p.FINDER)return{model:O(e),render:!0};if(e.openFinderFirstClick){const{x:t,y:n}=e.pointers[0].position;return{model:W({...e,nodePlacementLocation:{x:t,y:n,show:!1}}),render:!0}}{const t=e.focus.kind===p.NONE?e.focus:{kind:p.NONE,pointerAction:{kind:f.PAN},quickSelect:{kind:y.NONE}};return{model:{...e,openFinderFirstClick:1==e.pointers.length,focus:t},schedule:[{after:{milliseconds:300},event:{kind:M.OPEN_FINDER_TIMEOUT}}],render:!0}}})(t);case M.DELETE_NODE:return((e,{node:t})=>({model:j(e,t),render:!0}))(t,n);case M.DELETE_INPUT_EDGE:return((e,{input:t})=>({model:O({...e,graph:A(e.graph,t)}),render:!0}))(t,n);case M.DELETE_OUTPUT_EDGES:return((e,{output:t})=>({model:O({...e,graph:x(e.graph,t)}),render:!0}))(t,n);case M.PAN_CAMERA:return P(t,e.currentTime);case M.ZOOM_CAMERA:return L(t,e.currentTime);case M.MOVE_NODE:return F(t,e.currentTime)}},window:window,document:document,requestAnimationFrame:requestAnimationFrame,setTimeout:setTimeout,pointerDown:(e,t)=>{e({kind:M.POINTER_DOWN,pointer:t})},effects:{currentTime:()=>performance.now(),generateUUID:mt}});if(ft.kind==Qe.ERROR)throw ft;const Et=ft.dispatch;"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>{e.getCoalescedEvents().forEach((e=>{Et({kind:M.POINTER_MOVE,pointer:rt(e)})}))})):document.addEventListener("pointermove",(e=>Et({kind:M.POINTER_MOVE,pointer:rt(e)}))),document.addEventListener("pointerup",(e=>{Et({kind:M.POINTER_UP,pointer:rt(e)})})),document.addEventListener("wheel",(e=>{e.preventDefault(),Et({kind:M.WHEEL,position:{x:e.clientX,y:e.clientY},deltaY:e.deltaY})}),{passive:!1}),document.addEventListener("contextmenu",(e=>{e.preventDefault()})),document.addEventListener("touchend",(()=>{document.body.requestFullscreen()})),document.addEventListener("keydown",(e=>{if(e.ctrlKey)switch(e.key){case"j":case"k":e.preventDefault()}Et({kind:M.KEYDOWN,key:e.key,ctrl:e.ctrlKey})})),document.addEventListener("keyup",(e=>{Et({kind:M.KEYUP,key:e.key,ctrl:e.ctrlKey})}));var gt;gt=new URL(o("27Lyk").resolve("g0Phv"),import.meta.url).toString(),"serviceWorker"in navigator&&navigator.serviceWorker.register(gt);
//# sourceMappingURL=index.d75cafe0.js.map

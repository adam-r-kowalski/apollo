function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}const t=({haystack:e,needle:t})=>{let n=0,r=0;for(;r<t.length;){const i=t[r].toLowerCase();for(;n<e.length&&i!==e[n].toLowerCase();)++n;if(n===e.length)return!1;++r}return!0},n=({width:e,height:t})=>[2/e,0,-1,0,-2/t,1,0,0,1],r=(e,t)=>[1,0,e,0,1,t,0,0,1],i=(e,t)=>[e,0,0,0,t,0,0,0,1],o=(...e)=>{const[t,...n]=e;return n.reduce(((e,t)=>{const n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2],E=t[3],g=t[4],f=t[5],T=t[6],m=t[7],x=t[8];return[n*l+r*E+i*T,n*h+r*g+i*m,n*p+r*f+i*x,o*l+s*E+a*T,o*h+s*g+a*m,o*p+s*f+a*x,c*l+d*E+u*T,c*h+d*g+u*m,c*p+d*f+u*x]}),t)},s=(e,t)=>{const n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],d=e[7],u=e[8],l=t[0],h=t[1],p=t[2];return[n*l+r*h+i*p,o*l+s*h+a*p,c*l+d*h+u*p]},a=e=>{const t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],d=e[8],u=n*s-r*o,l=t*s-r*i,h=t*o-n*i,p=1/(a*u-c*l+d*h);return[p*(o*d-s*c),p*-(n*d-r*c),p*u,p*-(i*d-s*a),p*(t*d-r*a),p*-l,p*(i*c-o*a),p*-(t*c-n*a),p*h]},c=([e,t,n])=>Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2)),d=({graph:e,operation:t,position:n,generateUUID:r})=>{const i=r(),o={...e.inputs},s=[];for(const e of t.inputs){const t=r();o[t]={uuid:t,node:i,name:e},s.push(t)}const a={...e.outputs},c=[];for(const e of t.outputs){const t=r();a[t]={uuid:t,node:i,name:e,edges:[]},c.push(t)}const d={uuid:i,name:t.name,inputs:s,outputs:c,position:n};if(void 0!==t.body){const n={uuid:r(),node:i,value:t.body};return{graph:{...e,nodes:{...e.nodes,[d.uuid]:{...d,body:n.uuid}},inputs:o,outputs:a,bodys:{...e.bodys,[n.uuid]:n}},node:i}}return{graph:{...e,nodes:{...e.nodes,[d.uuid]:d},inputs:o,outputs:a},node:i}},u=(e,t)=>{const n={...e.nodes},r=n[t];delete n[t];const i=[];for(const t of r.inputs){const n=e.inputs[t].edge;n&&i.push(n)}for(const t of r.outputs)for(const n of e.outputs[t].edges)i.push(n);const o={...e.edges},s={...e.inputs},a={...e.outputs};for(const e of i){const t=o[e],n=s[t.input];s[t.input]={...n,edge:void 0};const r=a[t.output];a[t.output]={...r,edges:r.edges.filter((t=>t!==e))},delete o[e]}for(const e of r.inputs)delete s[e];for(const e of r.outputs)delete a[e];return{...e,nodes:n,edges:o,inputs:s,outputs:a}},l=(e,t)=>{const n=e.inputs[t].edge;if(n){const t=e.edges[n],r=e.outputs[t.output],i={...e.outputs,[t.output]:{...r,edges:r.edges.filter((e=>e!==t.uuid))}},o=e.inputs[t.input],s={...e.inputs,[t.input]:{...o,edge:void 0}},a={...e.edges};return delete a[n],{...e,outputs:i,inputs:s,edges:a}}return e},h=(e,t)=>{const n={...e.edges},r={...e.inputs},i={...e.outputs};for(const o of e.outputs[t].edges){const t=e.edges[o],s=r[t.input];r[t.input]={...s,edge:void 0};const a=i[t.output];i[t.output]={...a,edges:a.edges.filter((e=>e!==o))},delete n[o]}return{...e,outputs:i,inputs:r,edges:n}},p=({graph:e,input:t,output:n,generateUUID:r})=>{const i={uuid:r(),input:t,output:n},o={...e.inputs,[t]:{...e.inputs[t],edge:i.uuid}},s=e.outputs[n],a={...e.outputs,[n]:{...s,edges:[...s.edges,i.uuid]}};return{graph:{...e,inputs:o,outputs:a,edges:{...e.edges,[i.uuid]:i}},edge:i.uuid}},E=(e,t,n)=>{const r=e.bodys[t];return{...e,bodys:{...e.bodys,[t]:{...r,value:n(r.value)}}}};let g;var f;let T;var m;let x;var A;(f=g||(g={}))[f.ALPHABETIC=0]="ALPHABETIC",f[f.NUMERIC=1]="NUMERIC",(m=T||(T={}))[m.FINDER=0]="FINDER",m[m.NUMBER=1]="NUMBER",m[m.NONE=2]="NONE",(A=x||(x={}))[A.NODE=0]="NODE",A[A.INPUT=1]="INPUT",A[A.OUTPUT=2]="OUTPUT",A[A.BODY=3]="BODY",A[A.NONE=4]="NONE";let N;var y;(y=N||(N={}))[y.POINTER_MOVE=0]="POINTER_MOVE",y[y.POINTER_DOWN=1]="POINTER_DOWN",y[y.POINTER_UP=2]="POINTER_UP",y[y.CLICKED_NODE=3]="CLICKED_NODE",y[y.WHEEL=4]="WHEEL",y[y.CLICKED_INPUT=5]="CLICKED_INPUT",y[y.CLICKED_OUTPUT=6]="CLICKED_OUTPUT",y[y.OPEN_FINDER_TIMEOUT=7]="OPEN_FINDER_TIMEOUT",y[y.KEYDOWN=8]="KEYDOWN",y[y.VIRTUAL_KEYDOWN=9]="VIRTUAL_KEYDOWN",y[y.CLICKED_FINDER_OPTION=10]="CLICKED_FINDER_OPTION",y[y.CLICKED_NUMBER=11]="CLICKED_NUMBER",y[y.CLICKED_BACKGROUND=12]="CLICKED_BACKGROUND",y[y.DELETE_NODE=13]="DELETE_NODE",y[y.DELETE_INPUT_EDGE=14]="DELETE_INPUT_EDGE",y[y.DELETE_OUTPUT_EDGES=15]="DELETE_OUTPUT_EDGES";const R=e=>{const n=Object.keys(e.operations).filter((n=>t({haystack:n,needle:e.finder.search})));return{...e,finder:{...e.finder,options:n}}},C=e=>R({...e,finder:{show:!0,search:"",options:[],openTimeout:!1},virtualKeyboard:{show:!0,kind:g.ALPHABETIC},inputTarget:{kind:T.FINDER}}),D=e=>({...e,finder:{show:!1,search:"",options:[],openTimeout:!1},virtualKeyboard:{show:!1,kind:g.ALPHABETIC},inputTarget:{kind:T.NONE},selected:{kind:x.NONE}}),I=(e,t,n)=>{const r=e.operations[t],[i,o,a]=s(e.camera,[e.nodePlacementLocation.x,e.nodePlacementLocation.y,1]),{state:c}=U({state:e,operation:r,position:{x:i,y:o},generateUUID:n});return{state:D(c),render:!0}},_=(e,t)=>({state:R({...e,finder:{...e.finder,search:t(e.finder.search)}}),render:!0}),w=(e,t,n)=>({state:{...e,graph:E(e.graph,t,n)},render:!0}),U=({state:e,operation:t,position:n,generateUUID:r})=>{const{graph:i,node:o}=d({graph:e.graph,operation:t,position:n,generateUUID:r});return{state:{...e,graph:i,nodeOrder:[...e.nodeOrder,o]},node:o}},O=(e,t)=>({...e,graph:u(e.graph,t),nodeOrder:e.nodeOrder.filter((e=>e!==t)),selected:{kind:x.NONE}}),b=(e,t)=>({...e,virtualKeyboard:{show:!0,kind:g.NUMERIC},inputTarget:{kind:T.NUMBER,body:t},selected:{kind:x.BODY,body:t}}),k=(e,t,n)=>{switch(n.kind){case N.POINTER_DOWN:return((e,t)=>{if(e.inputTarget.kind!==T.NONE)return{state:e};const n=[...e.pointers,t.pointer];return n.length>1?{state:{...e,finder:{...e.finder,openTimeout:!1},dragging:!1,zooming:2===n.length,pointers:n}}:{state:{...e,dragging:!0,pointers:n}}})(t,n);case N.POINTER_UP:return((e,t)=>{const n=e.pointers.filter((e=>e.id!==t.pointer.id));switch(n.length){case 1:return{state:{...e,pointers:n,zooming:!1,dragging:!0,pointerDistance:0}};case 0:return{state:{...e,pointers:n,dragging:!1,pointerDistance:0}};default:return{state:{...e,pointers:n}}}})(t,n);case N.POINTER_MOVE:return((e,t)=>{if(e.dragging||e.zooming){const u=e.pointers.findIndex((e=>e.id===t.pointer.id)),l=e.pointers[u],h=(n=e.pointers,a=u,d=t.pointer,[...n.slice(0,a),d,...n.slice(a+1)]);if(e.dragging){const n=t.pointer.position.x-l.position.x,i=t.pointer.position.y-l.position.y;if(e.selected.kind===x.NODE){const t=c(s(e.camera,[0,1,0])),r=((e,t,n)=>{const r=e.nodes[t];return{...e,nodes:{...e.nodes,[t]:{...r,position:n(r.position)}}}})(e.graph,e.selected.node,(e=>({x:e.x+n*t,y:e.y+i*t})));return{state:{...e,pointers:h,graph:r},render:!0}}{const t=o(e.camera,r(-n,-i));return{state:{...e,pointers:h,camera:t},render:!0}}}{const[t,n]=[h[0],h[1]],{x:s,y:a}=t.position,{x:c,y:d}=n.position,u=Math.sqrt(Math.pow(c-s,2)+Math.pow(d-a,2)),l=e.pointerDistance,p=e.pointerCenter,E=(t.position.x+n.position.x)/2,g=(t.position.y+n.position.y)/2,f={x:E,y:g};if(l>0){const t=r(E,g),n=Math.pow(2,.01*(l-u)),s=r(-E,-g),a=E-p.x,c=g-p.y,d=o(e.camera,t,i(n,n),s,r(-a,-c));return{state:{...e,pointerCenter:f,pointerDistance:u,pointers:h,camera:d},render:!0}}return{state:{...e,pointerCenter:f,pointerDistance:u,pointers:h}}}}{const n=e.finder.show?e.nodePlacementLocation:t.pointer.position;return{state:{...e,nodePlacementLocation:n}}}var n,a,d})(t,n);case N.CLICKED_NODE:return((e,t)=>{const n=e.nodeOrder.filter((e=>e!==t.node));return n.push(t.node),{state:{...e,selected:{kind:x.NODE,node:t.node},inputTarget:{kind:T.NONE},virtualKeyboard:{kind:g.ALPHABETIC,show:!1},nodeOrder:n},render:!0}})(t,n);case N.WHEEL:return((e,t)=>{const n=r(t.position.x,t.position.y),s=Math.pow(2,.01*t.deltaY),a=r(-t.position.x,-t.position.y),c=o(e.camera,n,i(s,s),a);return{state:{...e,camera:c},render:!0}})(t,n);case N.CLICKED_INPUT:return((e,t,n)=>{if(e.selected.kind===x.OUTPUT){const r=e.graph.inputs[t.input],i=e.graph.outputs[e.selected.output];if(r.node===i.node)return{state:e};{const i=void 0!==r.edge?l(e.graph,r.uuid):e.graph,{graph:o}=p({graph:i,input:t.input,output:e.selected.output,generateUUID:n});return{state:{...e,selected:{kind:x.NONE},graph:o},render:!0}}}return{state:{...e,selected:{kind:x.INPUT,input:t.input},virtualKeyboard:{kind:g.ALPHABETIC,show:!1},inputTarget:{kind:T.NONE}},render:!0}})(t,n,e);case N.CLICKED_OUTPUT:return((e,t,n)=>{if(e.selected.kind===x.INPUT){const r=e.graph.inputs[e.selected.input];if(e.graph.outputs[t.output].node===r.node)return{state:e};{const i=void 0!==r.edge?l(e.graph,r.uuid):e.graph,{graph:o}=p({graph:i,input:e.selected.input,output:t.output,generateUUID:n});return{state:{...e,selected:{kind:x.NONE},graph:o},render:!0}}}return{state:{...e,selected:{kind:x.OUTPUT,output:t.output},virtualKeyboard:{kind:g.ALPHABETIC,show:!1},inputTarget:{kind:T.NONE}},render:!0}})(t,n,e);case N.OPEN_FINDER_TIMEOUT:return((e,t)=>({state:{...e,finder:{...e.finder,openTimeout:!1}}}))(t);case N.KEYDOWN:return((e,{key:t},n)=>{switch(e.inputTarget.kind){case T.FINDER:switch(t){case"Backspace":return _(e,(e=>e.slice(0,-1)));case"Shift":case"Alt":case"Control":case"Meta":case"Tab":return{state:e};case"Enter":if(e.finder.options.length>0){const t=e.finder.options[0];return I(e,t,n)}return{state:D(e),render:!0};case"Escape":return{state:D(e),render:!0};default:return _(e,(e=>e+t))}case T.NUMBER:switch(t){case"Backspace":return w(e,e.inputTarget.body,(e=>{let t=e.toString().slice(0,-1);return""===t?0:parseFloat(t)}));case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":return w(e,e.inputTarget.body,(e=>parseFloat(e.toString()+t)));case"Enter":case"Escape":return{state:{...e,virtualKeyboard:{show:!1,kind:g.ALPHABETIC},inputTarget:{kind:T.NONE},selected:{kind:x.NONE}},render:!0};default:return{state:e}}case T.NONE:switch(t){case"f":return{state:C(e),render:!0};case"d":switch(e.selected.kind){case x.NODE:return{state:O(e,e.selected.node),render:!0};case x.INPUT:return{state:{...e,graph:l(e.graph,e.selected.input),selected:{kind:x.NONE}},render:!0};case x.OUTPUT:return{state:{...e,graph:h(e.graph,e.selected.output),selected:{kind:x.NONE}},render:!0};default:return{state:e}}case"Escape":return e.selected.kind===x.NONE?{state:e}:{state:{...e,selected:{kind:x.NONE}},render:!0};default:return{state:e}}}})(t,n,e);case N.VIRTUAL_KEYDOWN:return((e,{key:t},n)=>{switch(e.inputTarget.kind){case T.FINDER:switch(t){case"del":return _(e,(e=>e.slice(0,-1)));case"sft":return{state:e};case"space":return _(e,(e=>e+" "));case"ret":if(e.finder.options.length>0){const t=e.finder.options[0];return I(e,t,n)}return{state:D(e),render:!0};default:return _(e,(e=>e+t))}case T.NUMBER:switch(t){case"del":return w(e,e.inputTarget.body,(e=>{let t=e.toString().slice(0,-1);return""===t?0:parseFloat(t)}));case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":case".":return w(e,e.inputTarget.body,(e=>parseFloat(e.toString()+t)));case"ret":return{state:{...e,virtualKeyboard:{show:!1,kind:g.ALPHABETIC},inputTarget:{kind:T.NONE},selected:{kind:x.NONE}},render:!0};default:return{state:e}}case T.NONE:return{state:e}}})(t,n,e);case N.CLICKED_FINDER_OPTION:return((e,{option:t},n)=>I(e,t,n))(t,n,e);case N.CLICKED_NUMBER:return((e,{body:t})=>({state:b(D(e),t),render:!0}))(t,n);case N.CLICKED_BACKGROUND:return(e=>e.finder.show?{state:D(e),render:!0}:e.finder.openTimeout?{state:C({...e,nodePlacementLocation:e.pointers[0].position,dragging:!1}),render:!0}:{state:{...e,finder:{...e.finder,openTimeout:!0},inputTarget:{kind:T.NONE},virtualKeyboard:{kind:g.ALPHABETIC,show:!1},selected:{kind:x.NONE}},schedule:[{after:{milliseconds:300},event:{kind:N.OPEN_FINDER_TIMEOUT}}],render:!0})(t);case N.DELETE_NODE:return((e,{node:t})=>({state:O(e,t),render:!0}))(t,n);case N.DELETE_INPUT_EDGE:return((e,{input:t})=>({state:{...e,graph:l(e.graph,t),selected:{kind:x.NONE}},render:!0}))(t,n);case N.DELETE_OUTPUT_EDGES:return((e,{output:t})=>({state:{...e,graph:h(e.graph,t),selected:{kind:x.NONE}},render:!0}))(t,n)}},v=({x0:e,y0:t,x1:n,y1:r},i)=>e<=i.position.x&&i.position.x<=n&&t<=i.position.y&&i.position.y<=r,L=(e,t)=>{for(let n=e.clickHandlers.length;n>0;--n)for(const{onClick:r,worldSpace:i}of e.clickHandlers[n-1])if(v(i,t))return e.dispatch(r),e;return e},P=e=>({triangles:{vertices:[],colors:[],vertexIndices:[],textureIndex:e,textureCoordinates:[],cameraIndex:[]},lines:{vertices:[],colors:[]}});function*S(e,t,n,r){const i=(t.x0+t.x1)/2,o=(t.y0+t.y1)/2,s=i+r,a=o,c=(n.x0+n.x1)/2,d=(n.y0+n.y1)/2,u=c-r,l=d;let h=0,p=0,E=!0;for(const t of e){const e=t*t,n=e*t,r=1-t,g=r*r,f=g*r,T=3*g*t,m=3*r*e,x=f*i+T*s+m*u+n*c,A=f*o+T*a+m*l+n*d;E?(yield x,yield A,E=!1):(yield h,yield p),yield x,yield A,h=x,p=A}}const z=(e,t,n)=>{const r=((e,t,n)=>{const r=(t-e)/(n-1);return Array.from({length:n},((t,n)=>e+r*n))})(0,1,20),i=[];let o=P(0),s=o.triangles.textureIndex.toString();return e.forEach(((e,a)=>{for(const[t,n]of Object.entries(e)){s!==t&&(0!==o.triangles.vertices.length&&i.push(o),o=P(parseInt(t)),s=t);for(const e of n){const t=o.triangles.vertices.length/2;o.triangles.vertices.push(...e.vertices),o.triangles.colors.push(...e.colors);for(const n of e.vertexIndices)o.triangles.vertexIndices.push(n+t);o.triangles.textureCoordinates.push(...e.textureCoordinates),o.triangles.cameraIndex.push(...e.cameraIndex)}}if(t.length>a){for(const{connections:e,scale:i}of t[a]){const t=50*i;for(const{from:i,to:s,color:a}of e){for(const e of S(r,n[i],n[s],t))o.lines.vertices.push(e);const{red:e,green:c,blue:d,alpha:u}=a;for(let t=0;t<40;++t)o.lines.colors.push(e,c,d,u)}}0!==o.lines.vertices.length&&(i.push(o),o=P(0))}})),0!==o.triangles.vertices.length&&i.push(o),i},B=(e,t)=>{const n=e.cameras.length;e.cameras.push(t),e.stack.push(n),e.transform=a(t)},F=e=>e.stack.slice(-1)[0],M=e=>{e.stack.pop(),e.transform=a(e.cameras[F(e)])},W=(e,t)=>{const[n,r,i]=s(e.transform,[t.x0,t.y0,1]),[o,a,c]=s(e.transform,[t.x1,t.y1,1]);return{x0:n,y0:r,x1:o,y1:a}},K=(e,t,n)=>{const r=Ce(e.child,t,n);return{size:{width:t.maxWidth,height:t.maxHeight},child:r}},Y=(e,t,n,r)=>{const i=W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),o=t.child,s={x:n.x+t.size.width/2-o.size.width/2,y:n.y+t.size.height/2-o.size.height/2};return{worldSpace:i,child:De(e.child,o,s,r)}};function*H(e,t,n,r){yield*Ie(e.child,t.child,n.child,r+1)}let G;var V;let X;var $;function j(...e){const[t,n]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:ye.COLUMN,mainAxisAlignment:t.mainAxisAlignment??G.START,crossAxisAlignment:t.crossAxisAlignment??X.START,children:n}}(V=G||(G={}))[V.START=0]="START",V[V.CENTER=1]="CENTER",V[V.END=2]="END",V[V.SPACE_EVENLY=3]="SPACE_EVENLY",V[V.SPACE_BETWEEN=4]="SPACE_BETWEEN",($=X||(X={}))[$.START=0]="START",$[$.CENTER=1]="CENTER",$[$.END=2]="END";const q=(e,t,n)=>{const r={children:[],width:0,totalChildHeight:0},i=e.children.reduce(((e,r)=>{const i=Ce(r,t,n);return e.children.push(i),e.totalChildHeight+=i.size.height,e.width=Math.max(e.width,i.size.width),e}),r),{children:o,width:s,totalChildHeight:a}=i;return{size:{width:s,height:e.mainAxisAlignment==G.START?a:t.maxHeight},totalChildHeight:a,children:o}},J=(e,t,n,r)=>{const i=t.size.height-t.totalChildHeight,o={children:[],y:(()=>{switch(e.mainAxisAlignment){case G.START:return n.y;case G.CENTER:return n.y+i/2;case G.END:return n.y+i;case G.SPACE_EVENLY:return n.y+i/(e.children.length+1);case G.SPACE_BETWEEN:return n.y}})()},s=e=>e.size.height,a=e=>e.size.height,c=e=>e.size.height,d=t=>t.size.height+i/(e.children.length+1),u=t=>t.size.height+i/(e.children.length-1),l=(()=>{switch(e.mainAxisAlignment){case G.START:return s;case G.CENTER:return a;case G.END:return c;case G.SPACE_EVENLY:return d;case G.SPACE_BETWEEN:return u}})(),h=e=>n.x,p=e=>n.x+t.size.width/2-e.size.width/2,E=e=>n.x+t.size.width-e.size.width,g=(()=>{switch(e.crossAxisAlignment){case X.START:return h;case X.CENTER:return p;case X.END:return E}})(),f=e.children.reduce(((e,n,i)=>{const o=t.children[i],s={x:g(o),y:e.y},a=De(n,o,s,r);return e.children.push(a),e.y+=l(o),e}),o);return{worldSpace:W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:f.children}};function*Q(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const i=r+1;let o=0;for(const r of e.children)yield*Ie(r,t.children[o],n.children[o],i),o+=1}const Z=e=>e?{top:e,right:e,bottom:e,left:e}:{top:0,right:0,bottom:0,left:0},ee=({padding:e,width:t,height:n,color:r,x:i,y:o,onClick:s,id:a},c)=>({kind:ye.CONTAINER,padding:Z(e),width:t,height:n,x:i,y:o,color:r,onClick:s,id:a,child:c}),te=(e,t,n)=>{const{top:r,right:i,bottom:o,left:s}=e.padding;if(e.child){const a=Ce(e.child,t,n);return{size:{width:e.width??a.size.width+s+i,height:e.height??a.size.height+r+o},child:a}}return{size:{width:e.width?e.width+s+i:t.maxWidth,height:e.height?e.height+r+o:t.maxHeight}}},ne=(e,t,n,r)=>{const i=n.x+(e.x??0),o=i+t.size.width,s=n.y+(e.y??0),a=s+t.size.height,c=W(r,{x0:i,x1:o,y0:s,y1:a}),d=(()=>{if(e.child){const n=t.child,o={x:i+e.padding.left,y:s+e.padding.top};return De(e.child,n,o,r)}})();if(e.color){const{red:t,green:n,blue:u,alpha:l}=e.color;return{worldSpace:c,vertices:[i,s,i,a,o,s,o,a],colors:[t,n,u,l,t,n,u,l,t,n,u,l,t,n,u,l],vertexIndices:[0,1,2,1,2,3],cameraIndex:Array(4).fill(F(r)),textureIndex:0,textureCoordinates:Array(8).fill(0),child:d}}return{worldSpace:c,vertices:[],colors:[],vertexIndices:[],cameraIndex:[],textureIndex:0,textureCoordinates:[],child:d}};function*re(e,t,n,r){if(yield{ui:e,layout:t,geometry:n,z:r},e.child){const i=t.child,o=n.child;yield*Ie(e.child,i,o,r+1)}}function ie(...e){const[t,n]=e[0]instanceof Array?[{},e[0]]:[e[0],e[1]];return{kind:ye.ROW,mainAxisAlignment:t.mainAxisAlignment??G.START,crossAxisAlignment:t.crossAxisAlignment??X.START,children:n}}const oe=(e,t,n)=>{const r={children:[],totalChildWidth:0,height:0},i=e.children.reduce(((e,r)=>{const i=Ce(r,t,n);return e.children.push(i),e.totalChildWidth+=i.size.width,e.height=Math.max(e.height,i.size.height),e}),r),{children:o,totalChildWidth:s,height:a}=i;return{size:{width:e.mainAxisAlignment==G.START?s:t.maxWidth,height:a},totalChildWidth:s,children:o}},se=(e,t,n,r)=>{const i=t.size.width-t.totalChildWidth,o={children:[],x:(()=>{switch(e.mainAxisAlignment){case G.START:return n.x;case G.CENTER:return n.x+i/2;case G.END:return n.x+i;case G.SPACE_EVENLY:return n.x+i/(e.children.length+1);case G.SPACE_BETWEEN:return n.x}})()},s=e=>e.size.width,a=e=>e.size.width,c=e=>e.size.width,d=t=>t.size.width+i/(e.children.length+1),u=t=>t.size.width+i/(e.children.length-1),l=(()=>{switch(e.mainAxisAlignment){case G.START:return s;case G.CENTER:return a;case G.END:return c;case G.SPACE_EVENLY:return d;case G.SPACE_BETWEEN:return u}})(),h=e=>n.y,p=e=>n.y+t.size.height/2-e.size.height/2,E=e=>n.y+t.size.height-e.size.height,g=(()=>{switch(e.crossAxisAlignment){case X.START:return h;case X.CENTER:return p;case X.END:return E}})(),f=e.children.reduce(((e,n,i)=>{const o=t.children[i],s={x:e.x,y:g(o)},a=De(n,o,s,r);return e.children.push(a),e.x+=l(o),e}),o);return{worldSpace:W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:f.children}};function*ae(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};const i=r+1;let o=0;for(const r of e.children)yield*Ie(r,t.children[o],n.children[o],i),o+=1}const ce=({id:e,onClick:t,camera:n,children:r,connections:i})=>({id:e,onClick:t,kind:ye.SCENE,camera:n,children:r,connections:i??[]}),de=(e,t,n)=>{const r=e.children.map((e=>Ce(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},ue=(e,t,n,r)=>{const i=W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height});B(r,e.camera);const o=e.children.map(((e,i)=>De(e,t.children[i],n,r)));return M(r),{worldSpace:i,children:o}};function*le(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let i=0;for(const o of e.children){for(const e of Ie(o,t.children[i],n.children[i],r))yield e,r=Math.max(r,e.z);i++,r++}}const he=(e,t,n)=>{const r=e.children.map((e=>Ce(e,t,n)));return{size:{width:t.maxWidth,height:t.maxHeight},children:r}},pe=(e,t,n,r)=>{const i=e.children.map(((e,i)=>De(e,t.children[i],n,r)));return{worldSpace:W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),children:i}};function*Ee(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r};let i=0;for(const o of e.children){for(const e of Ie(o,t.children[i],n.children[i],r))yield e,r=Math.max(r,e.z);i+=1,r+=1}}function ge(...e){const[t,n]="string"==typeof e[0]?[{},e[0]]:[e[0],e[1]];return{kind:ye.TEXT,font:{family:t.font??"monospace",size:t.size??14},color:t.color??{red:255,green:255,blue:255,alpha:255},str:n}}const fe=({font:e,str:t},n,r)=>{const i=r(e,t),o=i.widths.reduce(((e,t)=>e+t));return{measurements:i,size:{width:o,height:e.size}}},Te=(e,t,n)=>{const r=[];let i=n.x;const o=n.y,s=n.y+t;for(const t of e){const e=i,n=i+t;r.push(e,o,e,s,n,o,n,s),i+=t}return r},me=(e,{red:t,green:n,blue:r,alpha:i})=>{const o=[];for(let s=0;s<e;++s)o.push(t,n,r,i,t,n,r,i,t,n,r,i,t,n,r,i);return o},xe=e=>{const t=[];let n=0;for(let r=0;r<e;++r)t.push(n,n+1,n+2,n+1,n+2,n+3),n+=4;return t},Ae=(e,t,n,r)=>{const i=t,{measurements:o}=i,{textureIndex:s,textureCoordinates:a,widths:c}=o;return{worldSpace:W(r,{x0:n.x,y0:n.y,x1:n.x+t.size.width,y1:n.y+t.size.height}),textureIndex:s,textureCoordinates:a.flat(),colors:me(c.length,e.color),vertices:Te(c,e.font.size,n),vertexIndices:xe(c.length),cameraIndex:Array(4*c.length).fill(F(r))}};function*Ne(e,t,n,r){yield{ui:e,layout:t,geometry:n,z:r}}let ye;var Re;(Re=ye||(ye={}))[Re.CENTER=0]="CENTER",Re[Re.COLUMN=1]="COLUMN",Re[Re.CONTAINER=2]="CONTAINER",Re[Re.ROW=3]="ROW",Re[Re.SCENE=4]="SCENE",Re[Re.STACK=5]="STACK",Re[Re.TEXT=6]="TEXT";const Ce=(e,t,n)=>{switch(e.kind){case ye.CENTER:return K(e,t,n);case ye.COLUMN:return q(e,t,n);case ye.CONTAINER:return te(e,t,n);case ye.ROW:return oe(e,t,n);case ye.SCENE:return de(e,t,n);case ye.STACK:return he(e,t,n);case ye.TEXT:return fe(e,0,n)}},De=(e,t,n,r)=>{switch(e.kind){case ye.CENTER:return Y(e,t,n,r);case ye.COLUMN:return J(e,t,n,r);case ye.CONTAINER:return ne(e,t,n,r);case ye.ROW:return se(e,t,n,r);case ye.SCENE:return ue(e,t,n,r);case ye.STACK:return pe(e,t,n,r);case ye.TEXT:return Ae(e,t,n,r)}};function*Ie(e,t,n,r){switch(e.kind){case ye.CENTER:yield*H(e,t,n,r);break;case ye.COLUMN:yield*Q(e,t,n,r);break;case ye.CONTAINER:yield*re(e,t,n,r);break;case ye.ROW:yield*ae(e,t,n,r);break;case ye.SCENE:yield*le(e,t,n,r);break;case ye.STACK:yield*Ee(e,t,n,r);break;case ye.TEXT:yield*Ne(e,t,n,r)}}const _e=(e,t,n,r)=>{const i=r.initial();for(const o of Ie(e,t,n,0))r.combine(i,o);return i};var we={};e(we,"initial",(()=>ve)),e(we,"combine",(()=>Le));const Ue=(e,t)=>{if(void 0===t.ui.onClick)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({onClick:t.ui.onClick,worldSpace:t.geometry.worldSpace}),e},Oe=(e,t)=>t.ui.id?(e[t.ui.id]=t.geometry.worldSpace,e):e,be=(e,t)=>{switch(t.ui.kind){case ye.CONTAINER:case ye.TEXT:const n=t.geometry;if(0==n.vertices.length)return e;const r=t.z-e.length+1;for(let t=0;t<r;++t)e.push({});const i=e[t.z];return(()=>{const e=i[n.textureIndex];if(e)return e;const t=[];return i[n.textureIndex]=t,t})().push(n),e;default:return e}},ke=(e,t)=>{if(t.ui.kind==ye.SCENE){if(0===t.ui.connections.length)return e;const n=t.z-e.length+1;for(let t=0;t<n;++t)e.push([]);return e[t.z].push({connections:t.ui.connections,scale:c(s(a(t.ui.camera),[0,1,0]))}),e}return e},ve=()=>({layers:[],clickHandlers:[],idToWorldSpace:{},connections:[]}),Le=(e,t)=>({layers:be(e.layers,t),clickHandlers:Ue(e.clickHandlers,t),idToWorldSpace:Oe(e.idToWorldSpace,t),connections:ke(e.connections,t)}),Pe=(e,t)=>{const{width:n,height:r}=e.size;e.clear();const i=Ce(t,{minWidth:0,maxWidth:n,minHeight:0,maxHeight:r},e.measureText),o={cameras:[[1,0,0,0,1,0,0,0,1]],stack:[0],transform:a([1,0,0,0,1,0,0,0,1])},s=De(t,i,{x:0,y:0},o),{layers:c,clickHandlers:d,connections:u,idToWorldSpace:l}=_e(t,i,s,we),h=z(c,u,l);e.cameras=o.cameras,e.clickHandlers=d;for(const t of h)e.draw(t);return e};let Se;var ze;(ze=Se||(Se={}))[ze.DATA=0]="DATA",ze[ze.ERROR=1]="ERROR";class Be{constructor(e,t,n,r,i,o,s,a,c){this.window=e,this.document=t,this.canvas=n,this.gl=r,this.program=i,this.textures=o,this.textMeasurementsCache=s,this.clickHandlers=a,this.dispatch=c,this.kind=Se.DATA,this.clear=()=>{const{gl:e}=this;e.clear(e.COLOR_BUFFER_BIT)},this.draw=({triangles:e,lines:t})=>{const{gl:n,program:r,textures:i}=this,{attributes:o}=r;{const{vertices:t,colors:r,vertexIndices:s,textureCoordinates:a,textureIndex:c,cameraIndex:d}=e;if(0!==t.length){const e=i[c];n.bindTexture(n.TEXTURE_2D,e),n.bindBuffer(n.ARRAY_BUFFER,o.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(d),n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.vertexIndices),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),n.STATIC_DRAW),n.drawElements(n.TRIANGLES,s.length,n.UNSIGNED_SHORT,0)}}{const{vertices:e,colors:r}=t;if(0!==e.length){const t=i[0],s=e.length/2;n.bindTexture(n.TEXTURE_2D,t),n.bindBuffer(n.ARRAY_BUFFER,o.vertices.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.colors.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(r),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.textureCoordinates.buffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(Array(2*s).fill(0)),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,o.cameraIndex.buffer),n.bufferData(n.ARRAY_BUFFER,new Uint8Array(Array(s).fill(0)),n.STATIC_DRAW),n.drawArrays(n.LINES,0,s)}}},this.getTextureMeasurements=(e,t)=>{const{document:n,gl:r}=this,i=`${t} ${e.size} ${e.family}`,o=this.textMeasurementsCache.get(i);if(o)return o;const{texture:s,widths:a,textureCoordinates:c}=((e,t,n,r)=>{const i=e.createElement("canvas"),o=i.getContext("2d"),s=Math.sqrt(256),a=(e=>{let t=1;for(;t<e;)t<<=1;return t})(n.size*s),c=a/s;i.width=a*r,i.height=a*r,i.style.width=`${a}px`,i.style.height=`${a}px`,o.scale(r,r),o.textAlign="left",o.textBaseline="top",o.font=`${n.size}px ${n.family}`,o.fillStyle="white",o.clearRect(0,0,o.canvas.width,o.canvas.height);const d=n.size,u=[],l=[];for(let e=0;e<256;++e){const t=String.fromCharCode(e),n=o.measureText(t),r=Math.ceil(n.width),i=e%s*c,h=Math.floor(e/s)*c;o.fillText(t,i,h),u.push(r);const p=i/a,E=(i+r)/a,g=h/a,f=(h+d)/a;l.push([p,g,p,f,E,g,E,f])}const h=t.createTexture();return t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{widths:u,textureCoordinates:l,texture:h}})(n,r,e,t),d=this.textures.length;this.textures.push(s);const u={widths:a,textureIndex:d,textureCoordinates:c};return this.textMeasurementsCache.set(i,u),u},this.measureText=(e,t)=>{const{window:n}=this,r=n.devicePixelRatio,{widths:i,textureIndex:o,textureCoordinates:s}=this.getTextureMeasurements(e,r),a=((e,t)=>{let n=[];for(let r=0;r<e.length;++r)n.push(t(e[r],r));return n})(t,(e=>e.charCodeAt(0)));return{widths:a.map((e=>i[e])),textureIndex:o,textureCoordinates:a.map((e=>s[e]))}}}set size(e){const{gl:t,program:r,window:i}=this,{uniforms:o}=r,{canvas:s}=t;t.uniformMatrix3fv(o.projection,!0,n(e)),s.width=e.width*i.devicePixelRatio,s.height=e.height*i.devicePixelRatio,s.style.width=`${e.width}px`,s.style.height=`${e.height}px`,t.viewport(0,0,s.width,s.height),this._size=e}get size(){return this._size}set cameras(e){const{gl:t,program:n}=this,{uniforms:r}=n,i=[];for(const t of e)i.push(...t);t.uniformMatrix3fv(r.cameras,!0,i),this._cameras=e}get cameras(){return this._cameras}}const Fe=({width:e,height:t,document:n,window:r,dispatch:i})=>{const o=n.createElement("canvas");o.style.touchAction="none";const s=o.getContext("webgl2");s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),s.depthMask(!1),s.activeTexture(s.TEXTURE0),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.clearColor(0,0,0,1);const a=(e=>{const t={vertices:{location:0,buffer:e.createBuffer()},colors:{location:1,buffer:e.createBuffer()},textureCoordinates:{location:2,buffer:e.createBuffer()},cameraIndex:{location:3,buffer:e.createBuffer()},vertexIndices:e.createBuffer()},n=((e,t)=>{const{vertices:n,colors:r,textureCoordinates:i,cameraIndex:o}=t,s=`#version 300 es\n  uniform mat3 u_projection;\n  uniform mat3 u_cameras[8];\n\n  layout(location = ${n.location}) in vec2 a_vertex;\n  layout(location = ${r.location}) in vec4 a_color;\n  layout(location = ${i.location}) in vec2 a_textureCoordinates;\n  layout(location = ${o.location}) in uint a_cameraIndex;\n\n  out vec4 v_color;\n  out vec2 v_textureCoordinates;\n\n  void main() {\n    mat3 camera = u_cameras[a_cameraIndex];\n    mat3 transform = u_projection * inverse(camera);\n    gl_Position = vec4((transform * vec3(a_vertex, 1)).xy, 0, 1);\n    v_color = a_color / 255.0;\n    v_textureCoordinates = a_textureCoordinates;\n  }\n  `,a=e.createShader(e.VERTEX_SHADER);return e.shaderSource(a,s),e.compileShader(a),a})(e,t),r=(e=>{const t=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(t,"#version 300 es\n  precision highp float;\n\n  uniform sampler2D u_texture;\n\n  in vec4 v_color;\n  in vec2 v_textureCoordinates;\n\n  out vec4 fragColor;\n  \n  void main() {\n    fragColor = texture(u_texture, v_textureCoordinates) * v_color;\n  }\n  "),e.compileShader(t),t})(e),i=e.createProgram();if(e.attachShader(i,n),e.attachShader(i,r),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))return{kind:Se.ERROR,vertexInfoLog:e.getShaderInfoLog(n),fragmentInfoLog:e.getShaderInfoLog(r)};e.useProgram(i);const o=e.createVertexArray();e.bindVertexArray(o),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_vertex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.vertices),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_color"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0)})(e,i,t.colors),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_textureCoordinates"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0)})(e,i,t.textureCoordinates),((e,t,{location:n,buffer:r})=>{e.bindAttribLocation(t,n,"a_cameraIndex"),e.enableVertexAttribArray(n),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribIPointer(n,1,e.UNSIGNED_BYTE,0,0)})(e,i,t.cameraIndex);const s={projection:e.getUniformLocation(i,"u_projection"),texture:e.getUniformLocation(i,"u_texture"),cameras:e.getUniformLocation(i,"u_cameras")};return{kind:Se.DATA,vertexShader:n,fragmentShader:r,program:i,attributes:t,uniforms:s}})(s);if(a.kind==Se.ERROR)return a;const c=s.createTexture();s.bindTexture(s.TEXTURE_2D,c),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([255,255,255,255]));const d=new Be(r,n,o,s,a,[c],new Map,[],i??(()=>{}));return d.size={width:e,height:t},d},Me=e=>({id:e.pointerId,position:{x:e.clientX,y:e.clientY}}),We=({items:e,backgroundColor:t})=>j({mainAxisAlignment:G.END},[ie({mainAxisAlignment:G.END},[ee({padding:4,color:t},j(e.map((({name:e,shortcut:t,onClick:n})=>ee({padding:10,onClick:n},ge({size:18},`(${t}) ${e}`))))))])]),Ke=e=>ee({width:e,height:e}),Ye=(e,t)=>{const n=[e[0]];for(const r of e.slice(1))n.push(t,r);return n},He=(e,t)=>{switch(e.kind){case x.BODY:return e.body===t;case x.INPUT:return e.input===t;case x.NODE:return e.node===t;case x.NONE:return!1;case x.OUTPUT:return e.output===t}},Ge=(e,t,n)=>j(Ye(t.map((t=>((e,{name:t,uuid:n},r)=>ee({onClick:{kind:N.CLICKED_INPUT,input:n}},ie({crossAxisAlignment:X.CENTER},[ee({id:n,width:14,height:14,color:He(r,n)?e.selectedInput:e.input}),Ke(4),ge(t)])))(e,t,n))),Ke(4))),Ve=(e,t,n)=>j(Ye(t.map((t=>((e,{name:t,uuid:n},r)=>ee({onClick:{kind:N.CLICKED_OUTPUT,output:n}},ie({crossAxisAlignment:X.CENTER},[ge(t),Ke(4),ee({id:n,width:14,height:14,color:He(r,n)?e.selectedInput:e.input})])))(e,t,n))),Ke(4))),Xe=(e,t,n,r)=>{const i=n.nodes[t],o=[];return i.inputs.length&&o.push(Ge(e,i.inputs.map((e=>n.inputs[e])),r)),i.inputs.length&&i.outputs.length&&o.push(Ke(15)),i.body&&o.push(((e,t,n)=>ee({color:He(n,t.uuid)?e.selectedInput:e.background,padding:5,onClick:{kind:N.CLICKED_NUMBER,body:t.uuid}},ge(t.value.toString())))(e,n.bodys[i.body],r),Ke(15)),i.outputs.length&&o.push(Ve(e,i.outputs.map((e=>n.outputs[e])),r)),ee({color:He(r,i.uuid)?e.selectedNode:e.node,padding:4,x:i.position.x,y:i.position.y,onClick:{kind:N.CLICKED_NODE,node:i.uuid}},j({crossAxisAlignment:X.CENTER},[ge(i.name),Ke(4),ie(o)]))},$e=e=>ie(e.map((e=>{return t=e,ee({padding:10,onClick:{kind:N.VIRTUAL_KEYDOWN,key:t}},ge({size:24},t));var t}))),je=(e,t)=>{switch(t){case g.ALPHABETIC:return(e=>j({mainAxisAlignment:G.END},[ie({mainAxisAlignment:G.SPACE_BETWEEN},[ee({padding:4,color:e.node},j([$e(["1","2","3","4","5"]),$e(["q","w","e","r","t"]),$e(["a","s","d","f","g"]),$e(["z","x","c","v"]),$e(["sft","space"])])),ee({padding:4,color:e.node},j({crossAxisAlignment:X.END},[$e(["6","7","8","9","0"]),$e(["y","u","i","o","p"]),$e(["h","j","k","l"]),$e(["b","n","m","del"]),$e(["space","ret"])]))])]))(e);case g.NUMERIC:return(e=>j({mainAxisAlignment:G.END},[ie({mainAxisAlignment:G.END},[ee({padding:4,color:e.node},j({crossAxisAlignment:X.END},[$e(["1","2","3","4"]),$e(["5","6","7","8"]),$e(["9","0","del"]),$e([".","ret"])]))])]))(e)}},qe=()=>crypto.randomUUID(),Je=(e=>{let{state:t,view:n,update:r,window:i,document:o,requestAnimationFrame:s,setTimeout:a}=e;const c=Fe({width:i.innerWidth,height:i.innerHeight,window:i,document:o});switch(c.kind){case Se.ERROR:return c;case Se.DATA:let d=c,u=!1;const l=()=>{u||(u=!0,s((()=>{d=Pe(d,n(t)),u=!1})))},h=e=>{const{state:n,render:i,schedule:o,dispatch:s}=r(t,e);t=n,i&&l();for(const{after:e,event:t}of o??[]){const{milliseconds:n}=e;a((()=>h(t)),n)}for(const e of s??[])h(e)};return d.dispatch=h,o.body.appendChild(d.canvas),o.addEventListener("pointerdown",(t=>{const n=Me(t);e.pointerDown(h,n),d=L(d,n)})),i.addEventListener("resize",(()=>{d.size={width:i.innerWidth,height:i.innerHeight},l()})),l(),{kind:Se.DATA,dispatch:h}}})({state:(e=>{const t={graph:{nodes:{},edges:{},inputs:{},bodys:{},outputs:{}},nodeOrder:[],zooming:!1,dragging:!1,pointers:[],pointerDistance:0,pointerCenter:{x:0,y:0},camera:[1,0,0,0,1,0,0,0,1],selected:{kind:x.NONE},theme:{background:{red:2,green:22,blue:39,alpha:255},node:{red:41,green:95,blue:120,alpha:255},selectedNode:{red:23,green:54,blue:69,alpha:255},input:{red:188,green:240,blue:192,alpha:255},selectedInput:{red:175,green:122,blue:208,alpha:255},connection:{red:255,green:255,blue:255,alpha:255}},nodePlacementLocation:{x:0,y:0},finder:{search:"",options:[],show:!1,openTimeout:!1},virtualKeyboard:{show:!1,kind:g.ALPHABETIC},inputTarget:{kind:T.NONE},operations:{},operations:{Number:{name:"Number",inputs:[],body:0,outputs:["out"]},Add:{name:"Add",inputs:["x","y"],outputs:["out"]},Subtract:{name:"Subtract",inputs:["x","y"],outputs:["out"]},Multiply:{name:"Multiply",inputs:["x","y"],outputs:["out"]},Divide:{name:"Divide",inputs:["x","y"],outputs:["out"]},Equal:{name:"Equal",inputs:["x","y"],outputs:["out"]},"Less Than":{name:"Less Than",inputs:["x","y"],outputs:["out"]},Print:{name:"Print",inputs:["value"],outputs:[]}}},{graph:n,node:r}=d({graph:t.graph,operation:t.operations.Number,position:{x:25,y:20},generateUUID:e}),i=E(n,n.nodes[r].body,(()=>10)),{graph:o,node:s}=d({graph:i,operation:t.operations.Number,position:{x:55,y:105},generateUUID:e}),a=E(o,o.nodes[s].body,(()=>25)),{graph:c,node:u}=d({graph:a,operation:t.operations.Add,position:{x:175,y:55},generateUUID:e}),{graph:l}=p({graph:c,input:c.nodes[u].inputs[0],output:c.nodes[r].outputs[0],generateUUID:e}),{graph:h}=p({graph:l,input:l.nodes[u].inputs[1],output:l.nodes[s].outputs[0],generateUUID:e}),{graph:f,node:m}=d({graph:h,operation:t.operations.Number,position:{x:225,y:145},generateUUID:e}),A=E(f,f.nodes[m].body,(()=>5)),{graph:N,node:y}=d({graph:A,operation:t.operations.Divide,position:{x:355,y:75},generateUUID:e}),{graph:R}=p({graph:N,input:N.nodes[y].inputs[0],output:N.nodes[u].outputs[0],generateUUID:e}),{graph:C}=p({graph:R,input:R.nodes[y].inputs[1],output:R.nodes[m].outputs[0],generateUUID:e}),{graph:D,node:I}=d({graph:C,operation:t.operations.Print,position:{x:535,y:85},generateUUID:e}),{graph:_}=p({graph:D,input:D.nodes[I].inputs[0],output:D.nodes[y].outputs[0],generateUUID:e});return{...t,graph:_,nodeOrder:[r,s,u,m,y,I]}})(qe),view:e=>{const t=e.nodeOrder.map((t=>Xe(e.theme,t,e.graph,e.selected))),n=Object.values(e.graph.edges).map((({input:t,output:n})=>({from:n,to:t,color:e.theme.connection}))),r=[ee({color:e.theme.background,onClick:{kind:N.CLICKED_BACKGROUND}}),ce({camera:e.camera,children:t,connections:n})];e.finder.show&&r.push((({search:e,options:t},n)=>j({crossAxisAlignment:X.CENTER},[ee({height:10}),ee({color:n.node,padding:4},j([ee({color:n.background,width:300,padding:4},ge({color:n.input,size:24},e.length?e:"Search ...")),ee({width:10,height:10}),...t.map(((e,t)=>ee({padding:4,onClick:{kind:N.CLICKED_FINDER_OPTION,option:e}},ge({size:18,color:0==t?n.input:{red:255,green:255,blue:255,alpha:255}},e))))]))]))(e.finder,e.theme)),e.virtualKeyboard.show&&r.push(je(e.theme,e.virtualKeyboard.kind));const i=((e,t,n)=>{switch(n.kind){case x.NODE:return{name:"Delete Node",shortcut:"d",onClick:{kind:N.DELETE_NODE,node:n.node}};case x.INPUT:return t.inputs[n.input].edge?{name:"Delete Edge",shortcut:"d",onClick:{kind:N.DELETE_INPUT_EDGE,input:n.input}}:null;case x.OUTPUT:return t.outputs[n.output].edges.length>0?{name:"Delete Edge",shortcut:"d",onClick:{kind:N.DELETE_OUTPUT_EDGES,output:n.output}}:null;default:return null}})(e.theme,e.graph,e.selected);return i&&r.push(We({items:[i],backgroundColor:e.theme.node})),o=r,{kind:ye.STACK,children:o};var o},update:(e,t)=>k(qe,e,t),window:window,document:document,requestAnimationFrame:requestAnimationFrame,setTimeout:setTimeout,pointerDown:(e,t)=>{e({kind:N.POINTER_DOWN,pointer:t})}});if(Je.kind==Se.ERROR)throw Je;const Qe=Je.dispatch;"function"==typeof PointerEvent.prototype.getCoalescedEvents?document.addEventListener("pointermove",(e=>{e.getCoalescedEvents().forEach((e=>{Qe({kind:N.POINTER_MOVE,pointer:Me(e)})}))})):document.addEventListener("pointermove",(e=>Qe({kind:N.POINTER_MOVE,pointer:Me(e)}))),document.addEventListener("pointerup",(e=>{Qe({kind:N.POINTER_UP,pointer:Me(e)})})),document.addEventListener("wheel",(e=>{e.preventDefault(),Qe({kind:N.WHEEL,position:{x:e.clientX,y:e.clientY},deltaY:e.deltaY})}),{passive:!1}),document.addEventListener("contextmenu",(e=>{e.preventDefault()})),document.addEventListener("touchend",(()=>{document.body.requestFullscreen()})),document.addEventListener("keydown",(e=>{e.preventDefault(),Qe({kind:N.KEYDOWN,key:e.key})}));
//# sourceMappingURL=index.30a7a2a8.js.map
